<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>속기 뷰어 (단일 파일)</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Jua&family=Do+Hyeon&family=Nanum+Gothic&family=Nanum+Myeongjo&family=Nanum+Pen+Script&family=Gothic+A1&family=IBM+Plex+Sans+KR&display=swap" rel="stylesheet">
  <style>
    /* 기본 스타일 */
    html, body {
      width: 100vw; height: 100vh; margin: 0; padding: 0;
      background: #000; color: #fff; overflow: hidden;
    }
    
    /* 연결 상태 인디케이터 */
    #connection-status {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-family: 'Noto Sans KR', sans-serif;
      z-index: 10001;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    #connection-status.connecting {
      background: rgba(255, 193, 7, 0.9);
      color: #000;
    }
    
    #connection-status.connected {
      background: rgba(40, 167, 69, 0.9);
      color: #fff;
    }
    
    #connection-status.disconnected {
      background: rgba(220, 53, 69, 0.9);
      color: #fff;
    }
    
    #connection-status .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    #viewer {
      position: relative;
      width: 100vw; height: 100vh;
      font-size: 32px; line-height: 1.5; text-align: left;
      transition: background 0.3s;
      z-index: 1;
      padding: 40px 30px;
      box-sizing: border-box;
    }
    
    #viewer-text {
      position: absolute;
      top: 40px; left: 30px; right: 30px; bottom: 40px;
      width: calc(100% - 60px);
      height: calc(100% - 80px);
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #8884 #0000;
      background: none;
      word-break: break-all;
      white-space: pre-wrap;
      padding: 0;
      font-size: inherit;
      font-family: inherit;
      color: inherit;
      text-align: inherit;
      line-height: inherit;
      letter-spacing: 0;
      transition: color 0.2s, background 0.2s;
      box-sizing: border-box;
    }
    
    #viewer-text::-webkit-scrollbar {
      width: 8px;
      background: transparent;
    }
    
    #viewer-text::-webkit-scrollbar-thumb {
      background: rgba(180,180,180,0.18);
      border-radius: 4px;
    }
    
    /* 설정 아이콘 */
    #setting-icon {
      position: fixed;
      top: 18px; left: 50%; transform: translateX(-50%);
      width: 44px; height: 44px;
      background: rgba(45,45,45,0.9);
      border: 1px solid #444;
      border-radius: 8px;
      z-index: 1000;
      transition: all 0.3s ease;
      opacity: 0;
      pointer-events: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-family: 'Consolas', 'Courier New', monospace;
    }
    #setting-icon.visible {
      opacity: 1;
    }
    #setting-icon:hover {
      background: rgba(58,58,58,0.95);
      border-color: #5a78ff;
      box-shadow: 0 4px 16px rgba(90,120,255,0.2);
    }
    #setting-icon svg { 
      width: 24px; height: 24px; 
      fill: #a2c1ff; 
      transition: fill 0.2s ease;
    }
    #setting-icon:hover svg { 
      fill: #fff; 
    }
    #setting-icon.fullscreen {
      top: 70px;
      width: 56px; 
      height: 56px;
    }
    #setting-icon.fullscreen svg {
      width: 32px; 
      height: 32px;
    }
    
    /* 옵션 패널 */
    #option-panel {
      position: fixed;
      top: -600%;
      left: 50%; 
      transform: translateX(-50%);
      min-width: 420px;
      max-width: 480px;
      background: #1e1e1e;
      border: 2px solid #333;
      border-radius: 0 0 12px 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.8);
      padding: 0;
      display: flex; 
      flex-direction: column;
      transition: top 0.4s cubic-bezier(0.4,1.6,0.4,1);
      z-index: 20;
      pointer-events: auto;
      font-family: 'Consolas', 'Courier New', monospace;
      font-size: 13px;
      color: #e0e0e0;
    }
    #option-panel.open { 
      top: 0;
    }
    #option-panel.fullscreen {
      top: -600%;
    }
    #option-panel.fullscreen.open {
      top: 70px;
    }
    
    /* 패널 헤더 */
    .panel-header {
      background: #252526;
      padding: 12px 16px;
      border-bottom: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .panel-header::before {
      content: "⚙";
      font-size: 16px;
      color: #5a78ff;
      margin-right: 8px;
    }
    .panel-title {
      font-weight: 600;
      color: #fff;
      font-size: 14px;
      letter-spacing: 0.5px;
    }
    .close-btn {
      width: 24px;
      height: 24px;
      background: none;
      border: none;
      color: #888;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s ease;
    }
    .close-btn:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }
    
    /* 탭 네비게이션 */
    .tab-nav {
      display: flex;
      background: #2d2d2d;
      border-bottom: 1px solid #333;
    }
    .tab-btn {
      flex: 1;
      padding: 10px 16px;
      background: none;
      border: none;
      color: #a0a0a0;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: relative;
    }
    .tab-btn:hover {
      color: #fff;
      background: #383838;
    }
    .tab-btn.active {
      color: #5a78ff;
      background: #1e1e1e;
    }
    .tab-btn.active::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: #5a78ff;
    }
    
    /* 탭 콘텐츠 */
    .tab-content {
      display: none;
      max-height: 50vh;
      overflow-y: auto;
      padding: 8px 0;
    }
    .tab-content.active {
      display: block;
    }
    .tab-content::-webkit-scrollbar {
      width: 8px;
      background: #1e1e1e;
    }
    .tab-content::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 4px;
    }
    
    fieldset.option-group {
      border: 1px solid #444;
      border-radius: 6px;
      margin: 8px 16px;
      padding: 12px 16px 8px 16px;
      background: #232323;
    }
    legend {
      color: #5a78ff; 
      font-size: 12px; 
      font-weight: 600;
      padding: 4px 12px;
      background: #2d2d2d;
      border: 1px solid #444;
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .option-row {
      display: grid;
      grid-template-columns: 80px 1fr auto;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
      padding: 8px 0;
      border-bottom: 1px solid #2a2a2a;
      min-height: 32px;
    }
    .option-row:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    .option-row.wide {
      grid-template-columns: 80px 1fr 50px 24px 24px;
      gap: 8px;
    }
    .option-row label {
      color: #a2c1ff; 
      font-size: 12px;
      font-weight: 500;
      text-align: left;
      white-space: nowrap;
      text-transform: capitalize;
      line-height: 1.2;
    }
    .option-row input[type="color"] {
      width: 36px; 
      height: 32px; 
      border: 1px solid #444; 
      background: #181818; 
      cursor: pointer;
      border-radius: 4px;
      padding: 2px;
      transition: border-color 0.2s ease;
      vertical-align: middle;
    }
    .option-row input[type="checkbox"] {
      width: 18px; 
      height: 18px;
      accent-color: #5a78ff;
      cursor: pointer;
      vertical-align: middle;
    }
    .option-row input[type="number"]::-webkit-inner-spin-button,
    .option-row input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
      display: none;
    }
    .option-row input[type="number"] {
      width: 50px; 
      height: 28px;
      font-size: 12px; 
      padding: 0 6px; 
      border-radius: 4px; 
      border: 1px solid #444;
      background: #181818; 
      color: #e0e0e0; 
      text-align: center;
      font-family: inherit;
      transition: all 0.2s ease;
      line-height: 1;
      box-sizing: border-box;
      -moz-appearance: textfield;
    }
    .option-row input[type="number"]:focus {
      outline: none;
      border-color: #5a78ff;
      box-shadow: 0 0 0 2px rgba(90,120,255,0.2);
    }
    .option-row select {
      height: 32px;
      font-size: 12px; 
      border-radius: 4px; 
      border: 1px solid #444;
      background: #181818; 
      color: #e0e0e0; 
      padding: 6px 8px;
      font-family: inherit;
      transition: all 0.2s ease;
      box-sizing: border-box;
    }
    .option-row select:focus {
      outline: none;
      border-color: #5a78ff;
      box-shadow: 0 0 0 2px rgba(90,120,255,0.2);
    }
    .option-row input[type="range"] {
      width: 100px;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: #444;
      border-radius: 3px;
      outline: none;
      vertical-align: middle;
    }
    .option-row input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: #5a78ff;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .option-row input[type="range"]::-webkit-slider-thumb:hover {
      background: #7b9eff;
      transform: scale(1.1);
    }
    .option-row .num-btns {
      display: flex; 
      flex-direction: column; 
      gap: 1px;
      justify-self: end;
    }
    .option-row .num-btns button {
      width: 24px; 
      height: 14px; 
      font-size: 10px; 
      border: none; 
      background: #3a3a3a; 
      color: #ccc;
      border-radius: 2px; 
      cursor: pointer; 
      padding: 0;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: inherit;
      line-height: 1;
    }
    .option-row .num-btns button:hover { 
      background: #5a78ff; 
      color: #fff;
      transform: scale(1.05);
    }
    .unit-label {
      color: #888;
      font-size: 11px;
      line-height: 1;
      vertical-align: middle;
      justify-self: start;
    }
    
    /* 커스텀 버튼 */
    .custom-btn {
      padding: 6px 12px;
      font-size: 11px;
      background: #444;
      color: #ccc;
      border: 1px solid #666;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .custom-btn:hover {
      background: #666;
      color: #fff;
    }
    
    /* Display 섹션 특별 처리 */
    .display-group .option-row.wide {
      display: grid;
      grid-template-columns: 80px auto 50px 50px;
      align-items: center;
      gap: 8px;
    }
    .display-group .option-row.wide input[type="number"] {
      grid-column: 2;
      justify-self: start;
      width: 50px;
    }
    .display-group .option-row.wide .unit-label {
      grid-column: 3;
      justify-self: start;
    }
    .display-group .option-row.wide .num-btns {
      grid-column: 4;
      justify-self: center;
    }
    
    /* Layout 섹션 특별 처리 */
    .layout-group .option-row.wide {
      display: grid;
      grid-template-columns: 80px auto 50px 50px;
      align-items: center;
      gap: 8px;
    }
    .layout-group .option-row.wide input[type="number"] {
      grid-column: 2;
      justify-self: start;
      width: 50px;
    }
    .layout-group .option-row.wide .unit-label {
      grid-column: 3;
      justify-self: start;
    }
    .layout-group .option-row.wide .num-btns {
      grid-column: 4;
      justify-self: center;
    }
    
    /* Effects 섹션 특별 처리 */
    .effects-group .option-row {
      display: grid;
      grid-template-columns: 80px auto 50px;
      align-items: center;
      gap: 12px;
    }
    .effects-group .option-row.wide {
      grid-template-columns: 80px auto 50px 50px;
      gap: 8px;
    }
    .effects-group .option-row input[type="checkbox"] {
      justify-self: start;
    }
    .effects-group .option-row input[type="color"] {
      grid-column: 3;
      justify-self: center;
    }
    .effects-group .option-row.wide input[type="number"] {
      grid-column: 2;
      justify-self: start;
      width: 50px;
    }
    .effects-group .option-row.wide .unit-label {
      grid-column: 3;
      justify-self: start;
    }
    .effects-group .option-row.wide .num-btns {
      grid-column: 4;
      justify-self: center;
    }
    
    /* 색상 프리셋 */
    .preset-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 8px 16px;
    }
    .preset-item {
      background: #232323;
      border: 2px solid #444;
      border-radius: 8px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 16px;
      min-height: 80px;
    }
    .preset-item:hover {
      border-color: #5a78ff;
      background: #2a2a2a;
    }
    .preset-item.active {
      border-color: #5a78ff;
      background: #2d3748;
      box-shadow: 0 0 0 2px rgba(90,120,255,0.3);
    }
    .preset-preview {
      width: 200px;
      height: 90px;
      border: 1px solid #555;
      border-radius: 6px;
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
    }
    .preset-bg {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
    }
    .preset-text {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 12px;
      font-weight: normal;
      font-family: sans-serif;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
      text-align: center;
      line-height: 1.3;
      padding: 8px;
      box-sizing: border-box;
      width: 100%;
    }
    .preset-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }
    .preset-name {
      font-size: 13px;
      color: #a2c1ff;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .preset-code {
      font-size: 11px;
      color: #888;
      font-family: monospace;
    }
    
    /* 여백 조절기 */
    #margin-adjuster {
      position: fixed;
      left: 0;
      right: 0;
      height: 20px;
      background: linear-gradient(to bottom, transparent, rgba(90,120,255,0.2), rgba(90,120,255,0.5));
      border-top: 2px solid #5a78ff;
      cursor: ns-resize;
      z-index: 100;
      display: none;
      transition: all 0.2s ease;
      user-select: none;
    }
    #margin-adjuster.active {
      display: block;
    }
    #margin-adjuster:hover {
      background: linear-gradient(to bottom, transparent, rgba(90,120,255,0.4), rgba(90,120,255,0.7));
      border-top-color: #7b9eff;
    }
    #margin-adjuster.dragging {
      background: linear-gradient(to bottom, transparent, rgba(90,120,255,0.6), rgba(90,120,255,0.8));
      border-top-color: #fff;
    }
    #margin-adjuster::before {
      content: "⋮⋮⋮";
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      color: #5a78ff;
      font-size: 12px;
      letter-spacing: 2px;
      pointer-events: none;
    }
    
    /* 반응형 */
    @media (max-width: 600px) {
      #option-panel { 
        min-width: 280px; 
        max-width: 320px;
        font-size: 12px;
      }
      #viewer { padding: 40px 20px; }
      #viewer-text { 
        top: 40px; left: 20px; right: 20px; bottom: 40px;
        width: calc(100% - 40px);
        height: calc(100% - 80px);
      }
      .preset-preview {
        width: 150px;
        height: 70px;
      }
      .preset-text {
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- 연결 상태 표시 -->
  <div id="connection-status" class="connecting">
    <div class="status-dot"></div>
    <span>연결 중...</span>
  </div>
  
  <div id="viewer">
    <div id="viewer-text">자막 대기 중...</div>
    
    <!-- 설정 아이콘 -->
    <div id="setting-icon" title="설정">
      <svg viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zm7.43-2.9l1.77-1.02a1 1 0 0 0 .37-1.36l-1.68-2.92a1 1 0 0 0-1.28-.46l-1.77 1.02a7.03 7.03 0 0 0-1.52-.88l-.27-2A1 1 0 0 0 13.5 3h-3a1 1 0 0 0-1 .88l-.27 2a7.03 7.03 0 0 0-1.52.88l-1.77-1.02a1 1 0 0 0-1.36.37l-1.68 2.92a1 1 0 0 0 .37 1.36l1.77 1.02c-.09.32-.16.65-.22.99l-2 .27A1 1 0 0 0 3 10.5v3a1 1 0 0 0 .88 1l2 .27c.06.34.13.67.22.99l-1.77 1.02a1 1 0 0 0-.37 1.36l1.68 2.92a1 1 0 0 0 1.28.46l1.77-1.02c.47.34.97.64 1.52.88l.27 2A1 1 0 0 0 10.5 21h3a1 1 0 0 0 1-.88l.27-2c.55-.24 1.05-.54 1.52-.88l1.77 1.02a1 1 0 0 0 1.36-.37l1.68-2.92a1 1 0 0 0-.37-1.36l-1.77-1.02c.09-.32.16-.65.22-.99l2-.27A1 1 0 0 0 21 13.5v-3a1 1 0 0 0-.88-1l-2-.27a7.03 7.03 0 0 0-.22-.99zM12 17a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/></svg>
    </div>
    
    <!-- 옵션 패널 -->
    <div id="option-panel">
      <div class="panel-header">
        <span class="panel-title">Viewer Settings</span>
        <button class="close-btn" id="closePanel">×</button>
      </div>
      
      <div class="tab-nav">
        <button class="tab-btn active" data-tab="tab1">설정</button>
        <button class="tab-btn" data-tab="tab2">프리셋</button>
      </div>
      
      <!-- 탭 1: 기본 설정 -->
      <div id="tab1" class="tab-content active">
        <fieldset class="option-group display-group">
          <legend>Display</legend>
          <div class="option-row">
            <label>배경색</label>
            <input type="color" id="bgColor" value="#000000">
            <input type="range" id="bgAlpha" min="0" max="100" value="100">
          </div>
          <div class="option-row">
            <label>글자색</label>
            <input type="color" id="fontColor" value="#ffffff">
          </div>
          <div class="option-row">
            <label>글꼴</label>
            <select id="fontFamily">
              <option value="sans-serif">기본 고딕</option>
              <option value="serif">기본 명조</option>
              <option value="monospace">고정폭</option>
              <option value="'Noto Sans KR', sans-serif">Noto Sans KR</option>
              <option value="'Nanum Gothic', sans-serif">나눔고딕</option>
              <option value="'Nanum Myeongjo', serif">나눔명조</option>
              <option value="'Nanum Pen Script', cursive">나눔펜체</option>
              <option value="'Jua', sans-serif">주아체</option>
              <option value="'Do Hyeon', sans-serif">도현체</option>
              <option value="'Gothic A1', sans-serif">고딕 A1</option>
              <option value="'IBM Plex Sans KR', sans-serif">IBM Plex 한글</option>
              <option value="'맑은 고딕', 'Malgun Gothic', sans-serif">맑은 고딕</option>
              <option value="'굴림', Gulim, sans-serif">굴림</option>
              <option value="'돋움', Dotum, sans-serif">돋움</option>
              <option value="'바탕', Batang, serif">바탕</option>
              <option value="Arial, sans-serif">Arial</option>
              <option value="'Times New Roman', serif">Times New Roman</option>
              <option value="Georgia, serif">Georgia</option>
              <option value="Verdana, sans-serif">Verdana</option>
            </select>
          </div>
          <div class="option-row">
            <label>커스텀</label>
            <button type="button" id="addFontBtn" class="custom-btn">폰트 추가</button>
            <span style="color: #888; font-size: 11px;">직접 입력</span>
          </div>
          <div class="option-row wide">
            <label>글자크기</label>
            <input type="number" id="fontSize" min="10" max="200" value="32">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="fontSizeUp">▲</button>
              <button type="button" id="fontSizeDown">▼</button>
            </div>
          </div>
          <div class="option-row wide">
            <label>자간</label>
            <input type="number" id="letterSpacing" min="-5" max="20" value="0" step="0.5">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="letterSpacingUp">▲</button>
              <button type="button" id="letterSpacingDown">▼</button>
            </div>
          </div>
          <div class="option-row wide">
            <label>행간</label>
            <input type="number" id="lineHeight" min="1" max="3" value="1.5" step="0.1">
            <span class="unit-label">배</span>
            <div class="num-btns">
              <button type="button" id="lineHeightUp">▲</button>
              <button type="button" id="lineHeightDown">▼</button>
            </div>
          </div>
        </fieldset>
        
        <fieldset class="option-group layout-group">
          <legend>Layout</legend>
          <div class="option-row">
            <label>여백조절기</label>
            <input type="checkbox" id="marginAdjusterToggle">
            <span style="color: #888; font-size: 11px; margin-left: 8px;">하단 드래그바</span>
          </div>
          <div class="option-row wide">
            <label>상단여백</label>
            <input type="number" id="marginTop" min="0" max="200" step="1" value="0">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="marginTopUp">▲</button>
              <button type="button" id="marginTopDown">▼</button>
            </div>
          </div>
          <div class="option-row wide">
            <label>하단여백</label>
            <input type="number" id="marginBottom" min="0" max="400" step="1" value="0">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="marginBottomUp">▲</button>
              <button type="button" id="marginBottomDown">▼</button>
            </div>
          </div>
        </fieldset>
        
        <fieldset class="option-group effects-group">
          <legend>Effects</legend>
          <div class="option-row">
            <label>테두리</label>
            <input type="checkbox" id="outlineOn">
            <input type="color" id="outlineColor" value="#000000">
          </div>
          <div class="option-row wide">
            <label>굵기</label>
            <input type="number" id="outlineWidth" min="0" max="10" value="2" step="0.1">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="outlineWidthUp">▲</button>
              <button type="button" id="outlineWidthDown">▼</button>
            </div>
          </div>
          <div class="option-row">
            <label>그림자</label>
            <input type="checkbox" id="shadowOn">
            <input type="color" id="shadowColor" value="#000000">
          </div>
          <div class="option-row wide">
            <label>흐림</label>
            <input type="number" id="shadowBlur" min="0" max="20" value="3" step="0.5">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="shadowBlurUp">▲</button>
              <button type="button" id="shadowBlurDown">▼</button>
            </div>
          </div>
          <div class="option-row wide">
            <label>거리</label>
            <input type="number" id="shadowDistance" min="0" max="10" value="2" step="0.5">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="shadowDistanceUp">▲</button>
              <button type="button" id="shadowDistanceDown">▼</button>
            </div>
          </div>
        </fieldset>
      </div>
      
      <!-- 탭 2: 색상 프리셋 -->
      <div id="tab2" class="tab-content">
        <fieldset class="option-group">
          <legend>Presets</legend>
          <div class="option-row">
            <label>프리셋 적용</label>
            <button type="button" id="resetPreset" class="custom-btn">해제</button>
            <span style="color: #888; font-size: 11px; margin-left: 8px;">원클릭 적용</span>
          </div>
        </fieldset>
        
        <div class="preset-grid">
          <!-- 크로마키 프리셋 -->
          <div class="preset-item" data-preset="green-white">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #00FF00;"></div>
              <div class="preset-text" style="color: #FFFFFF;">미리 보기<br>텍스트입니다.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">크로마 그린</div>
              <div class="preset-code">#00FF00 / #FFFFFF</div>
            </div>
          </div>
          
          <div class="preset-item" data-preset="blue-white">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #0000FF;"></div>
              <div class="preset-text" style="color: #FFFFFF;">미리 보기<br>텍스트입니다.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">크로마 블루</div>
              <div class="preset-code">#0000FF / #FFFFFF</div>
            </div>
          </div>
          
          <div class="preset-item" data-preset="magenta-white">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #FF00FF;"></div>
              <div class="preset-text" style="color: #FFFFFF;">미리 보기<br>텍스트입니다.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">크로마 마젠타</div>
              <div class="preset-code">#FF00FF / #FFFFFF</div>
            </div>
          </div>
          
          <!-- 고대비 프리셋 -->
          <div class="preset-item" data-preset="black-white">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #000000;"></div>
              <div class="preset-text" style="color: #FFFFFF;">미리 보기<br>텍스트입니다.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">블랙 + 화이트</div>
              <div class="preset-code">#000000 / #FFFFFF</div>
            </div>
          </div>
          
          <div class="preset-item" data-preset="navy-white">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #000080;"></div>
              <div class="preset-text" style="color: #FFFFFF;">미리 보기<br>텍스트입니다.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">네이비 + 화이트</div>
              <div class="preset-code">#000080 / #FFFFFF</div>
            </div>
          </div>
          
          <div class="preset-item" data-preset="white-black">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #FFFFFF;"></div>
              <div class="preset-text" style="color: #000000;">미리 보기<br>텍스트입니다.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">화이트 + 블랙</div>
              <div class="preset-code">#FFFFFF / #000000</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 여백 조절기 -->
  <div id="margin-adjuster"></div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
  <script>
// ========== 설정 및 상태 관리 ==========
const CONFIG = {
  SOCKET_URL: 'https://nuastudio.co.kr',
  RECONNECT_DELAY: 1000,
  RECONNECT_DELAY_MAX: 5000,
  KEEPALIVE_INTERVAL: 15 * 60 * 1000
};

// URL 파라미터에서 채널 코드 가져오기
const params = new URLSearchParams(window.location.search);
let channelCode = params.get('channel');

// 채널 코드가 없으면 사용자에게 입력 받기
if (!channelCode) {
  channelCode = prompt('채널 코드를 입력하세요:');
  if (!channelCode) {
    alert('채널 코드가 필요합니다.');
    window.close();
  }
}

// DOM 요소
const viewerText = document.getElementById('viewer-text');
const connectionStatus = document.getElementById('connection-status');
const settingIcon = document.getElementById('setting-icon');
const optionPanel = document.getElementById('option-panel');
const closePanel = document.getElementById('closePanel');
const marginAdjusterToggle = document.getElementById('marginAdjusterToggle');
const marginAdjuster = document.getElementById('margin-adjuster');

// 상태 변수
let socket = null;
let keepaliveInterval = null;
let accumulatedText = '';
let activeStenographer = '1';
let currentActiveInput = '';
let isInitialConnection = true;

// 여백 조절기 상태
let marginAdjusterEnabled = false;
let marginOffset = 0;
let isDragging = false;
let startY = 0;
let startOffset = 0;
let maxMargin = 0;
let ignoreNextClick = false;

// ========== 연결 상태 관리 ==========
function updateConnectionStatus(status, message) {
  if (!isInitialConnection) {
    if (status === 'disconnected' && message.includes('채널')) {
      connectionStatus.className = status;
      connectionStatus.querySelector('span').textContent = message;
      connectionStatus.style.opacity = '1';
      setTimeout(() => {
        connectionStatus.style.opacity = '0';
      }, 5000);
    }
    return;
  }
  
  connectionStatus.className = status;
  connectionStatus.querySelector('span').textContent = message;
  
  if (status === 'connected') {
    setTimeout(() => {
      connectionStatus.style.opacity = '0';
      isInitialConnection = false;
    }, 3000);
  } else {
    connectionStatus.style.opacity = '1';
  }
}

// ========== Socket.IO 연결 관리 ==========
function initSocket() {
  console.log('[Socket] 초기화 시작:', CONFIG.SOCKET_URL);
  
  socket = io(CONFIG.SOCKET_URL, {
    transports: ['websocket', 'polling'],
    upgrade: true,
    reconnection: true,
    reconnectionAttempts: Infinity,
    reconnectionDelay: CONFIG.RECONNECT_DELAY,
    reconnectionDelayMax: CONFIG.RECONNECT_DELAY_MAX,
    timeout: 20000,
    forceNew: true
  });
  
  socket.on('connect', () => {
    console.log('[Socket] 연결 성공! ID:', socket.id);
    updateConnectionStatus('connected', '연결됨');
    joinChannel();
    startKeepalive();
  });
  
  socket.on('connect_error', (error) => {
    console.error('[Socket] 연결 에러:', error.message);
    updateConnectionStatus('disconnected', '연결 실패');
  });
  
  socket.on('disconnect', (reason) => {
    console.log('[Socket] 연결 끊김:', reason);
    updateConnectionStatus('disconnected', '연결 끊김');
    stopKeepalive();
  });
  
  socket.on('reconnect_attempt', (attemptNumber) => {
    console.log('[Socket] 재연결 시도:', attemptNumber);
    updateConnectionStatus('connecting', `재연결 중... (${attemptNumber})`);
  });
  
  socket.on('reconnect', () => {
    console.log('[Socket] 재연결 성공');
    updateConnectionStatus('connected', '재연결됨');
    joinChannel();
    startKeepalive();
  });
  
  socket.on('joined_channel', (data) => {
    console.log('[Channel] 참가 성공:', data);
    socket.emit('request_sync', { channel: channelCode });
  });
  
  socket.on('sync_accumulated', handleSyncAccumulated);
  socket.on('channel_state', handleChannelState);
  socket.on('steno_input', handleStenoInput);
  socket.on('switch_role', handleSwitchRole);
  socket.on('text_sent', handleTextSent);
  socket.on('clear_text', handleClearText);
}

// ========== 채널 참가 ==========
function joinChannel() {
  if (!socket || !socket.connected) {
    console.warn('[Channel] 소켓이 연결되지 않음');
    return;
  }
  
  console.log('[Channel] 참가 요청:', channelCode);
  socket.emit('join_channel', {
    channel: channelCode,
    role: 'viewer',
    requestSync: true
  });
}

// ========== Keepalive 관리 ==========
function startKeepalive() {
  stopKeepalive();
  
  keepaliveInterval = setInterval(() => {
    if (socket && socket.connected) {
      console.log('[Keepalive] 신호 전송');
      socket.emit('keepalive', {
        channel: channelCode,
        timestamp: Date.now()
      });
    }
  }, CONFIG.KEEPALIVE_INTERVAL);
}

function stopKeepalive() {
  if (keepaliveInterval) {
    clearInterval(keepaliveInterval);
    keepaliveInterval = null;
  }
}

// ========== 메시지 핸들러 ==========
function handleSyncAccumulated(data) {
  console.log('[Sync] 누적 텍스트 동기화');
  accumulatedText = data.accumulatedText || '';
  currentActiveInput = '';
  updateDisplay(accumulatedText, true);
  
  if (data.activeStenographer) {
    activeStenographer = data.activeStenographer === 'steno1' ? '1' : '2';
  }
}

function handleChannelState(data) {
  console.log('[State] 채널 상태:', data);
  if (data.state) {
    if (data.state.activeStenographer) {
      activeStenographer = data.state.activeStenographer === 'steno1' ? '1' : '2';
    }
    if (data.state.accumulatedText !== undefined) {
      accumulatedText = data.state.accumulatedText;
      currentActiveInput = '';
      updateDisplay(accumulatedText, true);
    }
  }
}

function handleStenoInput(data) {
  const roleNumber = data.role === 'steno1' ? '1' : 
                     data.role === 'steno2' ? '2' : 
                     data.role;
  
  if (roleNumber === activeStenographer) {
    currentActiveInput = data.text || '';
    const fullText = accumulatedText + currentActiveInput;
    updateDisplay(fullText, false);
  }
}

function handleSwitchRole(data) {
  activeStenographer = data.newActive === 'steno1' ? '1' : '2';
  
  if (data.accumulatedText !== undefined) {
    accumulatedText = data.accumulatedText;
    currentActiveInput = '';
    updateDisplay(accumulatedText, true);
  }
  
  console.log('[Role] 권한 전환:', activeStenographer);
}

function handleTextSent(data) {
  accumulatedText = data.accumulatedText || '';
  currentActiveInput = '';
  updateDisplay(accumulatedText, true);
}

function handleClearText() {
  accumulatedText = '';
  currentActiveInput = '';
  updateDisplay('', true);
}

// ========== 화면 업데이트 ==========
function updateDisplay(text, isImmediate = false) {
  let displayText = text;
  
  // 1단어 지연 처리
  if (!isImmediate && !text.endsWith(' ')) {
    const words = text.split(' ');
    if (words.length > 1) {
      displayText = words.slice(0, -1).join(' ') + ' ';
    } else {
      displayText = '';
    }
  }
  
  viewerText.textContent = displayText || '자막 대기 중...';
  viewerText.scrollTop = viewerText.scrollHeight;
}

// ========== UI 이벤트 ==========
// 설정 아이콘 표시/숨김
let mouseTimer = null;
let isMouseInTopArea = false;
let isMouseOnIcon = false;

function updateIconVisibility() {
  if (isMouseInTopArea || isMouseOnIcon || optionPanel.classList.contains('open')) {
    settingIcon.classList.add('visible');
  } else {
    settingIcon.classList.remove('visible');
  }
}

document.addEventListener('mousemove', e => {
  isMouseInTopArea = e.clientY < 80;
  updateIconVisibility();
});

settingIcon.addEventListener('mouseenter', () => {
  isMouseOnIcon = true;
  updateIconVisibility();
});

settingIcon.addEventListener('mouseleave', () => {
  isMouseOnIcon = false;
  updateIconVisibility();
});

document.addEventListener('mouseleave', () => {
  isMouseInTopArea = false;
  isMouseOnIcon = false;
  if (!optionPanel.classList.contains('open')) {
    settingIcon.classList.remove('visible');
  }
});

// 옵션 패널 토글
settingIcon.addEventListener('click', e => {
  e.stopPropagation();
  optionPanel.classList.toggle('open');
  settingIcon.classList.add('visible');
});

// 닫기 버튼
closePanel.addEventListener('click', e => {
  e.stopPropagation();
  optionPanel.classList.remove('open');
});

// 탭 기능
const tabBtns = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content');

tabBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    const targetTab = btn.dataset.tab;
    
    tabBtns.forEach(b => b.classList.remove('active'));
    tabContents.forEach(c => c.classList.remove('active'));
    
    btn.classList.add('active');
    document.getElementById(targetTab).classList.add('active');
  });
});

// 크로마키 프리셋 데이터
const chromaPresets = {
  'green-white': { bg: '#00FF00', text: '#FFFFFF' },
  'blue-white': { bg: '#0000FF', text: '#FFFFFF' },
  'magenta-white': { bg: '#FF00FF', text: '#FFFFFF' },
  'black-white': { bg: '#000000', text: '#FFFFFF' },
  'navy-white': { bg: '#000080', text: '#FFFFFF' },
  'white-black': { bg: '#FFFFFF', text: '#000000' }
};

// 크로마키 프리셋 선택
const presetItems = document.querySelectorAll('.preset-item');
const resetPreset = document.getElementById('resetPreset');

presetItems.forEach(item => {
  item.addEventListener('click', () => {
    const presetName = item.dataset.preset;
    const preset = chromaPresets[presetName];
    
    if (preset) {
      presetItems.forEach(p => p.classList.remove('active'));
      item.classList.add('active');
      
      document.getElementById('bgColor').value = preset.bg;
      document.getElementById('fontColor').value = preset.text;
      
      applyBasicOptions();
    }
  });
});

// 프리셋 해제 버튼
resetPreset.addEventListener('click', () => {
  presetItems.forEach(p => p.classList.remove('active'));
  document.getElementById('bgColor').value = '#000000';
  document.getElementById('fontColor').value = '#FFFFFF';
  applyBasicOptions();
});

// 폰트 추가 기능
const addFontBtn = document.getElementById('addFontBtn');

addFontBtn.addEventListener('click', () => {
  const fontName = prompt(
    "추가할 폰트 이름을 입력하세요:\n" +
    "(예: Pretendard, 나눔스퀘어, 배달의민족 주아)\n\n" +
    "※ 해당 폰트가 시스템에 설치되어 있어야 합니다."
  );
  
  if (fontName && fontName.trim()) {
    const trimmedName = fontName.trim();
    const fontSelect = document.getElementById('fontFamily');
    
    const exists = Array.from(fontSelect.options).some(opt =>
      opt.textContent === trimmedName
    );
    
    if (!exists) {
      const option = document.createElement('option');
      option.value = `'${trimmedName}', sans-serif`;
      option.textContent = trimmedName;
      fontSelect.appendChild(option);
      fontSelect.value = option.value;
      applyBasicOptions();
    } else {
      alert('이미 추가된 폰트입니다.');
    }
  }
});

// 여백 조절기 토글
marginAdjusterToggle.addEventListener('change', () => {
  marginAdjusterEnabled = marginAdjusterToggle.checked;
  if (marginAdjusterEnabled) {
    marginAdjuster.classList.add('active');
    marginAdjuster.style.bottom = marginOffset + 'px';
    maxMargin = Math.floor(viewerText.clientHeight * 0.8);
  } else {
    marginAdjuster.classList.remove('active');
  }
  updateMarginAdjuster();
});

// 여백 조절기 업데이트
function updateMarginAdjuster() {
  if (marginOffset > 0) {
    viewerText.style.setProperty('padding-bottom', marginOffset + 'px', 'important');
    viewerText.style.setProperty('bottom', (40 + marginOffset) + 'px', 'important');
    viewerText.scrollTop = viewerText.scrollHeight;
  } else {
    viewerText.style.setProperty('padding-bottom', '0px', 'important');
    viewerText.style.setProperty('bottom', '40px', 'important');
    viewerText.scrollTop = viewerText.scrollHeight;
  }
}

// 드래그 이벤트
marginAdjuster.addEventListener('mousedown', e => {
  if (!marginAdjusterEnabled) return;
  isDragging = true;
  startY = e.clientY;
  startOffset = marginOffset;
  maxMargin = Math.floor(viewerText.clientHeight * 0.8);
  marginAdjuster.classList.add('dragging');
  ignoreNextClick = true;
  e.preventDefault();
});

document.addEventListener('mousemove', e => {
  if (!isDragging) return;
  const deltaY = startY - e.clientY;
  const newOffset = Math.max(0, Math.min(maxMargin, startOffset + deltaY));
  
  if (newOffset !== marginOffset) {
    marginOffset = newOffset;
    marginAdjuster.style.bottom = marginOffset + 'px';
    updateMarginAdjuster();
  }
});

document.addEventListener('mouseup', () => {
  if (isDragging) {
    isDragging = false;
    marginAdjuster.classList.remove('dragging');
    setTimeout(() => { ignoreNextClick = false; }, 100);
  }
});

// 전체화면 토글
document.body.addEventListener('click', e => {
  if (ignoreNextClick) {
    e.stopPropagation();
    e.preventDefault();
    ignoreNextClick = false;
    return;
  }
  if (isDragging) return;
  if (e.target.closest('#option-panel') || e.target.closest('#setting-icon')) return;
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
});

// 전체화면 상태 변경 감지
document.addEventListener('fullscreenchange', () => {
  if (document.fullscreenElement) {
    settingIcon.classList.add('fullscreen');
    optionPanel.classList.add('fullscreen');
  } else {
    settingIcon.classList.remove('fullscreen');
    optionPanel.classList.remove('fullscreen');
  }
});

// 옵션 적용 함수
function applyBasicOptions() {
  // 배경색에 투명도 적용
  const bgHex = document.getElementById('bgColor').value;
  const alpha = (parseInt(document.getElementById('bgAlpha').value) / 100).toFixed(2);
  const r = parseInt(bgHex.slice(1, 3), 16);
  const g = parseInt(bgHex.slice(3, 5), 16);
  const b = parseInt(bgHex.slice(5, 7), 16);
  document.getElementById('viewer').style.background = `rgba(${r}, ${g}, ${b}, ${alpha})`;
  
  viewerText.style.color = document.getElementById('fontColor').value;
  viewerText.style.fontSize = document.getElementById('fontSize').value + 'px';
  viewerText.style.fontFamily = document.getElementById('fontFamily').value;
  viewerText.style.letterSpacing = document.getElementById('letterSpacing').value + 'px';
  viewerText.style.lineHeight = document.getElementById('lineHeight').value;
  
  // 상단/하단 여백 적용
  const topMargin = parseInt(document.getElementById('marginTop').value) || 0;
  const bottomMargin = parseInt(document.getElementById('marginBottom').value) || 0;
  
  viewerText.style.top = (40 + topMargin) + 'px';
  viewerText.style.bottom = (40 + bottomMargin + marginOffset) + 'px';
  viewerText.style.height = `calc(100% - ${80 + topMargin + bottomMargin + marginOffset}px)`;
  
  // 테두리 적용
  const outlineOn = document.getElementById('outlineOn').checked;
  const outlineColor = document.getElementById('outlineColor').value;
  const outlineWidth = document.getElementById('outlineWidth').value;
  
  // 그림자 적용
  const shadowOn = document.getElementById('shadowOn').checked;
  const shadowColor = document.getElementById('shadowColor').value;
  const shadowBlur = document.getElementById('shadowBlur').value;
  const shadowDistance = document.getElementById('shadowDistance').value;
  
  let textShadow = '';
  
  if (outlineOn && parseFloat(outlineWidth) > 0) {
    const outline = `-${outlineWidth}px -${outlineWidth}px 0 ${outlineColor}, ${outlineWidth}px -${outlineWidth}px 0 ${outlineColor}, -${outlineWidth}px ${outlineWidth}px 0 ${outlineColor}, ${outlineWidth}px ${outlineWidth}px 0 ${outlineColor}`;
    textShadow = outline;
  }
  
  if (shadowOn && parseFloat(shadowDistance) > 0) {
    const dropShadow = `${shadowDistance}px ${shadowDistance}px ${shadowBlur}px ${shadowColor}`;
    textShadow = textShadow ? textShadow + ', ' + dropShadow : dropShadow;
  }
  
  viewerText.style.textShadow = textShadow;
  updateMarginAdjuster();
}

// 설정 변경 이벤트 리스너들
document.getElementById('bgColor').addEventListener('input', applyBasicOptions);
document.getElementById('bgAlpha').addEventListener('input', applyBasicOptions);
document.getElementById('fontColor').addEventListener('input', applyBasicOptions);
document.getElementById('fontSize').addEventListener('input', applyBasicOptions);
document.getElementById('fontFamily').addEventListener('change', applyBasicOptions);
document.getElementById('letterSpacing').addEventListener('input', applyBasicOptions);
document.getElementById('lineHeight').addEventListener('input', applyBasicOptions);
document.getElementById('marginTop').addEventListener('input', applyBasicOptions);
document.getElementById('marginBottom').addEventListener('input', applyBasicOptions);
document.getElementById('outlineOn').addEventListener('change', applyBasicOptions);
document.getElementById('outlineColor').addEventListener('input', applyBasicOptions);
document.getElementById('outlineWidth').addEventListener('input', applyBasicOptions);
document.getElementById('shadowOn').addEventListener('change', applyBasicOptions);
document.getElementById('shadowColor').addEventListener('input', applyBasicOptions);
document.getElementById('shadowBlur').addEventListener('input', applyBasicOptions);
document.getElementById('shadowDistance').addEventListener('input', applyBasicOptions);

// 숫자 조절 버튼들
document.getElementById('fontSizeUp').addEventListener('click', () => {
  const input = document.getElementById('fontSize');
  input.value = Math.min(200, Number(input.value) + 1);
  applyBasicOptions();
});

document.getElementById('fontSizeDown').addEventListener('click', () => {
  const input = document.getElementById('fontSize');
  input.value = Math.max(10, Number(input.value) - 1);
  applyBasicOptions();
});

document.getElementById('letterSpacingUp').addEventListener('click', () => {
  const input = document.getElementById('letterSpacing');
  input.value = Math.min(20, Number(input.value) + 0.5).toFixed(1);
  applyBasicOptions();
});

document.getElementById('letterSpacingDown').addEventListener('click', () => {
  const input = document.getElementById('letterSpacing');
  input.value = Math.max(-5, Number(input.value) - 0.5).toFixed(1);
  applyBasicOptions();
});

document.getElementById('lineHeightUp').addEventListener('click', () => {
  const input = document.getElementById('lineHeight');
  input.value = Math.min(3, Number(input.value) + 0.1).toFixed(1);
  applyBasicOptions();
});

document.getElementById('lineHeightDown').addEventListener('click', () => {
  const input = document.getElementById('lineHeight');
  input.value = Math.max(1, Number(input.value) - 0.1).toFixed(1);
  applyBasicOptions();
});

document.getElementById('marginTopUp').addEventListener('click', () => {
  const input = document.getElementById('marginTop');
  input.value = Math.min(200, Number(input.value) + 5);
  applyBasicOptions();
});

document.getElementById('marginTopDown').addEventListener('click', () => {
  const input = document.getElementById('marginTop');
  input.value = Math.max(0, Number(input.value) - 5);
  applyBasicOptions();
});

document.getElementById('marginBottomUp').addEventListener('click', () => {
  const input = document.getElementById('marginBottom');
  input.value = Math.min(400, Number(input.value) + 5);
  applyBasicOptions();
});

document.getElementById('marginBottomDown').addEventListener('click', () => {
  const input = document.getElementById('marginBottom');
  input.value = Math.max(0, Number(input.value) - 5);
  applyBasicOptions();
});

document.getElementById('outlineWidthUp').addEventListener('click', () => {
  const input = document.getElementById('outlineWidth');
  input.value = Math.min(10, Number(input.value) + 0.1).toFixed(1);
  applyBasicOptions();
});

document.getElementById('outlineWidthDown').addEventListener('click', () => {
  const input = document.getElementById('outlineWidth');
  input.value = Math.max(0, Number(input.value) - 0.1).toFixed(1);
  applyBasicOptions();
});

document.getElementById('shadowBlurUp').addEventListener('click', () => {
  const input = document.getElementById('shadowBlur');
  input.value = Math.min(20, Number(input.value) + 0.5).toFixed(1);
  applyBasicOptions();
});

document.getElementById('shadowBlurDown').addEventListener('click', () => {
  const input = document.getElementById('shadowBlur');
  input.value = Math.max(0, Number(input.value) - 0.5).toFixed(1);
  applyBasicOptions();
});

document.getElementById('shadowDistanceUp').addEventListener('click', () => {
  const input = document.getElementById('shadowDistance');
  input.value = Math.min(10, Number(input.value) + 0.5).toFixed(1);
  applyBasicOptions();
});

document.getElementById('shadowDistanceDown').addEventListener('click', () => {
  const input = document.getElementById('shadowDistance');
  input.value = Math.max(0, Number(input.value) - 0.5).toFixed(1);
  applyBasicOptions();
});

// ESC 키로 패널 닫기
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && optionPanel.classList.contains('open')) {
    optionPanel.classList.remove('open');
  }
});

// ========== 초기화 ==========
window.addEventListener('load', () => {
  console.log('[App] 초기화 시작');
  console.log('[App] 채널 코드:', channelCode);
  
  // 초기 설정 적용
  applyBasicOptions();
  
  // Socket 연결 시작
  initSocket();
});

// 페이지 언로드 시 정리
window.addEventListener('beforeunload', () => {
  stopKeepalive();
  if (socket) {
    socket.disconnect();
  }
});
  </script>
</body>
</html>
