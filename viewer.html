<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì†ê¸° ë·°ì–´</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Jua&family=Do+Hyeon&family=Nanum+Gothic&family=Nanum+Myeongjo&family=Nanum+Pen+Script&family=Gothic+A1&family=IBM+Plex+Sans+KR&display=swap" rel="stylesheet">
  <style>
    html, body {
      width: 100vw; height: 100vh; margin: 0; padding: 0;
      background: #000; color: #fff; overflow: hidden;
    }
    #viewer {
      position: relative;
      width: 100vw; height: 100vh;
      font-size: 32px; line-height: 1.5; text-align: left;
      transition: background 0.3s;
      z-index: 1;
      padding: 40px 30px;
      box-sizing: border-box;
    }
    #viewer-text {
      position: absolute;
      top: 40px; left: 30px; right: 30px; bottom: 40px;
      width: calc(100% - 60px);
      height: calc(100% - 80px);
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #8884 #0000;
      background: none;
      word-break: break-all;
      white-space: pre-wrap;
      padding: 0;
      font-size: inherit;
      font-family: inherit;
      color: inherit;
      text-align: inherit;
      line-height: inherit;
      transition: color 0.2s, background 0.2s;
      box-sizing: border-box;
    }
    #viewer-text::-webkit-scrollbar {
      width: 8px;
      background: transparent;
    }
    #viewer-text::-webkit-scrollbar-thumb {
      background: rgba(180,180,180,0.18);
      border-radius: 4px;
    }
    
    /* ì„¤ì • ì•„ì´ì½˜ */
    #setting-icon {
      position: fixed;
      top: 18px; left: 50%; transform: translateX(-50%);
      width: 44px; height: 44px;
      background: rgba(45,45,45,0.9);
      border: 1px solid #444;
      border-radius: 8px;
      z-index: 1000;
      transition: all 0.3s ease;
      opacity: 0;
      pointer-events: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-family: 'Consolas', 'Courier New', monospace;
    }
    #setting-icon.visible {
      opacity: 1;
    }
    #setting-icon:hover {
      background: rgba(58,58,58,0.95);
      border-color: #5a78ff;
      box-shadow: 0 4px 16px rgba(90,120,255,0.2);
    }
    #setting-icon svg { 
      width: 24px; height: 24px; 
      fill: #a2c1ff; 
      transition: fill 0.2s ease;
    }
    #setting-icon:hover svg { 
      fill: #fff; 
    }
    /* ì „ì²´í™”ë©´ì¼ ë•Œ ì„¤ì • ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
    #setting-icon.fullscreen {
      top: 70px;
      width: 56px; 
      height: 56px;
    }
    #setting-icon.fullscreen svg {
      width: 32px; 
      height: 32px;
    }
    
    /* ì˜µì…˜ íŒ¨ë„ */
    #option-panel {
      position: fixed;
      top: -500%;  /* ê¸°ë³¸ì ìœ¼ë¡œ ì™„ì „íˆ ìˆ¨ê¹€ */
      left: 50%; 
      transform: translateX(-50%);
      min-width: 420px;
      max-width: 480px;
      background: #1e1e1e;
      border: 2px solid #333;
      border-radius: 0 0 12px 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.8);
      padding: 0;
      display: flex; 
      flex-direction: column;
      transition: top 0.4s cubic-bezier(0.4,1.6,0.4,1);
      z-index: 20;
      pointer-events: auto;
      font-family: 'Consolas', 'Courier New', monospace;
      font-size: 13px;
      color: #e0e0e0;
    }
    #option-panel.open { 
      top: 0;  /* ì—´ë¦´ ë•Œ í‘œì‹œ */
    }
    /* ì „ì²´í™”ë©´ì¼ ë•Œ ì˜µì…˜ íŒ¨ë„ ìœ„ì¹˜ ì¡°ì • */
    #option-panel.fullscreen {
      top: -500%;  /* ì „ì²´í™”ë©´ì—ì„œë„ ì™„ì „íˆ ìˆ¨ê¹€ */
    }
    #option-panel.fullscreen.open {
      top: 70px;  /* ì „ì²´í™”ë©´ì—ì„œ ì—´ë¦´ ë•Œ ìœ„ì¹˜ */
    }
    
    /* íŒ¨ë„ í—¤ë” */
    .panel-header {
      background: #252526;
      padding: 12px 16px;
      border-bottom: 1px solid #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .panel-header::before {
      content: "âš™";
      font-size: 16px;
      color: #5a78ff;
    }
    .panel-title {
      font-weight: 600;
      color: #fff;
      font-size: 14px;
      letter-spacing: 0.5px;
    }
    
    /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
    .tab-nav {
      display: flex;
      background: #2d2d2d;
      border-bottom: 1px solid #333;
    }
    .tab-btn {
      flex: 1;
      padding: 10px 16px;
      background: none;
      border: none;
      color: #a0a0a0;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: relative;
    }
    .tab-btn:hover {
      color: #fff;
      background: #383838;
    }
    .tab-btn.active {
      color: #5a78ff;
      background: #1e1e1e;
    }
    .tab-btn.active::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: #5a78ff;
    }
    
    /* íƒ­ ì½˜í…ì¸  */
    .tab-content {
      display: none;
      max-height: 50vh;
      overflow-y: auto;
      padding: 8px 0;
    }
    .tab-content.active {
      display: block;
    }
    .tab-content::-webkit-scrollbar {
      width: 8px;
      background: #1e1e1e;
    }
    .tab-content::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 4px;
    }
    
    fieldset.option-group {
      border: 1px solid #444;
      border-radius: 6px;
      margin: 8px 16px;
      padding: 12px 16px 8px 16px;
      background: #232323;
    }
    legend {
      color: #5a78ff; 
      font-size: 12px; 
      font-weight: 600;
      padding: 4px 12px;
      background: #2d2d2d;
      border: 1px solid #444;
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .option-row {
      display: grid;
      grid-template-columns: 80px 1fr auto;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
      padding: 8px 0;
      border-bottom: 1px solid #2a2a2a;
      min-height: 32px;
    }
    .option-row:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    .option-row.wide {
      grid-template-columns: 80px 1fr 50px 24px 24px;
      gap: 8px;
    }
    .option-row label {
      color: #a2c1ff; 
      font-size: 12px;
      font-weight: 500;
      text-align: left;
      white-space: nowrap;
      text-transform: capitalize;
      line-height: 1.2;
    }
    .option-row input[type="color"] {
      width: 36px; 
      height: 32px; 
      border: 1px solid #444; 
      background: #181818; 
      cursor: pointer;
      border-radius: 4px;
      padding: 2px;
      transition: border-color 0.2s ease;
      vertical-align: middle;
    }
    .option-row input[type="checkbox"] {
      width: 18px; 
      height: 18px;
      accent-color: #5a78ff;
      cursor: pointer;
      vertical-align: middle;
    }
    .option-row input[type="number"]::-webkit-inner-spin-button,
    .option-row input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
      display: none;
    }
    .option-row input[type="number"] {
      width: 50px; 
      height: 28px;
      font-size: 12px; 
      padding: 0 6px; 
      border-radius: 4px; 
      border: 1px solid #444;
      background: #181818; 
      color: #e0e0e0; 
      text-align: center;
      font-family: inherit;
      transition: all 0.2s ease;
      line-height: 1;
      box-sizing: border-box;
      -moz-appearance: textfield;
    }
    .option-row input[type="number"]:focus {
      outline: none;
      border-color: #5a78ff;
      box-shadow: 0 0 0 2px rgba(90,120,255,0.2);
    }
    .option-row select {
      height: 32px;
      font-size: 12px; 
      border-radius: 4px; 
      border: 1px solid #444;
      background: #181818; 
      color: #e0e0e0; 
      padding: 6px 8px;
      font-family: inherit;
      transition: all 0.2s ease;
      box-sizing: border-box;
    }
    .option-row select:focus {
      outline: none;
      border-color: #5a78ff;
      box-shadow: 0 0 0 2px rgba(90,120,255,0.2);
    }
    .option-row input[type="range"] {
      width: 100px;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: #444;
      border-radius: 3px;
      outline: none;
      vertical-align: middle;
    }
    .option-row input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: #5a78ff;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .option-row input[type="range"]::-webkit-slider-thumb:hover {
      background: #7b9eff;
      transform: scale(1.1);
    }
    .option-row .num-btns {
      display: flex; 
      flex-direction: column; 
      gap: 1px;
      justify-self: end;
    }
    .option-row .num-btns button {
      width: 24px; 
      height: 14px; 
      font-size: 10px; 
      border: none; 
      background: #3a3a3a; 
      color: #ccc;
      border-radius: 2px; 
      cursor: pointer; 
      padding: 0;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: inherit;
      line-height: 1;
    }
    .option-row .num-btns button:hover { 
      background: #5a78ff; 
      color: #fff;
      transform: scale(1.05);
    }
    .unit-label {
      color: #888;
      font-size: 11px;
      line-height: 1;
      vertical-align: middle;
      justify-self: start;
    }
    
    /* Display ì„¹ì…˜ íŠ¹ë³„ ì²˜ë¦¬ */
    .display-group .option-row.wide {
      display: grid;
      grid-template-columns: 80px auto 50px 50px;
      align-items: center;
      gap: 8px;
    }
    .display-group .option-row.wide input[type="number"] {
      grid-column: 2;
      justify-self: start;
      width: 50px;
    }
    .display-group .option-row.wide .unit-label {
      grid-column: 3;
      justify-self: start;
    }
    .display-group .option-row.wide .num-btns {
      grid-column: 4;
      justify-self: center;
    }
    
    /* Layout ì„¹ì…˜ íŠ¹ë³„ ì²˜ë¦¬ */
    .layout-group .option-row.wide {
      display: grid;
      grid-template-columns: 80px auto 50px 50px;
      align-items: center;
      gap: 8px;
    }
    .layout-group .option-row.wide input[type="number"] {
      grid-column: 2;
      justify-self: start;
      width: 50px;
    }
    .layout-group .option-row.wide .unit-label {
      grid-column: 3;
      justify-self: start;
    }
    .layout-group .option-row.wide .num-btns {
      grid-column: 4;
      justify-self: center;
    }
    
    /* Effects ì„¹ì…˜ íŠ¹ë³„ ì²˜ë¦¬ */
    .effects-group .option-row {
      display: grid;
      grid-template-columns: 80px auto 50px;
      align-items: center;
      gap: 12px;
    }
    .effects-group .option-row.wide {
      grid-template-columns: 80px auto 50px 50px;
      gap: 8px;
    }
    .effects-group .option-row input[type="checkbox"] {
      justify-self: start;
    }
    .effects-group .option-row input[type="color"] {
      grid-column: 3;
      justify-self: center;
    }
    .effects-group .option-row.wide input[type="number"] {
      grid-column: 2;
      justify-self: start;
      width: 50px;
    }
    .effects-group .option-row.wide .unit-label {
      grid-column: 3;
      justify-self: start;
    }
    .effects-group .option-row.wide .num-btns {
      grid-column: 4;
      justify-self: center;
    }
    
    /* ìƒ‰ìƒ í”„ë¦¬ì…‹ */
    .preset-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 8px 16px;
    }
    .preset-item {
      background: #232323;
      border: 2px solid #444;
      border-radius: 8px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 16px;
      min-height: 80px;
    }
    .preset-item:hover {
      border-color: #5a78ff;
      background: #2a2a2a;
    }
    .preset-item.active {
      border-color: #5a78ff;
      background: #2d3748;
      box-shadow: 0 0 0 2px rgba(90,120,255,0.3);
    }
    .preset-preview {
      width: 200px;
      height: 90px;
      border: 1px solid #555;
      border-radius: 6px;
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
    }
    .preset-bg {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
    }
    .preset-text {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 12px;
      font-weight: normal;
      font-family: sans-serif;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
      text-align: center;
      line-height: 1.3;
      padding: 8px;
      box-sizing: border-box;
      width: 100%;
    }
    .preset-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }
    .preset-name {
      font-size: 13px;
      color: #a2c1ff;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .preset-code {
      font-size: 11px;
      color: #888;
      font-family: monospace;
    }
    
    /* ì—¬ë°± ì¡°ì ˆê¸° */
    #margin-adjuster {
      position: fixed;
      left: 0;
      right: 0;
      height: 20px;
      background: linear-gradient(to bottom, transparent, rgba(90,120,255,0.2), rgba(90,120,255,0.5));
      border-top: 2px solid #5a78ff;
      cursor: ns-resize;
      z-index: 100;
      display: none;
      transition: all 0.2s ease;
      user-select: none;
    }
    #margin-adjuster.active {
      display: block;
    }
    #margin-adjuster:hover {
      background: linear-gradient(to bottom, transparent, rgba(90,120,255,0.4), rgba(90,120,255,0.7));
      border-top-color: #7b9eff;
    }
    #margin-adjuster.dragging {
      background: linear-gradient(to bottom, transparent, rgba(90,120,255,0.6), rgba(90,120,255,0.8));
      border-top-color: #fff;
    }
    #margin-adjuster::before {
      content: "â‹®â‹®â‹®";
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      color: #5a78ff;
      font-size: 12px;
      letter-spacing: 2px;
      pointer-events: none;
    }
    
    /* ë°˜ì‘í˜• */
    @media (max-width: 600px) {
      #option-panel { 
        min-width: 280px; 
        max-width: 320px;
        font-size: 12px;
      }
      #viewer { padding: 40px 20px; }
      #viewer-text { 
        top: 40px; left: 20px; right: 20px; bottom: 40px;
        width: calc(100% - 40px);
        height: calc(100% - 80px);
      }
      .preset-preview {
        width: 150px;
        height: 70px;
      }
      .preset-text {
        font-size: 10px;
      }
    }
    /* ===== ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ CSS (animation_demo.html ê¸°ë°˜) ===== */
    .shake { animation: shake 0.5s ease-in-out 3; }
    @keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-5px);} 75%{transform:translateX(5px);} }
    .fade-in { animation: fadeIn 2s ease-in-out; }
    @keyframes fadeIn { 0%{opacity:0;transform:translateY(20px);} 100%{opacity:1;transform:translateY(0);} }
    .zoom { animation: zoom 1.5s ease-in-out; }
    @keyframes zoom { 0%{transform:scale(0.8);} 50%{transform:scale(1.1);} 100%{transform:scale(1);} }
    .gradient-text { background:linear-gradient(45deg,#ff6b6b,#4ecdc4,#45b7d1,#96ceb4);background-size:300% 300%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:gradient-flow 3s ease infinite; }
    @keyframes gradient-flow { 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }
    .neon { color:#fff;text-shadow:0 0 5px #00ffff,0 0 10px #00ffff,0 0 15px #00ffff,0 0 20px #00ffff;animation:neon-flicker 2s infinite alternate; }
    @keyframes neon-flicker { 0%,100%{text-shadow:0 0 5px #00ffff,0 0 10px #00ffff,0 0 15px #00ffff,0 0 20px #00ffff;} 50%{text-shadow:0 0 2px #00ffff,0 0 5px #00ffff,0 0 8px #00ffff,0 0 12px #00ffff;} }
    .typewriter { border-right:3px solid #fff;animation:typewriter-blink 1s infinite; }
    @keyframes typewriter-blink { 0%,50%{border-color:#fff;} 51%,100%{border-color:transparent;} }
    .rotate { animation: rotate-360 2s ease-in-out; }
    @keyframes rotate-360 { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
    .slide-left { animation: slideLeft 1s ease-out; }
    @keyframes slideLeft { 0%{transform:translateX(100%);opacity:0;} 100%{transform:translateX(0);opacity:1;} }
    .slide-right { animation: slideRight 1s ease-out; }
    @keyframes slideRight { 0%{transform:translateX(-100%);opacity:0;} 100%{transform:translateX(0);opacity:1;} }
    .bg-party { background:linear-gradient(45deg,#ff6b6b,#4ecdc4,#45b7d1,#96ceb4);background-size:400% 400%;animation:bg-party 3s ease infinite; }
    @keyframes bg-party { 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }
    .wave-shadow { animation: wave-shadow 2s ease-in-out infinite; }
    @keyframes wave-shadow { 0%{text-shadow:2px 2px 4px rgba(255,255,255,0.3);} 50%{text-shadow:-2px -2px 8px rgba(255,255,255,0.6);} 100%{text-shadow:2px 2px 4px rgba(255,255,255,0.3);} }
    .blur-in { animation: blur-in 1.5s ease-out; }
    @keyframes blur-in { 0%{filter:blur(10px);opacity:0;} 100%{filter:blur(0px);opacity:1;} }
    .glitch { animation: glitch 1s ease-in-out 2; }
    @keyframes glitch { 0%{transform:translate(0);} 20%{transform:translate(-2px,2px);} 40%{transform:translate(-2px,-2px);} 60%{transform:translate(2px,2px);} 80%{transform:translate(2px,-2px);} 100%{transform:translate(0);} }
    /* ëˆ„ë½ëœ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
    .simple-particle { animation: particle-float 3s ease-in-out infinite; }
    @keyframes particle-float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-10px);} }
    .heart { animation: heartbeat 1.5s ease-in-out infinite; }
    @keyframes heartbeat { 0%{transform:scale(1);} 14%{transform:scale(1.1);} 28%{transform:scale(1);} 42%{transform:scale(1.1);} 70%{transform:scale(1);} }
    .stars { animation: twinkle 2s ease-in-out infinite; }
    @keyframes twinkle { 0%,100%{opacity:1;} 50%{opacity:0.5;} }
    .wave { animation: wave-motion 2s ease-in-out infinite; }
    @keyframes wave-motion { 0%,100%{transform:translateY(0);} 25%{transform:translateY(-5px);} 75%{transform:translateY(5px);} }
    
    /* íˆ¬ëª… ë°°ê²½ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
    body.transparent-mode {
        background: transparent !important;
    }

    body.transparent-mode #viewer {
        background: transparent !important;
    }

    body.transparent-mode #viewer-text {
        color: white !important;
        text-shadow: 
            -1px -1px 0 #000,
            1px -1px 0 #000,
            -1px 1px 0 #000,
            1px 1px 0 #000,
            0 0 2px rgba(0,0,0,1);
        -webkit-text-stroke: 0.5px black;
    }

    /* íˆ¬ëª… ëª¨ë“œì—ì„œ ì„¤ì • íŒ¨ë„ì€ ë¶ˆíˆ¬ëª…í•˜ê²Œ */
    body.transparent-mode #option-panel {
        background: rgba(30, 30, 30, 0.95) !important;
    }

    body.transparent-mode .option-group {
        background: rgba(35, 35, 35, 0.95) !important;
    }

    /* íˆ¬ëª… ëª¨ë“œì—ì„œ ì„¤ì • ì•„ì´ì½˜ */
    body.transparent-mode #setting-icon {
        background: rgba(45, 45, 45, 0.9) !important;
    }
  </style>
</head>
<body>
  <div id="viewer">
    <div id="viewer-text"></div>
    <div id="setting-icon" title="ì„¤ì •">
      <svg viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zm7.43-2.9l1.77-1.02a1 1 0 0 0 .37-1.36l-1.68-2.92a1 1 0 0 0-1.28-.46l-1.77 1.02a7.03 7.03 0 0 0-1.52-.88l-.27-2A1 1 0 0 0 13.5 3h-3a1 1 0 0 0-1 .88l-.27 2a7.03 7.03 0 0 0-1.52.88l-1.77-1.02a1 1 0 0 0-1.36.37l-1.68 2.92a1 1 0 0 0 .37 1.36l1.77 1.02c-.09.32-.16.65-.22.99l-2 .27A1 1 0 0 0 3 10.5v3a1 1 0 0 0 .88 1l2 .27c.06.34.13.67.22.99l-1.77 1.02a1 1 0 0 0-.37 1.36l1.68 2.92a1 1 0 0 0 1.28.46l1.77-1.02c.47.34.97.64 1.52.88l.27 2A1 1 0 0 0 10.5 21h3a1 1 0 0 0 1-.88l.27-2c.55-.24 1.05-.54 1.52-.88l1.77 1.02a1 1 0 0 0 1.36-.37l1.68-2.92a1 1 0 0 0-.37-1.36l-1.77-1.02c.09-.32.16-.65.22-.99l2-.27A1 1 0 0 0 21 13.5v-3a1 1 0 0 0-.88-1l-2-.27a7.03 7.03 0 0 0-.22-.99zM12 17a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/></svg>
    </div>
    
    <div id="option-panel">
      <div class="panel-header">
        <span class="panel-title">Viewer Settings</span>
      </div>
      
      <div class="tab-nav">
        <button class="tab-btn active" data-tab="tab1">ì„¤ì •</button>
        <button class="tab-btn" data-tab="tab2">í”„ë¦¬ì…‹</button>
      </div>
      
      <!-- íƒ­ 1: ê¸°ë³¸ ì„¤ì • -->
      <div id="tab1" class="tab-content active">
        <fieldset class="option-group display-group">
          <legend>Display</legend>
          <div class="option-row">
            <label>ë°°ê²½ìƒ‰</label>
            <input type="color" id="bgColor" value="#000000">
            <input type="range" id="bgAlpha" min="0" max="100" value="100">
          </div>
          <div class="option-row">
            <label>ê¸€ììƒ‰</label>
            <input type="color" id="fontColor" value="#ffffff">
          </div>
          <div class="option-row">
            <label>ê¸€ê¼´</label>
            <select id="fontFamily">
              <option value="sans-serif">ê¸°ë³¸ ê³ ë”•</option>
              <option value="serif">ê¸°ë³¸ ëª…ì¡°</option>
              <option value="monospace">ê³ ì •í­</option>
              <option value="'Noto Sans KR', sans-serif">Noto Sans KR</option>
              <option value="'Nanum Gothic', sans-serif">ë‚˜ëˆ”ê³ ë”•</option>
              <option value="'Nanum Myeongjo', serif">ë‚˜ëˆ”ëª…ì¡°</option>
              <option value="'Nanum Pen Script', cursive">ë‚˜ëˆ”íœì²´</option>
              <option value="'Jua', sans-serif">ì£¼ì•„ì²´</option>
              <option value="'Do Hyeon', sans-serif">ë„í˜„ì²´</option>
              <option value="'Gothic A1', sans-serif">ê³ ë”• A1</option>
              <option value="'IBM Plex Sans KR', sans-serif">IBM Plex í•œê¸€</option>
              <option value="'ë§‘ì€ ê³ ë”•', 'Malgun Gothic', sans-serif">ë§‘ì€ ê³ ë”•</option>
              <option value="'êµ´ë¦¼', Gulim, sans-serif">êµ´ë¦¼</option>
              <option value="'ë‹ì›€', Dotum, sans-serif">ë‹ì›€</option>
              <option value="'ë°”íƒ•', Batang, serif">ë°”íƒ•</option>
              <option value="Arial, sans-serif">Arial</option>
              <option value="'Times New Roman', serif">Times New Roman</option>
              <option value="Georgia, serif">Georgia</option>
              <option value="Verdana, sans-serif">Verdana</option>
            </select>
          </div>
          <div class="option-row">
            <label>ì»¤ìŠ¤í…€</label>
            <button type="button" id="addFontBtn" style="
              padding: 6px 12px;
              font-size: 11px;
              background: #444;
              color: #ccc;
              border: 1px solid #666;
              border-radius: 4px;
              cursor: pointer;
              transition: all 0.2s ease;
            ">í°íŠ¸ ì¶”ê°€</button>
            <span style="color: #888; font-size: 11px;">ì§ì ‘ ì…ë ¥</span>
          </div>
          <div class="option-row wide">
            <label>ê¸€ìí¬ê¸°</label>
            <input type="number" id="fontSize" min="10" max="200" value="32">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="fontSizeUp">â–²</button>
              <button type="button" id="fontSizeDown">â–¼</button>
            </div>
          </div>
        </fieldset>
        
        <fieldset class="option-group layout-group">
          <legend>Layout</legend>
          <div class="option-row">
            <label>ì—¬ë°±ì¡°ì ˆê¸°</label>
            <input type="checkbox" id="marginAdjusterToggle">
            <span style="color: #888; font-size: 11px; margin-left: 8px;">í•˜ë‹¨ ë“œë˜ê·¸ë°”</span>
          </div>
          <div class="option-row wide">
            <label>ìƒë‹¨ì—¬ë°±</label>
            <input type="number" id="marginTop" min="0" max="200" step="1" value="0">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="marginTopUp">â–²</button>
              <button type="button" id="marginTopDown">â–¼</button>
            </div>
          </div>
          <div class="option-row wide">
            <label>í•˜ë‹¨ì—¬ë°±</label>
            <input type="number" id="marginBottom" min="0" max="400" step="1" value="0">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="marginBottomUp">â–²</button>
              <button type="button" id="marginBottomDown">â–¼</button>
            </div>
          </div>
        </fieldset>
        
        <fieldset class="option-group effects-group">
          <legend>Effects</legend>
          <div class="option-row">
            <label>í…Œë‘ë¦¬</label>
            <input type="checkbox" id="outlineOn">
            <input type="color" id="outlineColor" value="#000000">
          </div>
          <div class="option-row wide">
            <label>êµµê¸°</label>
            <input type="number" id="outlineWidth" min="0" max="10" value="2" step="0.1">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="outlineWidthUp">â–²</button>
              <button type="button" id="outlineWidthDown">â–¼</button>
            </div>
          </div>
          <div class="option-row">
            <label>ê·¸ë¦¼ì</label>
            <input type="checkbox" id="shadowOn">
            <input type="color" id="shadowColor" value="#000000">
          </div>
          <div class="option-row wide">
            <label>íë¦¼</label>
            <input type="number" id="shadowBlur" min="0" max="20" value="3" step="0.5">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="shadowBlurUp">â–²</button>
              <button type="button" id="shadowBlurDown">â–¼</button>
            </div>
          </div>
          <div class="option-row wide">
            <label>ê±°ë¦¬</label>
            <input type="number" id="shadowDistance" min="0" max="10" value="2" step="0.5">
            <span class="unit-label">px</span>
            <div class="num-btns">
              <button type="button" id="shadowDistanceUp">â–²</button>
              <button type="button" id="shadowDistanceDown">â–¼</button>
            </div>
          </div>
        </fieldset>
      </div>
      
      <!-- íƒ­ 2: ìƒ‰ìƒ í”„ë¦¬ì…‹ -->
      <div id="tab2" class="tab-content">
        <fieldset class="option-group">
          <legend>Presets</legend>
          <div class="option-row">
            <label>í”„ë¦¬ì…‹ ì ìš©</label>
            <button type="button" id="resetPreset" style="
              padding: 6px 12px; 
              font-size: 11px; 
              background: #444; 
              color: #ccc; 
              border: 1px solid #666; 
              border-radius: 4px; 
              cursor: pointer;
              transition: all 0.2s ease;
            ">í•´ì œ</button>
            <span style="color: #888; font-size: 11px; margin-left: 8px;">ì›í´ë¦­ ì ìš©</span>
          </div>
        </fieldset>
        
        <div class="preset-grid">
          <!-- í¬ë¡œë§ˆí‚¤ í”„ë¦¬ì…‹ -->
          <div class="preset-item" data-preset="green-white">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #00FF00;"></div>
              <div class="preset-text" style="color: #FFFFFF;">ë¯¸ë¦¬ ë³´ê¸°<br>í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">í¬ë¡œë§ˆ ê·¸ë¦°</div>
              <div class="preset-code">#00FF00 / #FFFFFF</div>
            </div>
          </div>
          
          <div class="preset-item" data-preset="blue-white">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #0000FF;"></div>
              <div class="preset-text" style="color: #FFFFFF;">ë¯¸ë¦¬ ë³´ê¸°<br>í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">í¬ë¡œë§ˆ ë¸”ë£¨</div>
              <div class="preset-code">#0000FF / #FFFFFF</div>
            </div>
          </div>
          
          <div class="preset-item" data-preset="magenta-white">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #FF00FF;"></div>
              <div class="preset-text" style="color: #FFFFFF;">ë¯¸ë¦¬ ë³´ê¸°<br>í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">í¬ë¡œë§ˆ ë§ˆì  íƒ€</div>
              <div class="preset-code">#FF00FF / #FFFFFF</div>
            </div>
          </div>
          
          <!-- ê³ ëŒ€ë¹„ í”„ë¦¬ì…‹ -->
          <div class="preset-item" data-preset="black-white">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #000000;"></div>
              <div class="preset-text" style="color: #FFFFFF;">ë¯¸ë¦¬ ë³´ê¸°<br>í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">ë¸”ë™ + í™”ì´íŠ¸</div>
              <div class="preset-code">#000000 / #FFFFFF</div>
            </div>
          </div>
          
          <div class="preset-item" data-preset="navy-white">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #000080;"></div>
              <div class="preset-text" style="color: #FFFFFF;">ë¯¸ë¦¬ ë³´ê¸°<br>í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">ë„¤ì´ë¹„ + í™”ì´íŠ¸</div>
              <div class="preset-code">#000080 / #FFFFFF</div>
            </div>
          </div>
          
          <div class="preset-item" data-preset="white-black">
            <div class="preset-preview">
              <div class="preset-bg" style="background: #FFFFFF;"></div>
              <div class="preset-text" style="color: #000000;">ë¯¸ë¦¬ ë³´ê¸°<br>í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.</div>
            </div>
            <div class="preset-info">
              <div class="preset-name">í™”ì´íŠ¸ + ë¸”ë™</div>
              <div class="preset-code">#FFFFFF / #000000</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ì—¬ë°± ì¡°ì ˆê¸° -->
  <div id="margin-adjuster"></div>
 <script src="config.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
  <script>
  window.addEventListener('load', function() {
    // ê¸°ë³¸ ë³€ìˆ˜ë“¤
    const params = new URLSearchParams(window.location.search);
    const channel = params.get('channel') || 'default';
    const viewerText = document.getElementById('viewer-text');
   const socket = io(window.CONFIG.SOCKET_URL);
    console.log('[Socket] Connecting to:', window.CONFIG.SOCKET_URL);
// Socket ì—°ê²° ë””ë²„ê¹… ì½”ë“œ
socket.on('connect', () => {
    console.log('âœ… [Socket] ì—°ê²° ì„±ê³µ!');
    console.log('[Socket] Socket ID:', socket.id);
    console.log('[Socket] Transport:', socket.io.engine.transport.name);
});

socket.on('connect_error', (error) => {
    console.error('âŒ [Socket] ì—°ê²° ì—ëŸ¬:', error.message);
    console.error('[Socket] ì—ëŸ¬ íƒ€ì…:', error.type);
    console.error('[Socket] ì—ëŸ¬ ìƒì„¸:', error);
});

socket.on('disconnect', (reason) => {
    console.log('ğŸ”Œ [Socket] ì—°ê²° ëŠê¹€:', reason);
});

// ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥
console.log('=== VIEWER DEBUG INFO ===');
console.log('Current URL:', window.location.href);
console.log('Config:', window.CONFIG);
console.log('Socket URL:', window.CONFIG.SOCKET_URL);
console.log('Is Ngrok:', window.CONFIG.environment.isNgrok);
console.log('========================');


    // ì†ê¸°ì‚¬ì°½ ëª¨ë‹ˆí„°ë§ë·°ì–´ì™€ ë™ì¼í•œ ìƒíƒœ ê´€ë¦¬
    let accumulatedText = '';
let fullTextStorage = '';  // ì „ì²´ í…ìŠ¤íŠ¸ ë³´ì¡´ìš© ì¶”ê°€
    let activeStenographer = '1';
    let currentActiveInput = '';  // í˜„ì¬ ê¶Œí•œìì˜ ì‹¤ì‹œê°„ ì…ë ¥
    let lastProcessedText = '';   // ë§ˆì§€ë§‰ìœ¼ë¡œ ì²˜ë¦¬í•œ í…ìŠ¤íŠ¸

    // ===== ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±° ë³€í™˜ í•¨ìˆ˜ (animation_demo.html ê¸°ë°˜) =====
    function processRealisticEmotions(text) {
      let processedText = text;
      let effectClass = '';
      let svgElement = '';
      if (text.includes('(ì§„ë™)')) {
        processedText = text.replace(/\(ì§„ë™\)/g, 'ğŸ“³');
        effectClass = 'shake';
      } else if (text.includes('(í˜ì´ë“œ)')) {
        processedText = text.replace(/\(í˜ì´ë“œ\)/g, 'âœ¨');
        effectClass = 'fade-in';
      } else if (text.includes('(í™•ëŒ€)')) {
        processedText = text.replace(/\(í™•ëŒ€\)/g, 'ğŸ”');
        effectClass = 'zoom';
      } else if (text.includes('(ë¬´ì§€ê°œ)')) {
        processedText = text.replace(/\(ë¬´ì§€ê°œ\)/g, 'ğŸŒˆ');
        effectClass = 'gradient-text';
      } else if (text.includes('(ë„¤ì˜¨)')) {
        processedText = text.replace(/\(ë„¤ì˜¨\)/g, 'ğŸ’¡');
        effectClass = 'neon';
      } else if (text.includes('(íƒ€ìê¸°)')) {
        processedText = text.replace(/\(íƒ€ìê¸°\)/g, 'âŒ¨ï¸');
        effectClass = 'typewriter';
      } else if (text.includes('(íšŒì „)')) {
        processedText = text.replace(/\(íšŒì „\)/g, 'ğŸ”„');
        effectClass = 'rotate';
      } else if (text.includes('(ì™¼ìŠ¬ë¼ì´ë“œ)')) {
        processedText = text.replace(/\(ì™¼ìŠ¬ë¼ì´ë“œ\)/g, 'â†');
        effectClass = 'slide-left';
      } else if (text.includes('(ì˜¤ë¥¸ìŠ¬ë¼ì´ë“œ)')) {
        processedText = text.replace(/\(ì˜¤ë¥¸ìŠ¬ë¼ì´ë“œ\)/g, 'â†’');
        effectClass = 'slide-right';
      } else if (text.includes('(íŒŒí‹°)')) {
        processedText = text.replace(/\(íŒŒí‹°\)/g, 'ğŸ‰');
        effectClass = 'bg-party';
      } else if (text.includes('(íŒŒë™)')) {
        processedText = text.replace(/\(íŒŒë™\)/g, 'ã€°ï¸');
        effectClass = 'wave-shadow';
      } else if (text.includes('(íŒŒí‹°í´)')) {
        processedText = text.replace(/\(íŒŒí‹°í´\)/g, 'â­');
        effectClass = 'simple-particle';
      } else if (text.includes('(ë¸”ëŸ¬)')) {
        processedText = text.replace(/\(ë¸”ëŸ¬\)/g, 'ğŸ‘ï¸');
        effectClass = 'blur-in';
      } else if (text.includes('(ê¸€ë¦¬ì¹˜)')) {
        processedText = text.replace(/\(ê¸€ë¦¬ì¹˜\)/g, 'ğŸ“º');
        effectClass = 'glitch';
      } else if (text.includes('(í•˜íŠ¸)')) {
        svgElement = `<svg width="30" height="30" viewBox="0 0 24 24" style="display:inline-block;margin:0 5px;vertical-align:middle;"><path d="M12,21.35l-1.45-1.32C5.4,15.36,2,12.28,2,8.5 C2,5.42,4.42,3,7.5,3c1.74,0,3.41,0.81,4.5,2.09C13.09,3.81,14.76,3,16.5,3 C19.58,3,22,5.42,22,8.5c0,3.78-3.4,6.86-8.55,11.54L12,21.35z" fill="red"><animateTransform attributeName="transform" type="scale" values="1;1.2;1" dur="1s" repeatCount="indefinite"/></path></svg>`;
        processedText = text.replace(/\(í•˜íŠ¸\)/g, svgElement);
        effectClass = 'heart';
      } else if (text.includes('(ë³„)')) {
        svgElement = `<svg width="30" height="30" viewBox="0 0 24 24" style="display:inline-block;margin:0 5px;vertical-align:middle;"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.46,13.97L5.82,21L12,17.27Z" fill="gold"><animateTransform attributeName="transform" type="rotate" values="0 12 12;360 12 12" dur="2s" repeatCount="2"/><animate attributeName="fill" values="gold;yellow;gold" dur="1s" repeatCount="3"/></path></svg>`;
        processedText = text.replace(/\(ë³„\)/g, svgElement);
        effectClass = 'stars';
      } else if (text.includes('(íŒŒë„)')) {
        svgElement = `<svg width="50" height="25" viewBox="0 0 50 25" style="display:inline-block;margin:0 5px;vertical-align:middle;"><path d="M0,12 Q12,2 25,12 T50,12" stroke="cyan" stroke-width="2" fill="none"><animate attributeName="d" values="M0,12 Q12,2 25,12 T50,12;M0,12 Q12,22 25,12 T50,12;M0,12 Q12,2 25,12 T50,12" dur="2s" repeatCount="indefinite"/></path></svg>`;
        processedText = text.replace(/\(íŒŒë„\)/g, svgElement);
        effectClass = 'wave';
      } else if (text.includes('(í„ìŠ¤)')) {
        svgElement = `<svg width="40" height="40" viewBox="0 0 40 40" style="display:inline-block;margin:0 5px;vertical-align:middle;"><circle cx="20" cy="20" r="3" fill="lime"><animate attributeName="r" values="3;15;3" dur="1s" repeatCount="3"/><animate attributeName="opacity" values="1;0.2;1" dur="1s" repeatCount="3"/></circle><circle cx="20" cy="20" r="8" fill="none" stroke="lime" stroke-width="2"><animate attributeName="r" values="8;20;8" dur="1s" repeatCount="3"/><animate attributeName="opacity" values="0.8;0;0.8" dur="1s" repeatCount="3"/></circle></svg>`;
        processedText = text.replace(/\(í„ìŠ¤\)/g, svgElement);
        effectClass = 'neon';
      }
      return { text: processedText, effect: effectClass };
    }

    // 1ë‹¨ì–´ ì§€ì—° ì²˜ë¦¬ í•¨ìˆ˜
    function updateViewerDisplay(fullText, isImmediate = false) {
      let displayText = '';
      if (isImmediate) {
        displayText = fullText;
      } else {
        if (fullText.endsWith(' ')) {
          displayText = fullText;
        } else {
          const words = fullText.split(' ');
          if (words.length > 1) {
            displayText = words.slice(0, -1).join(' ') + ' ';
          } else {
            displayText = '';  // ì²« ë‹¨ì–´ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ
          }
        }
      }
      // ì• ë‹ˆë©”ì´ì…˜ ì´ëª¨ì§€/íš¨ê³¼ ì ìš©
      const { text, effect } = processRealisticEmotions(displayText);
      viewerText.innerHTML = text;
      viewerText.className = effect || '';
      updateMarginAdjuster();
    }

    // Socket ì´ë²¤íŠ¸
    socket.emit('join_channel', { 
      channel, 
      role: 'viewer',
      requestSync: true 
    });

socket.on('sync_accumulated', ({ accumulatedText: serverAccum }) => {
  accumulatedText = serverAccum || '';
  currentActiveInput = '';  
  updateViewerDisplay(accumulatedText, true);
  lastProcessedText = accumulatedText;
  console.log('[ë·°ì–´] ëˆ„ì  í…ìŠ¤íŠ¸ ë™ê¸°í™”:', accumulatedText.length + 'ì');
  
  // ì±„ë„ ìƒíƒœ ìš”ì²­ ì¶”ê°€
  socket.emit('get_channel_state', { channel });
});

// ìƒˆë¡œ ì¶”ê°€
socket.on('channel_state', ({ state }) => {
  if (state && state.activeStenographer) {
    activeStenographer = state.activeStenographer === 'steno1' ? '1' : '2';
    console.log('[ë·°ì–´] ê¶Œí•œì ì •ë³´ ìˆ˜ì‹ :', activeStenographer);
  }
});

    socket.on('role_assigned', ({ role }) => {
      activeStenographer = '1';
    });

    socket.on('steno_input', ({ role, text }) => {
      const roleNumber = role === 'steno1' ? '1' : 
                        role === 'steno2' ? '2' : 
                        role;
      
      if (roleNumber === activeStenographer) {
        // í˜„ì¬ ê¶Œí•œìì˜ ì…ë ¥ë§Œ ì²˜ë¦¬
        currentActiveInput = text;
        const fullText = accumulatedText + currentActiveInput;
        
        console.log('[ë·°ì–´] ì…ë ¥ ìˆ˜ì‹ :', {
          role,
          ì…ë ¥ê¸¸ì´: text.length,
          ëˆ„ì ê¸¸ì´: accumulatedText.length,
          ì „ì²´ê¸¸ì´: fullText.length
        });
        
        updateViewerDisplay(fullText, false);
        lastProcessedText = fullText;
      }
    });

    socket.on('switch_role', ({ newActive, accumulatedText: serverAccum, matchedText }) => {
      const previousActive = activeStenographer;
      activeStenographer = newActive === 'steno1' ? '1' : '2';
      
      console.log('[ë·°ì–´] ê¶Œí•œ ì „í™˜:', {
        ì´ì „ê¶Œí•œì: previousActive,
        ìƒˆê¶Œí•œì: activeStenographer,
        ë§¤ì¹­í…ìŠ¤íŠ¸ê¸¸ì´: matchedText ? matchedText.length : 0,
        ì„œë²„ëˆ„ì ê¸¸ì´: serverAccum ? serverAccum.length : 0
      });
      
      // ì„œë²„ì—ì„œ ë³´ë‚¸ ëˆ„ì  í…ìŠ¤íŠ¸ë¡œ ì—…ë°ì´íŠ¸
      if (typeof serverAccum === 'string') {
        accumulatedText = serverAccum;
        currentActiveInput = '';  // ê¶Œí•œ ì „í™˜ ì‹œ í˜„ì¬ ì…ë ¥ ì´ˆê¸°í™”
        updateViewerDisplay(accumulatedText, true);
        lastProcessedText = accumulatedText;
        
        console.log('[ë·°ì–´] ê¶Œí•œ ì „í™˜ í›„ ëˆ„ì  í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸:', accumulatedText.length + 'ì');
      }
    });
socket.on('text_sent', ({ accumulatedText: newAccumulated }) => {
  accumulatedText = newAccumulated || '';
  fullTextStorage = newAccumulated;  // ì „ì²´ í…ìŠ¤íŠ¸ ì €ì¥
  currentActiveInput = '';
  
  // viewer.htmlì€ ì „ì²´ í…ìŠ¤íŠ¸ í‘œì‹œ (30ì¤„ ì œí•œ ì—†ìŒ)
  const { text, effect } = processRealisticEmotions(fullTextStorage);
  viewerText.innerHTML = text;
  viewerText.className = effect || '';
  viewerText.scrollTop = viewerText.scrollHeight;
   // ì „ì†¡ í›„ í˜„ì¬ ì…ë ¥ ì´ˆê¸°í™”
  currentActiveInput = '';
  lastProcessedText = fullTextStorage;

  console.log('[ë·°ì–´] ì „ì†¡ ëª¨ë“œ - ì „ì²´ í…ìŠ¤íŠ¸:', fullTextStorage.length + 'ì');
});

    // UI ìš”ì†Œë“¤
    const settingIcon = document.getElementById('setting-icon');
    const optionPanel = document.getElementById('option-panel');
    const marginAdjusterToggle = document.getElementById('marginAdjusterToggle');
    const marginAdjuster = document.getElementById('margin-adjuster');

    // ì—¬ë°± ì¡°ì ˆê¸° ìƒíƒœ
    let marginAdjusterEnabled = false;
    let marginOffset = 0;
    let isDragging = false;
    let startY = 0;
    let startOffset = 0;
    let maxMargin = 0;
    let ignoreNextClick = false;

    // í¬ë¡œë§ˆí‚¤ í”„ë¦¬ì…‹ ë°ì´í„°
    const chromaPresets = {
      'green-white': { bg: '#00FF00', text: '#FFFFFF' },
      'blue-white': { bg: '#0000FF', text: '#FFFFFF' },
      'magenta-white': { bg: '#FF00FF', text: '#FFFFFF' },
      'black-white': { bg: '#000000', text: '#FFFFFF' },
      'navy-white': { bg: '#000080', text: '#FFFFFF' },
      'white-black': { bg: '#FFFFFF', text: '#000000' }
    };

    // ì„¤ì • ì•„ì´ì½˜ í‘œì‹œ
    let isMouseInTopArea = false;
    let isMouseOnIcon = false;
    
    // ì•„ì´ì½˜ í‘œì‹œ ì—¬ë¶€ ê²°ì • í•¨ìˆ˜
    function updateIconVisibility() {
      if (isMouseInTopArea || isMouseOnIcon || optionPanel.classList.contains('open')) {
        settingIcon.classList.add('visible');
      } else {
        settingIcon.classList.remove('visible');
      }
    }
    
    // ì „ì²´ ë¬¸ì„œì—ì„œ ë§ˆìš°ìŠ¤ ì›€ì§ì„ ê°ì§€
    document.addEventListener('mousemove', e => {
      isMouseInTopArea = e.clientY < 80;
      updateIconVisibility();
    });
    
    // ì„¤ì • ì•„ì´ì½˜ ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
    settingIcon.addEventListener('mouseenter', () => {
      isMouseOnIcon = true;
      updateIconVisibility();
    });
    
    settingIcon.addEventListener('mouseleave', () => {
      isMouseOnIcon = false;
      updateIconVisibility();
    });
    
    // ë§ˆìš°ìŠ¤ê°€ ë¸Œë¼ìš°ì € ë°–ìœ¼ë¡œ ë‚˜ê°”ì„ ë•Œ
    document.addEventListener('mouseleave', () => {
      isMouseInTopArea = false;
      isMouseOnIcon = false;
      if (!optionPanel.classList.contains('open')) {
        settingIcon.classList.remove('visible');
      }
    });

    // ì˜µì…˜ íŒ¨ë„ í† ê¸€
    settingIcon.addEventListener('click', e => {
      e.stopPropagation();
      optionPanel.classList.toggle('open');
      settingIcon.classList.add('visible');
    });

    // íƒ­ ê¸°ëŠ¥
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const targetTab = btn.dataset.tab;
        
        // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì½˜í…ì¸  ë¹„í™œì„±í™”
        tabBtns.forEach(b => b.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        // í´ë¦­í•œ íƒ­ í™œì„±í™”
        btn.classList.add('active');
        document.getElementById(targetTab).classList.add('active');
      });
    });

    // í¬ë¡œë§ˆí‚¤ í”„ë¦¬ì…‹ ì„ íƒ
    const presetItems = document.querySelectorAll('.preset-item');
    const resetPreset = document.getElementById('resetPreset');

    presetItems.forEach(item => {
      item.addEventListener('click', () => {
        const presetName = item.dataset.preset;
        const preset = chromaPresets[presetName];
        
        if (preset) {
          // ëª¨ë“  í”„ë¦¬ì…‹ ì•„ì´í…œ ë¹„í™œì„±í™”
          presetItems.forEach(p => p.classList.remove('active'));
          
          // í´ë¦­í•œ í”„ë¦¬ì…‹ í™œì„±í™”
          item.classList.add('active');
          
          // ë°°ê²½ìƒ‰ê³¼ ê¸€ììƒ‰ ì ìš©
          document.getElementById('bgColor').value = preset.bg;
          document.getElementById('fontColor').value = preset.text;
          
          // ì„¤ì • ì ìš©
          applyBasicOptions();
        }
      });
    });

    // í”„ë¦¬ì…‹ í•´ì œ ë²„íŠ¼
    resetPreset.addEventListener('click', () => {
      // ëª¨ë“  í”„ë¦¬ì…‹ ë¹„í™œì„±í™”
      presetItems.forEach(p => p.classList.remove('active'));
      
      // ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›
      document.getElementById('bgColor').value = '#000000';
      document.getElementById('fontColor').value = '#FFFFFF';
      
      // ì„¤ì • ì ìš©
      applyBasicOptions();
    });

    resetPreset.addEventListener('mouseenter', () => {
      resetPreset.style.background = '#666';
      resetPreset.style.color = '#fff';
    });

    resetPreset.addEventListener('mouseleave', () => {
      resetPreset.style.background = '#444';
      resetPreset.style.color = '#ccc';
    });

    // í°íŠ¸ ì¶”ê°€ ê¸°ëŠ¥
    const addFontBtn = document.getElementById('addFontBtn');
    
    function checkFontAvailability(fontName) {
      // ê°„ë‹¨í•œ í°íŠ¸ ì¡´ì¬ í™•ì¸
      const testEl = document.createElement('span');
      testEl.style.position = 'absolute';
      testEl.style.left = '-9999px';
      testEl.style.visibility = 'hidden';
      testEl.style.fontFamily = `'${fontName}', '__DEFAULT__'`;
      testEl.style.fontSize = '72px';
      testEl.textContent = 'mmmmmmmmmmlli';
      document.body.appendChild(testEl);
      
      const width1 = testEl.offsetWidth;
      testEl.style.fontFamily = '__DEFAULT__';
      const width2 = testEl.offsetWidth;
      
      document.body.removeChild(testEl);
      return width1 !== width2;
    }
    
    addFontBtn.addEventListener('click', () => {
      const fontName = prompt(
        "ì¶”ê°€í•  í°íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:\n" +
        "(ì˜ˆ: Pretendard, ë‚˜ëˆ”ìŠ¤í€˜ì–´, ë°°ë‹¬ì˜ë¯¼ì¡± ì£¼ì•„)\n\n" +
        "â€» í•´ë‹¹ í°íŠ¸ê°€ ì‹œìŠ¤í…œì— ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤."
      );
      
      if (fontName && fontName.trim()) {
        const trimmedName = fontName.trim();
        const fontSelect = document.getElementById('fontFamily');
        
        // ì¤‘ë³µ í™•ì¸
        const exists = Array.from(fontSelect.options).some(opt => 
          opt.textContent === trimmedName
        );
        
        if (!exists) {
          const option = document.createElement('option');
          // í´ë°± í°íŠ¸ ìë™ ì¶”ê°€
          option.value = `'${trimmedName}', sans-serif`;
          option.textContent = trimmedName;
          fontSelect.appendChild(option);
          fontSelect.value = option.value;
          applyBasicOptions();
          
          // í°íŠ¸ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ ì²´í¬ (ì•½ê°„ì˜ ì§€ì—° í›„)
          setTimeout(() => {
            if (!checkFontAvailability(trimmedName)) {
              alert(
                `âš ï¸ '${trimmedName}' í°íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n` +
                `ë‹¤ìŒì„ í™•ì¸í•´ì£¼ì„¸ìš”:\n` +
                `1. í°íŠ¸ëª…ì´ ì •í™•í•œì§€\n` +
                `2. ì‹œìŠ¤í…œì— ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€\n` +
                `3. ë¸Œë¼ìš°ì € ì¬ì‹œì‘ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`
              );
            } else {
              console.log(`âœ… '${trimmedName}' í°íŠ¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
          }, 100);
        } else {
          alert('ì´ë¯¸ ì¶”ê°€ëœ í°íŠ¸ì…ë‹ˆë‹¤.');
        }
      }
    });
    
    addFontBtn.addEventListener('mouseenter', () => {
      addFontBtn.style.background = '#666';
      addFontBtn.style.color = '#fff';
    });
    
    addFontBtn.addEventListener('mouseleave', () => {
      addFontBtn.style.background = '#444';
      addFontBtn.style.color = '#ccc';
    });

    // ì—¬ë°± ì¡°ì ˆê¸° í† ê¸€
    marginAdjusterToggle.addEventListener('change', () => {
      marginAdjusterEnabled = marginAdjusterToggle.checked;
      if (marginAdjusterEnabled) {
        marginAdjuster.classList.add('active');
        marginAdjuster.style.bottom = marginOffset + 'px';
        maxMargin = Math.floor(viewerText.clientHeight * 0.8);
      } else {
        marginAdjuster.classList.remove('active');
      }
      updateMarginAdjuster();
    });

    // ì—¬ë°± ì¡°ì ˆê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateMarginAdjuster() {
      if (marginOffset > 0) {
        viewerText.style.setProperty('padding-bottom', marginOffset + 'px', 'important');
        viewerText.style.setProperty('bottom', (40 + marginOffset) + 'px', 'important');
        viewerText.scrollTop = viewerText.scrollHeight;
      } else {
        viewerText.style.setProperty('padding-bottom', '0px', 'important');
        viewerText.style.setProperty('bottom', '40px', 'important');
        viewerText.scrollTop = viewerText.scrollHeight;
      }
    }

    // ë“œë˜ê·¸ ì´ë²¤íŠ¸
    marginAdjuster.addEventListener('mousedown', e => {
      if (!marginAdjusterEnabled) return;
      isDragging = true;
      startY = e.clientY;
      startOffset = marginOffset;
      maxMargin = Math.floor(viewerText.clientHeight * 0.8);
      marginAdjuster.classList.add('dragging');
      ignoreNextClick = true;
      e.preventDefault();
    });

    document.addEventListener('mousemove', e => {
      if (!isDragging) return;
      const deltaY = startY - e.clientY;
      const newOffset = Math.max(0, Math.min(maxMargin, startOffset + deltaY));
      
      if (newOffset !== marginOffset) {
        marginOffset = newOffset;
        marginAdjuster.style.bottom = marginOffset + 'px';
        updateMarginAdjuster();
      }
    });

    document.addEventListener('mouseup', () => {
      if (isDragging) {
        isDragging = false;
        marginAdjuster.classList.remove('dragging');
        setTimeout(() => { ignoreNextClick = false; }, 100);
      }
    });

    // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ ì§€ì›)
    marginAdjuster.addEventListener('touchstart', e => {
      if (!marginAdjusterEnabled) return;
      isDragging = true;
      startY = e.touches[0].clientY;
      startOffset = marginOffset;
      maxMargin = Math.floor(viewerText.clientHeight * 0.8);
      marginAdjuster.classList.add('dragging');
      e.preventDefault();
    });

    document.addEventListener('touchmove', e => {
      if (!isDragging) return;
      const deltaY = startY - e.touches[0].clientY;
      const newOffset = Math.max(0, Math.min(maxMargin, startOffset + deltaY));
      if (newOffset !== marginOffset) {
        marginOffset = newOffset;
        marginAdjuster.style.bottom = marginOffset + 'px';
        updateMarginAdjuster();
      }
      e.preventDefault();
    });

    document.addEventListener('touchend', () => {
      if (isDragging) {
        isDragging = false;
        marginAdjuster.classList.remove('dragging');
      }
    });

    // ì „ì²´í™”ë©´ í† ê¸€
    document.body.addEventListener('click', e => {
      if (ignoreNextClick) {
        e.stopPropagation();
        e.preventDefault();
        ignoreNextClick = false;
        return;
      }
      if (isDragging) return;
      if (e.target.closest('#option-panel') || e.target.closest('#setting-icon')) return;
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    });

    // ì „ì²´í™”ë©´ ìƒíƒœ ë³€ê²½ ê°ì§€
    document.addEventListener('fullscreenchange', () => {
      if (document.fullscreenElement) {
        settingIcon.classList.add('fullscreen');
        optionPanel.classList.add('fullscreen');
      } else {
        settingIcon.classList.remove('fullscreen');
        optionPanel.classList.remove('fullscreen');
      }
    });

    // ì˜µì…˜ ê¸°ëŠ¥ë“¤
    const bgColor = document.getElementById('bgColor');
    const bgAlpha = document.getElementById('bgAlpha');
    const fontColor = document.getElementById('fontColor');
    const fontSize = document.getElementById('fontSize');
    const fontSizeUp = document.getElementById('fontSizeUp');
    const fontSizeDown = document.getElementById('fontSizeDown');
    const fontFamily = document.getElementById('fontFamily');
    const marginTop = document.getElementById('marginTop');
    const marginBottom = document.getElementById('marginBottom');
    const marginTopUp = document.getElementById('marginTopUp');
    const marginTopDown = document.getElementById('marginTopDown');
    const marginBottomUp = document.getElementById('marginBottomUp');
    const marginBottomDown = document.getElementById('marginBottomDown');

    function applyBasicOptions() {
      // ë°°ê²½ìƒ‰ì— íˆ¬ëª…ë„ ì ìš©
      const bgHex = bgColor.value;
      const alpha = (parseInt(bgAlpha.value) / 100).toFixed(2);
      const r = parseInt(bgHex.slice(1, 3), 16);
      const g = parseInt(bgHex.slice(3, 5), 16);
      const b = parseInt(bgHex.slice(5, 7), 16);
      document.getElementById('viewer').style.background = `rgba(${r}, ${g}, ${b}, ${alpha})`;
      
      viewerText.style.color = fontColor.value;
      viewerText.style.fontSize = fontSize.value + 'px';
      viewerText.style.fontFamily = fontFamily.value;
      
      // ìƒë‹¨/í•˜ë‹¨ ì—¬ë°± ì ìš©
      const topMargin = parseInt(marginTop.value) || 0;
      const bottomMargin = parseInt(marginBottom.value) || 0;
      
      viewerText.style.top = (40 + topMargin) + 'px';
      viewerText.style.bottom = (40 + bottomMargin + marginOffset) + 'px';
      viewerText.style.height = `calc(100% - ${80 + topMargin + bottomMargin + marginOffset}px)`;
      
      // í…Œë‘ë¦¬ ì ìš©
      const outlineOn = document.getElementById('outlineOn').checked;
      const outlineColor = document.getElementById('outlineColor').value;
      const outlineWidth = document.getElementById('outlineWidth').value;
      
      // ê·¸ë¦¼ì ì ìš©
      const shadowOn = document.getElementById('shadowOn').checked;
      const shadowColor = document.getElementById('shadowColor').value;
      const shadowBlur = document.getElementById('shadowBlur').value;
      const shadowDistance = document.getElementById('shadowDistance').value;
      
      let textShadow = '';
      
      if (outlineOn && parseFloat(outlineWidth) > 0) {
        // í…Œë‘ë¦¬ íš¨ê³¼ (4ë°©í–¥ ê·¸ë¦¼ìë¡œ êµ¬í˜„)
        const outline = `-${outlineWidth}px -${outlineWidth}px 0 ${outlineColor}, ${outlineWidth}px -${outlineWidth}px 0 ${outlineColor}, -${outlineWidth}px ${outlineWidth}px 0 ${outlineColor}, ${outlineWidth}px ${outlineWidth}px 0 ${outlineColor}`;
        textShadow = outline;
      }
      
      if (shadowOn && parseFloat(shadowDistance) > 0) {
        // ë“œë¡­ ê·¸ë¦¼ì íš¨ê³¼
        const dropShadow = `${shadowDistance}px ${shadowDistance}px ${shadowBlur}px ${shadowColor}`;
        textShadow = textShadow ? textShadow + ', ' + dropShadow : dropShadow;
      }
      
      viewerText.style.textShadow = textShadow;
      updateMarginAdjuster();
    }

    bgColor.addEventListener('input', applyBasicOptions);
    bgAlpha.addEventListener('input', applyBasicOptions);
    fontColor.addEventListener('input', applyBasicOptions);
    fontSize.addEventListener('input', applyBasicOptions);
    fontFamily.addEventListener('change', applyBasicOptions);
    marginTop.addEventListener('input', applyBasicOptions);
    marginBottom.addEventListener('input', applyBasicOptions);

    fontSizeUp.addEventListener('click', () => {
      fontSize.value = Math.min(200, Number(fontSize.value) + 1);
      applyBasicOptions();
    });
    fontSizeDown.addEventListener('click', () => {
      fontSize.value = Math.max(10, Number(fontSize.value) - 1);
      applyBasicOptions();
    });

    marginTopUp.addEventListener('click', () => {
      marginTop.value = Math.min(200, Number(marginTop.value) + 5);
      applyBasicOptions();
    });
    marginTopDown.addEventListener('click', () => {
      marginTop.value = Math.max(0, Number(marginTop.value) - 5);
      applyBasicOptions();
    });

    marginBottomUp.addEventListener('click', () => {
      marginBottom.value = Math.min(400, Number(marginBottom.value) + 5);
      applyBasicOptions();
    });
    marginBottomDown.addEventListener('click', () => {
      marginBottom.value = Math.max(0, Number(marginBottom.value) - 5);
      applyBasicOptions();
    });

    // í…Œë‘ë¦¬ ì˜µì…˜ ì´ë²¤íŠ¸
    const outlineOn = document.getElementById('outlineOn');
    const outlineColor = document.getElementById('outlineColor');
    const outlineWidth = document.getElementById('outlineWidth');
    const outlineWidthUp = document.getElementById('outlineWidthUp');
    const outlineWidthDown = document.getElementById('outlineWidthDown');

    outlineOn.addEventListener('change', applyBasicOptions);
    outlineColor.addEventListener('input', applyBasicOptions);
    outlineWidth.addEventListener('input', applyBasicOptions);

    outlineWidthUp.addEventListener('click', () => {
      outlineWidth.value = Math.min(10, Number(outlineWidth.value) + 0.1).toFixed(1);
      applyBasicOptions();
    });
    outlineWidthDown.addEventListener('click', () => {
      outlineWidth.value = Math.max(0, Number(outlineWidth.value) - 0.1).toFixed(1);
      applyBasicOptions();
    });

    // ê·¸ë¦¼ì ì˜µì…˜ ì´ë²¤íŠ¸
    const shadowOn = document.getElementById('shadowOn');
    const shadowColor = document.getElementById('shadowColor');
    const shadowBlur = document.getElementById('shadowBlur');
    const shadowDistance = document.getElementById('shadowDistance');
    const shadowBlurUp = document.getElementById('shadowBlurUp');
    const shadowBlurDown = document.getElementById('shadowBlurDown');
    const shadowDistanceUp = document.getElementById('shadowDistanceUp');
    const shadowDistanceDown = document.getElementById('shadowDistanceDown');

    shadowOn.addEventListener('change', applyBasicOptions);
    shadowColor.addEventListener('input', applyBasicOptions);
    shadowBlur.addEventListener('input', applyBasicOptions);
    shadowDistance.addEventListener('input', applyBasicOptions);

    shadowBlurUp.addEventListener('click', () => {
      shadowBlur.value = Math.min(20, Number(shadowBlur.value) + 0.5).toFixed(1);
      applyBasicOptions();
    });
    shadowBlurDown.addEventListener('click', () => {
      shadowBlur.value = Math.max(0, Number(shadowBlur.value) - 0.5).toFixed(1);
      applyBasicOptions();
    });

    shadowDistanceUp.addEventListener('click', () => {
      shadowDistance.value = Math.min(10, Number(shadowDistance.value) + 0.5).toFixed(1);
      applyBasicOptions();
    });
    shadowDistanceDown.addEventListener('click', () => {
      shadowDistance.value = Math.max(0, Number(shadowDistance.value) - 0.5).toFixed(1);
      applyBasicOptions();
    });

    // ì´ˆê¸° ì„¤ì • ì ìš©
    applyBasicOptions();

    // íˆ¬ëª… ëª¨ë“œ ë©”ì‹œì§€ ìˆ˜ì‹ 
    window.addEventListener('message', (e) => {
      if (e.data.type === 'set-transparent') {
        if (e.data.transparent) {
          document.body.classList.add('transparent-mode');
          
          // íˆ¬ëª… ëª¨ë“œì—ì„œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë®ì–´ì“°ê¸°
          document.getElementById('bgAlpha').value = '0';
          applyBasicOptions();
          
          console.log('[ë·°ì–´] íˆ¬ëª… ëª¨ë“œ í™œì„±í™”');
        } else {
          document.body.classList.remove('transparent-mode');
          
          // ë¶ˆíˆ¬ëª… ëª¨ë“œë¡œ ë³µì›
          document.getElementById('bgAlpha').value = '100';
          applyBasicOptions();
          
          console.log('[ë·°ì–´] íˆ¬ëª… ëª¨ë“œ ë¹„í™œì„±í™”');
        }
      }
      
      // ë·°ì–´ ì¤€ë¹„ ìƒíƒœ ì•Œë¦¼
      if (e.data.type === 'check-ready') {
        e.source.postMessage({ type: 'viewer-ready' }, '*');
      }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¤€ë¹„ ìƒíƒœ ì•Œë¦¼
   if (window.parent !== window) {
    window.parent.postMessage({ type: 'viewer-ready' }, '*');
  }
});  // â† ì—¬ê¸°ì„œ ë‹«ê¸°
</script>
</body>
</html>