<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Jua&family=Do+Hyeon&family=Nanum+Gothic&family=Nanum+Myeongjo&family=Nanum+Pen+Script&family=Gothic+A1&family=IBM+Plex+Sans+KR&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* ê¸°ë³¸ ë°°ê²½ - íˆ¬ëª…ì°½ì„ ìœ„í•´ rgba ì‚¬ìš© */
        html {
            background: rgba(0, 0, 0, 1);
        }
        
        body {
            width: 100vw; 
            height: 100vh; 
            margin: 0; 
            padding: 0;
            background: rgba(0, 0, 0, 1); 
            color: #fff; 
            overflow: hidden;
        }
        
        /* ì—°ê²° ìƒíƒœ í‘œì‹œ */
        #connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-family: 'Noto Sans KR', sans-serif;
            z-index: 10001;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #connection-status.connecting {
            background: rgba(255, 193, 7, 0.9);
            color: #000;
        }
        
        #connection-status.connected {
            background: rgba(40, 167, 69, 0.9);
            color: #fff;
        }
        
        #connection-status.disconnected {
            background: rgba(220, 53, 69, 0.9);
            color: #fff;
        }
        
        #connection-status .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* ë“œë˜ê·¸ í—¤ë” - ìƒë‹¨ 20pxë§Œ ë“œë˜ê·¸ ê°€ëŠ¥ */
        .drag-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: transparent;
            -webkit-app-region: drag;
            z-index: 9999;
            transition: background 0.3s ease;
        }
        
        /* í…Œë‘ë¦¬ í‘œì‹œ ì‹œ ë“œë˜ê·¸ í—¤ë” ë³´ì´ê¸° */
        body.show-border .drag-header {
            background: rgba(0, 212, 255, 0.2);  /* ë°˜íˆ¬ëª… ì‚¬ì´ë²„ ë¸”ë£¨ */
            border-bottom: 1px solid rgba(0, 212, 255, 0.5);
        }
        
        /* íˆ¬ëª… ëª¨ë“œ + í…Œë‘ë¦¬ í‘œì‹œ ì‹œ */
        body.transparent-mode.show-border .drag-header {
            background: rgba(0, 212, 255, 0.15);  /* ë” íˆ¬ëª…í•˜ê²Œ */
            border-bottom: 1px solid rgba(0, 212, 255, 0.4);
        }
        
        /* íˆ¬ëª… ëª¨ë“œ */
        html.transparent-mode,
        body.transparent-mode {
            background: rgba(0, 0, 0, 0.01) !important;  /* ì™„ì „ íˆ¬ëª… ëŒ€ì‹  1% ë¶ˆíˆ¬ëª…ë„ */
        }
        
        body.transparent-mode #viewer {
            background: rgba(0, 0, 0, 0.01) !important;  /* ì™„ì „ íˆ¬ëª… ëŒ€ì‹  1% ë¶ˆíˆ¬ëª…ë„ */
            box-shadow: 0 0 1px rgba(0,0,0,0.01);  /* Emily ê¶Œì¥ - ì¶”ê°€!! */
        }
        
        body.transparent-mode #viewer-text {
            color: white !important;
            text-shadow: 
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000,
                0 0 2px rgba(0,0,0,1);
            -webkit-text-stroke: 0.5px black;
        }
        
        /* í…Œë‘ë¦¬ - box-sizingìœ¼ë¡œ ë‚´ë¶€ í¬ê¸° ìœ ì§€ */
        body.show-border {
            border: 4px solid #00d4ff;  /* ì‚¬ì´ë²„ ë¸”ë£¨ */
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);  /* ë°œê´‘ íš¨ê³¼ */
            box-sizing: border-box;  /* í…Œë‘ë¦¬ê°€ ì•ˆìª½ìœ¼ë¡œ ê·¸ë ¤ì§€ë„ë¡ */
        }
        
        body.transparent-mode.show-border {
            border: 4px solid #00d4ff;  /* íˆ¬ëª… ëª¨ë“œì—ì„œë„ ê°™ì€ ìƒ‰ */
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.8);  /* ë” ê°•í•œ ë°œê´‘ */
            box-sizing: border-box;  /* í…Œë‘ë¦¬ê°€ ì•ˆìª½ìœ¼ë¡œ ê·¸ë ¤ì§€ë„ë¡ */
        }
        
        #viewer {
            position: relative;
            width: 100vw; 
            height: 100vh;
            font-size: 32px; 
            line-height: 1.5; 
            text-align: left;
            transition: background 0.3s;
            z-index: 1;
            padding: 40px 30px;
            box-sizing: border-box;
        }
        
        #viewer-text {
            position: absolute;
            top: 40px; 
            left: 30px; 
            right: 30px; 
            bottom: 40px;
            width: calc(100% - 60px);
            height: calc(100% - 80px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #8884 #0000;
            background: none;
            word-break: break-all;
            white-space: pre-wrap;
            padding: 0;
            font-size: inherit;
            font-family: inherit;
            color: inherit;
            text-align: inherit;
            line-height: inherit;
            transition: color 0.2s, background 0.2s;
            box-sizing: border-box;
        }
        
        #viewer-text::-webkit-scrollbar {
            width: 8px;
            background: transparent;
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ í´ë˜ìŠ¤ */
        #viewer-text.hide-scrollbar {
            scrollbar-width: none;  /* Firefox */
        }
        
        #viewer-text.hide-scrollbar::-webkit-scrollbar {
            display: none;  /* Chrome, Safari */
        }
        
        /* ì„¤ì • ì•„ì´ì½˜ */
        #setting-icon {
            position: fixed;
            top: 18px; 
            left: 50%; 
            transform: translateX(-50%);
            width: 44px; 
            height: 44px;
            background: rgba(45,45,45,0.9);
            border: 1px solid #444;
            border-radius: 8px;
            z-index: 1000;
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        
        #setting-icon.visible {
            opacity: 1;
        }
        
        #setting-icon:hover {
            background: rgba(58,58,58,0.95);
            border-color: #5a78ff;
            box-shadow: 0 4px 16px rgba(90,120,255,0.2);
        }
        
        #setting-icon svg { 
            width: 24px; 
            height: 24px; 
            fill: #a2c1ff; 
            transition: fill 0.2s ease;
        }
        
        #setting-icon:hover svg { 
            fill: #fff; 
        }
        
        /* ì˜µì…˜ íŒ¨ë„ - viewer.htmlì—ì„œ ë³µì‚¬ */
        #option-panel {
            position: fixed;
            top: -500%;
            left: 50%; 
            transform: translateX(-50%);
            min-width: 420px;
            max-width: 480px;
            background: #1e1e1e;
            border: 2px solid #333;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.8);
            padding: 0;
            display: flex; 
            flex-direction: column;
            transition: top 0.4s cubic-bezier(0.4,1.6,0.4,1);
            z-index: 20;
            pointer-events: auto;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 13px;
            color: #e0e0e0;
        }
        
        #option-panel.open { 
            top: 0;
        }
        
        /* íŒ¨ë„ í—¤ë” */
        .panel-header {
            background: #252526;
            padding: 12px 16px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .panel-header::before {
            content: "âš™";
            font-size: 16px;
            color: #5a78ff;
        }
        
        .panel-title {
            font-weight: 600;
            color: #fff;
            font-size: 14px;
            letter-spacing: 0.5px;
        }
        
        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav {
            display: flex;
            background: #2d2d2d;
            border-bottom: 1px solid #333;
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px 16px;
            background: none;
            border: none;
            color: #a0a0a0;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
        }
        
        .tab-btn:hover {
            color: #fff;
            background: #383838;
        }
        
        .tab-btn.active {
            color: #5a78ff;
            background: #1e1e1e;
        }
        
        .tab-btn.active::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #5a78ff;
        }
        
        /* íƒ­ ì½˜í…ì¸  */
        .tab-content {
            display: none;
            max-height: calc(80vh - 120px);  /* íŒ¨ë„ í—¤ë”ì™€ íƒ­ ë†’ì´ë¥¼ ëº€ ê°’ */
            overflow-y: auto;
            padding: 8px 0;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-content::-webkit-scrollbar {
            width: 8px;
            background: #1e1e1e;
        }
        
        .tab-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }
        
        fieldset.option-group {
            border: 1px solid #444;
            border-radius: 6px;
            margin: 8px 16px;
            padding: 12px 16px 8px 16px;
            background: #232323;
        }
        
        legend {
            color: #5a78ff; 
            font-size: 12px; 
            font-weight: 600;
            padding: 4px 12px;
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .option-row {
            display: grid;
            grid-template-columns: 80px 1fr auto;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid #2a2a2a;
            min-height: 32px;
        }
        
        .option-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .option-row.wide {
            grid-template-columns: 80px 1fr 50px 24px 24px;
            gap: 8px;
        }
        
        .option-row label {
            color: #a2c1ff; 
            font-size: 12px;
            font-weight: 500;
            text-align: left;
            white-space: nowrap;
            text-transform: capitalize;
            line-height: 1.2;
        }
        
        .option-row input[type="color"] {
            width: 36px; 
            height: 32px; 
            border: 1px solid #444; 
            background: #181818; 
            cursor: pointer;
            border-radius: 4px;
            padding: 2px;
            transition: border-color 0.2s ease;
            vertical-align: middle;
        }
        
        .option-row input[type="checkbox"] {
            width: 18px; 
            height: 18px;
            accent-color: #5a78ff;
            cursor: pointer;
            vertical-align: middle;
        }
        
        .option-row input[type="number"] {
            width: 50px; 
            height: 28px;
            font-size: 12px; 
            padding: 0 6px; 
            border-radius: 4px; 
            border: 1px solid #444;
            background: #181818; 
            color: #e0e0e0; 
            text-align: center;
            font-family: inherit;
            transition: all 0.2s ease;
            line-height: 1;
            box-sizing: border-box;
            -moz-appearance: textfield;
        }
        
        .option-row input[type="number"]::-webkit-inner-spin-button,
        .option-row input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            appearance: none;
            margin: 0;
            display: none;
        }
        
        .option-row input[type="number"]:focus {
            outline: none;
            border-color: #5a78ff;
            box-shadow: 0 0 0 2px rgba(90,120,255,0.2);
        }
        
        .option-row select {
            height: 32px;
            font-size: 12px; 
            border-radius: 4px; 
            border: 1px solid #444;
            background: #181818; 
            color: #e0e0e0; 
            padding: 6px 8px;
            font-family: inherit;
            transition: all 0.2s ease;
            box-sizing: border-box;
        }
        
        .option-row select:focus {
            outline: none;
            border-color: #5a78ff;
            box-shadow: 0 0 0 2px rgba(90,120,255,0.2);
        }
        
        .option-row input[type="range"] {
            width: 100px;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: #444;
            border-radius: 3px;
            outline: none;
            vertical-align: middle;
        }
        
        .option-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #5a78ff;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .option-row input[type="range"]::-webkit-slider-thumb:hover {
            background: #7b9eff;
            transform: scale(1.1);
        }
        
        .option-row .num-btns {
            display: flex; 
            flex-direction: column; 
            gap: 1px;
            justify-self: end;
        }
        
        .option-row .num-btns button {
            width: 24px; 
            height: 14px; 
            font-size: 10px; 
            border: none; 
            background: #3a3a3a; 
            color: #ccc;
            border-radius: 2px; 
            cursor: pointer; 
            padding: 0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: inherit;
            line-height: 1;
        }
        
        .option-row .num-btns button:hover { 
            background: #5a78ff; 
            color: #fff;
            transform: scale(1.05);
        }
        
        .unit-label {
            color: #888;
            font-size: 11px;
            line-height: 1;
            vertical-align: middle;
            justify-self: start;
        }
        
        /* ì•Œë¦¼ */
        .notification {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            z-index: 10000;
            display: none;
            pointer-events: none;
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ CSS (viewer.html ê¸°ë°˜) */
        .shake { animation: shake 0.5s ease-in-out 3; }
        @keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-5px);} 75%{transform:translateX(5px);} }
        .fade-in { animation: fadeIn 2s ease-in-out; }
        @keyframes fadeIn { 0%{opacity:0;transform:translateY(20px);} 100%{opacity:1;transform:translateY(0);} }
        .zoom { animation: zoom 1.5s ease-in-out; }
        @keyframes zoom { 0%{transform:scale(0.8);} 50%{transform:scale(1.1);} 100%{transform:scale(1);} }
        .gradient-text { background:linear-gradient(45deg,#ff6b6b,#4ecdc4,#45b7d1,#96ceb4);background-size:300% 300%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:gradient-flow 3s ease infinite; }
        @keyframes gradient-flow { 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }
        .neon { color:#fff;text-shadow:0 0 5px #00ffff,0 0 10px #00ffff,0 0 15px #00ffff,0 0 20px #00ffff;animation:neon-flicker 2s infinite alternate; }
        @keyframes neon-flicker { 0%,100%{text-shadow:0 0 5px #00ffff,0 0 10px #00ffff,0 0 15px #00ffff,0 0 20px #00ffff;} 50%{text-shadow:0 0 2px #00ffff,0 0 5px #00ffff,0 0 8px #00ffff,0 0 12px #00ffff;} }
        .typewriter { border-right:3px solid #fff;animation:typewriter-blink 1s infinite; }
        @keyframes typewriter-blink { 0%,50%{border-color:#fff;} 51%,100%{border-color:transparent;} }
        .rotate { animation: rotate-360 2s ease-in-out; }
        @keyframes rotate-360 { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
        .slide-left { animation: slideLeft 1s ease-out; }
        @keyframes slideLeft { 0%{transform:translateX(100%);opacity:0;} 100%{transform:translateX(0);opacity:1;} }
        .slide-right { animation: slideRight 1s ease-out; }
        @keyframes slideRight { 0%{transform:translateX(-100%);opacity:0;} 100%{transform:translateX(0);opacity:1;} }
        .bg-party { background:linear-gradient(45deg,#ff6b6b,#4ecdc4,#45b7d1,#96ceb4);background-size:400% 400%;animation:bg-party 3s ease infinite; }
        @keyframes bg-party { 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }
    </style>
</head>
<body class="show-border">
    <div class="drag-header"></div>
    <div id="connection-status" class="connecting">
        <div class="status-dot"></div>
        <span>ì—°ê²° ì¤‘...</span>
    </div>
    <div id="viewer">
        <div id="viewer-text">ìë§‰ ëŒ€ê¸° ì¤‘...</div>
        <div id="setting-icon" title="ì„¤ì •">
            <svg viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zm7.43-2.9l1.77-1.02a1 1 0 0 0 .37-1.36l-1.68-2.92a1 1 0 0 0-1.28-.46l-1.77 1.02a7.03 7.03 0 0 0-1.52-.88l-.27-2A1 1 0 0 0 13.5 3h-3a1 1 0 0 0-1 .88l-.27 2a7.03 7.03 0 0 0-1.52.88l-1.77-1.02a1 1 0 0 0-1.36.37l-1.68 2.92a1 1 0 0 0 .37 1.36l1.77 1.02c-.09.32-.16.65-.22.99l-2 .27A1 1 0 0 0 3 10.5v3a1 1 0 0 0 .88 1l2 .27c.06.34.13.67.22.99l-1.77 1.02a1 1 0 0 0-.37 1.36l1.68 2.92a1 1 0 0 0 1.28.46l1.77-1.02c.47.34.97.64 1.52.88l.27 2A1 1 0 0 0 10.5 21h3a1 1 0 0 0 1-.88l.27-2c.55-.24 1.05-.54 1.52-.88l1.77 1.02a1 1 0 0 0 1.36-.37l1.68-2.92a1 1 0 0 0-.37-1.36l-1.77-1.02c.09-.32.16-.65.22-.99l2-.27A1 1 0 0 0 21 13.5v-3a1 1 0 0 0-.88-1l-2-.27a7.03 7.03 0 0 0-.22-.99zM12 17a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/></svg>
        </div>
        
        <div id="option-panel">
            <div class="panel-header">
                <span class="panel-title">Viewer Settings</span>
            </div>
            
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="tab1">ì„¤ì •</button>
            </div>
            
            <div id="tab1" class="tab-content active">
                <fieldset class="option-group display-group">
                    <legend>Display</legend>
                    <div class="option-row">
                        <label>ë°°ê²½ìƒ‰</label>
                        <input type="color" id="bgColor" value="#000000">
                        <input type="range" id="bgAlpha" min="0" max="100" value="100">
                    </div>
                    <div class="option-row">
                        <label>ê¸€ììƒ‰</label>
                        <input type="color" id="fontColor" value="#ffffff">
                    </div>
                    <div class="option-row">
                        <label>ê¸€ê¼´</label>
                        <select id="fontFamily">
                            <option value="sans-serif">ê¸°ë³¸ ê³ ë”•</option>
                            <option value="serif">ê¸°ë³¸ ëª…ì¡°</option>
                            <option value="monospace">ê³ ì •í­</option>
                            <option value="'Noto Sans KR', sans-serif">Noto Sans KR</option>
                            <option value="'Nanum Gothic', sans-serif">ë‚˜ëˆ”ê³ ë”•</option>
                            <option value="'Nanum Myeongjo', serif">ë‚˜ëˆ”ëª…ì¡°</option>
                            <option value="'Nanum Pen Script', cursive">ë‚˜ëˆ”íœì²´</option>
                            <option value="'Jua', sans-serif">ì£¼ì•„ì²´</option>
                            <option value="'Do Hyeon', sans-serif">ë„í˜„ì²´</option>
                            <option value="'Gothic A1', sans-serif">ê³ ë”• A1</option>
                            <option value="'IBM Plex Sans KR', sans-serif">IBM Plex í•œê¸€</option>
                        </select>
                    </div>
                    <div class="option-row wide">
                        <label>ê¸€ìí¬ê¸°</label>
                        <input type="number" id="fontSize" min="10" max="200" value="32">
                        <span class="unit-label">px</span>
                        <div class="num-btns">
                            <button type="button" id="fontSizeUp">â–²</button>
                            <button type="button" id="fontSizeDown">â–¼</button>
                        </div>
                    </div>
                </fieldset>
                
                <fieldset class="option-group effects-group">
                    <legend>Effects</legend>
                    <div class="option-row">
                        <label>í…Œë‘ë¦¬</label>
                        <input type="checkbox" id="outlineOn">
                        <input type="color" id="outlineColor" value="#000000">
                    </div>
                    <div class="option-row wide">
                        <label>êµµê¸°</label>
                        <input type="number" id="outlineWidth" min="0" max="10" value="2" step="0.1">
                        <span class="unit-label">px</span>
                        <div class="num-btns">
                            <button type="button" id="outlineWidthUp">â–²</button>
                            <button type="button" id="outlineWidthDown">â–¼</button>
                        </div>
                    </div>
                    <div class="option-row">
                        <label>ê·¸ë¦¼ì</label>
                        <input type="checkbox" id="shadowOn">
                        <input type="color" id="shadowColor" value="#000000">
                    </div>
                    <div class="option-row wide">
                        <label>íë¦¼</label>
                        <input type="number" id="shadowBlur" min="0" max="20" value="3" step="0.5">
                        <span class="unit-label">px</span>
                        <div class="num-btns">
                            <button type="button" id="shadowBlurUp">â–²</button>
                            <button type="button" id="shadowBlurDown">â–¼</button>
                        </div>
                    </div>
                    <div class="option-row wide">
                        <label>ê±°ë¦¬</label>
                        <input type="number" id="shadowDistance" min="0" max="10" value="2" step="0.5">
                        <span class="unit-label">px</span>
                        <div class="num-btns">
                            <button type="button" id="shadowDistanceUp">â–²</button>
                            <button type="button" id="shadowDistanceDown">â–¼</button>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>

    <script>
        const { ipcRenderer } = require('electron');
        
        let channelCode = null;
        let socket = null;
        let isTransparent = false;
        let borderVisible = true;
        let lastClickTime = 0;
        
        const viewerText = document.getElementById('viewer-text');
        const settingIcon = document.getElementById('setting-icon');
        const optionPanel = document.getElementById('option-panel');
        const connectionStatus = document.getElementById('connection-status');
        
        // ëˆ„ì  í…ìŠ¤íŠ¸ ê´€ë¦¬
        let accumulatedText = '';
        let activeStenographer = '1';
        let currentActiveInput = '';
        let lastProcessedText = '';
        
        // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateConnectionStatus(status, message) {
            connectionStatus.className = status;
            connectionStatus.querySelector('span').textContent = message;
            
            // 3ì´ˆ í›„ ì—°ê²°ë¨ ìƒíƒœì—ì„œëŠ” ìˆ¨ê¹€
            if (status === 'connected') {
                setTimeout(() => {
                    connectionStatus.style.opacity = '0';
                }, 3000);
            } else {
                connectionStatus.style.opacity = '1';
            }
        }
        
        // Socket.IO ë™ì  ë¡œë“œ í•¨ìˆ˜
        function loadSocketIO() {
            return new Promise((resolve, reject) => {
                // ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                if (typeof io !== 'undefined') {
                    console.log('[Socket.IO] ì´ë¯¸ ë¡œë“œë¨');
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://cdn.socket.io/4.5.4/socket.io.min.js';
                script.onload = () => {
                    console.log('[Socket.IO] ë¡œë“œ ì„±ê³µ');
                    resolve();
                };
                script.onerror = () => {
                    console.error('[Socket.IO] ë¡œë“œ ì‹¤íŒ¨');
                    reject(new Error('Socket.IO ë¡œë“œ ì‹¤íŒ¨'));
                };
                document.head.appendChild(script);
            });
        }
        
        // ì±„ë„ ì½”ë“œ ìˆ˜ì‹ 
        ipcRenderer.on('channel-code', async (event, code) => {
            channelCode = code;
            console.log('[Electron] ì±„ë„ ì½”ë“œ ìˆ˜ì‹ :', code);
            
            try {
                await loadSocketIO();
                connectToSocket();
            } catch (error) {
                console.error('[Socket.IO] ë¡œë“œ ì—ëŸ¬:', error);
                updateConnectionStatus('disconnected', 'ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨');
                showNotification('Socket.IO ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨');
            }
        });
        
        // Socket.io ì—°ê²°
        function connectToSocket() {
            try {
                const socketUrl = 'https://81b5c4d8eea5.ngrok-free.app';
                
                const socketOptions = {
                    transports: ['websocket', 'polling'],
                    upgrade: true,
                    reconnection: true,
                    reconnectionDelay: 1000,
                    reconnectionDelayMax: 5000,
                    reconnectionAttempts: 10,
                    timeout: 20000,
                    forceNew: true
                };
                
                console.log('[Socket] ì—°ê²° ì‹œë„:', socketUrl);
                socket = io(socketUrl, socketOptions);
                
                // ì—°ê²° ì„±ê³µ
                socket.on('connect', () => {
                    console.log('[Socket] ì—°ê²° ì„±ê³µ!');
                    console.log('[Socket] Socket ID:', socket.id);
                    updateConnectionStatus('connected', 'ì—°ê²°ë¨');
                    showNotification('ì„œë²„ ì—°ê²° ì„±ê³µ');
                    
                    // ì±„ë„ ì°¸ê°€
                    console.log('[Socket] ì±„ë„ ì°¸ê°€:', channelCode);
                    socket.emit('join_channel', { 
                        channel: channelCode, 
                        role: 'viewer'
                    });
                });
                
                // ì—°ê²° ì—ëŸ¬
                socket.on('connect_error', (error) => {
                    console.error('[Socket] ì—°ê²° ì—ëŸ¬:', error.message);
                    updateConnectionStatus('disconnected', 'ì—°ê²° ì‹¤íŒ¨');
                });
                
                // ì—°ê²° ëŠê¹€
                socket.on('disconnect', (reason) => {
                    console.log('[Socket] ì—°ê²° ëŠê¹€:', reason);
                    updateConnectionStatus('disconnected', 'ì—°ê²° ëŠê¹€');
                });
                
                // ì¬ì—°ê²° ì‹œë„
                socket.on('reconnect_attempt', (attemptNumber) => {
                    console.log('[Socket] ì¬ì—°ê²° ì‹œë„:', attemptNumber);
                    updateConnectionStatus('connecting', `ì¬ì—°ê²° ì‹œë„ ì¤‘... (${attemptNumber})`);
                });
                
                // ì¬ì—°ê²° ì„±ê³µ
                socket.on('reconnect', () => {
                    console.log('[Socket] ì¬ì—°ê²° ì„±ê³µ');
                    updateConnectionStatus('connected', 'ì¬ì—°ê²°ë¨');
                    
                    // ì±„ë„ ì¬ì°¸ê°€
                    socket.emit('join_channel', { 
                        channel: channelCode, 
                        role: 'viewer'
                    });
                });
                
               // ì±„ë„ ì°¸ê°€ ì„±ê³µ
                socket.on('joined_channel', (data) => {
                    console.log('[Socket] ì±„ë„ ì°¸ê°€ ì„±ê³µ:', data);
                    showNotification(`ì±„ë„ ${channelCode} ì°¸ê°€ ì™„ë£Œ`);
                    
                    // ì´ˆê¸° ìƒíƒœ ìš”ì²­
                    socket.emit('request_sync', { channel: channelCode });
                });
                
                // ì±„ë„ ì°¸ê°€ ì‹¤íŒ¨
                socket.on('error', (error) => {
                    console.error('[Socket] ì—ëŸ¬:', error);
                    if (error.message && error.message.includes('Channel not found')) {
                        showNotification('ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        updateConnectionStatus('disconnected', 'ì±„ë„ ì—†ìŒ');
                    }
                });
                
                // ëˆ„ì  í…ìŠ¤íŠ¸ ë™ê¸°í™” (ìµœì´ˆ ì§„ì…/ë™ê¸°í™”ìš©)
socket.on('sync_accumulated', (data) => {
    console.log('[Socket] ëˆ„ì  í…ìŠ¤íŠ¸ ë™ê¸°í™”:', data);
    
    // accumulatedText ì²˜ë¦¬
    if (data.accumulatedText !== undefined) {
        accumulatedText = data.accumulatedText;
        currentActiveInput = '';
        updateViewerDisplay(accumulatedText, true);
        console.log('[ë™ê¸°í™”] ëˆ„ì  í…ìŠ¤íŠ¸ ì„¤ì •:', accumulatedText);
    }
    
    // activeStenographerê°€ ì—†ìœ¼ë©´ ì´ˆê¸° ìƒíƒœ ìš”ì²­
    if (!data.activeStenographer) {
        console.log('[ë™ê¸°í™”] í™œì„± ì†ê¸°ì‚¬ ì •ë³´ ì—†ìŒ, ìƒíƒœ ìš”ì²­');
        socket.emit('get_channel_state', { channel: channelCode });
    } else {
        activeStenographer = data.activeStenographer === 'steno1' ? '1' : '2';
        console.log('[ë™ê¸°í™”] í™œì„± ì†ê¸°ì‚¬:', activeStenographer);
    }
});

                // ì±„ë„ ìƒíƒœ ìˆ˜ì‹ 
                socket.on('channel_state', (data) => {
                    console.log('[Socket] ì±„ë„ ìƒíƒœ:', data);
                    if (data.state) {
                        if (data.state.activeStenographer) {
                            activeStenographer = data.state.activeStenographer === 'steno1' ? '1' : '2';
                            console.log('[ìƒíƒœ] í™œì„± ì†ê¸°ì‚¬:', activeStenographer);
                        }
                        if (data.state.accumulatedText !== undefined) {
                            accumulatedText = data.state.accumulatedText;
                            currentActiveInput = '';
                            updateViewerDisplay(accumulatedText, true);
                        }
                    }
                });

                // ì‹¤ì‹œê°„ ì…ë ¥ ìˆ˜ì‹ 
                socket.on('steno_input', (data) => {
                    console.log('[Socket] ì‹¤ì‹œê°„ ì…ë ¥:', {
                        role: data.role,
                        text: data.text,
                        activeStenographer: activeStenographer,
                        dataLength: data.text ? data.text.length : 0
                    });
                    
                    // role ë§¤í•‘
                    let inputRole;
                    if (data.role === 'steno1' || data.role === '1') {
                        inputRole = '1';
                    } else if (data.role === 'steno2' || data.role === '2') {
                        inputRole = '2';
                    } else {
                        inputRole = data.role;
                    }
                    
                    console.log('[ì…ë ¥] ë§¤í•‘ëœ ì—­í• :', inputRole, 'í˜„ì¬ í™œì„±:', activeStenographer);
                    
                    if (inputRole === activeStenographer) {
                        currentActiveInput = data.text || '';
                        const fullText = accumulatedText + currentActiveInput;
                        updateViewerDisplay(fullText, false);
                        console.log('[í‘œì‹œ] í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸:', fullText.length, 'ì');
                    }
                });

                // ì—­í•  ì „í™˜
                socket.on('switch_role', (data) => {
                    console.log('[Socket] ì—­í•  ì „í™˜:', data);
                    
                    if (data.newActive === 'steno1' || data.newActive === '1') {
                        activeStenographer = '1';
                    } else if (data.newActive === 'steno2' || data.newActive === '2') {
                        activeStenographer = '2';
                    }
                    
                    if (data.accumulatedText !== undefined) {
                        accumulatedText = data.accumulatedText;
                        currentActiveInput = '';
                        updateViewerDisplay(accumulatedText, true);
                    }
                    
                    showNotification(`ì†ê¸°ì‚¬ ${activeStenographer} í™œì„±í™”`);
                });

                // í…ìŠ¤íŠ¸ í´ë¦¬ì–´
                socket.on('clear_text', () => {
                    console.log('[Socket] í…ìŠ¤íŠ¸ í´ë¦¬ì–´');
                    accumulatedText = '';
                    currentActiveInput = '';
                    updateViewerDisplay('', true);
                    showNotification('í…ìŠ¤íŠ¸ ì´ˆê¸°í™”ë¨');
                });

                // viewer_text_update ì´ë²¤íŠ¸ ì¶”ê°€
                socket.on('viewer_text_update', (data) => {
                    console.log('[Socket] viewer_text_update ì´ë²¤íŠ¸:', data);
                    if (data.text !== undefined) {
                        viewerText.textContent = data.text || 'ìë§‰ ëŒ€ê¸° ì¤‘...';
                        viewerText.scrollTop = viewerText.scrollHeight;
                    }
                });

                // ë””ë²„ê¹…ìš© - ëª¨ë“  ì´ë²¤íŠ¸ ë¡œê¹…
                socket.onAny((eventName, ...args) => {
                    console.log('[Socket Event]', eventName, JSON.stringify(args, null, 2));
                });
                
            } catch (error) {
                console.error('[Socket] ì—°ê²° ì—ëŸ¬:', error);
                updateConnectionStatus('disconnected', 'ì—°ê²° ì‹¤íŒ¨: ' + error.message);
            }
        }


        // ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±° ë³€í™˜ í•¨ìˆ˜
        function processRealisticEmotions(text) {
            let processedText = text;
            let effectClass = '';
            
            if (text.includes('(ì§„ë™)')) {
                processedText = text.replace(/\(ì§„ë™\)/g, 'ğŸ“³');
                effectClass = 'shake';
            } else if (text.includes('(í˜ì´ë“œ)')) {
                processedText = text.replace(/\(í˜ì´ë“œ\)/g, 'âœ¨');
                effectClass = 'fade-in';
            } else if (text.includes('(í™•ëŒ€)')) {
                processedText = text.replace(/\(í™•ëŒ€\)/g, 'ğŸ”');
                effectClass = 'zoom';
            } else if (text.includes('(ë¬´ì§€ê°œ)')) {
                processedText = text.replace(/\(ë¬´ì§€ê°œ\)/g, 'ğŸŒˆ');
                effectClass = 'gradient-text';
            } else if (text.includes('(ë„¤ì˜¨)')) {
                processedText = text.replace(/\(ë„¤ì˜¨\)/g, 'ğŸ’¡');
                effectClass = 'neon';
            } else if (text.includes('(íƒ€ìê¸°)')) {
                processedText = text.replace(/\(íƒ€ìê¸°\)/g, 'âŒ¨ï¸');
                effectClass = 'typewriter';
            } else if (text.includes('(íšŒì „)')) {
                processedText = text.replace(/\(íšŒì „\)/g, 'ğŸ”„');
                effectClass = 'rotate';
            } else if (text.includes('(ì™¼ìŠ¬ë¼ì´ë“œ)')) {
                processedText = text.replace(/\(ì™¼ìŠ¬ë¼ì´ë“œ\)/g, 'â†');
                effectClass = 'slide-left';
            } else if (text.includes('(ì˜¤ë¥¸ìŠ¬ë¼ì´ë“œ)')) {
                processedText = text.replace(/\(ì˜¤ë¥¸ìŠ¬ë¼ì´ë“œ\)/g, 'â†’');
                effectClass = 'slide-right';
            } else if (text.includes('(íŒŒí‹°)')) {
                processedText = text.replace(/\(íŒŒí‹°\)/g, 'ğŸ‰');
                effectClass = 'bg-party';
            }
            
            return { text: processedText, effect: effectClass };
        }
        
        // 1ë‹¨ì–´ ì§€ì—° ì²˜ë¦¬ í•¨ìˆ˜
        function updateViewerDisplay(fullText, isImmediate = false) {
            let displayText = '';
            if (isImmediate) {
                displayText = fullText;
            } else {
                if (fullText.endsWith(' ')) {
                    displayText = fullText;
                } else {
                    const words = fullText.split(' ');
                    if (words.length > 1) {
                        displayText = words.slice(0, -1).join(' ') + ' ';
                    } else {
                        displayText = '';
                    }
                }
            }
            
            const { text, effect } = processRealisticEmotions(displayText);
            viewerText.textContent = text || 'ìë§‰ ëŒ€ê¸° ì¤‘...';
            viewerText.className = effect || '';
            viewerText.scrollTop = viewerText.scrollHeight;
        }
        
        // ì„¤ì • ì•„ì´ì½˜ í‘œì‹œ
        let isMouseInTopArea = false;
        let isMouseOnIcon = false;
        
        function updateIconVisibility() {
            if (isMouseInTopArea || isMouseOnIcon || optionPanel.classList.contains('open')) {
                settingIcon.classList.add('visible');
            } else {
                settingIcon.classList.remove('visible');
            }
        }
        
        document.addEventListener('mousemove', e => {
            isMouseInTopArea = e.clientY < 100;
            updateIconVisibility();
        });
        
        settingIcon.addEventListener('mouseenter', () => {
            isMouseOnIcon = true;
            updateIconVisibility();
        });
        
        settingIcon.addEventListener('mouseleave', () => {
            isMouseOnIcon = false;
            updateIconVisibility();
        });
        
        // ì˜µì…˜ íŒ¨ë„ í† ê¸€
        settingIcon.addEventListener('click', e => {
            e.stopPropagation();
            
            // í˜„ì¬ ì„¤ì • ê°’ë“¤ ìˆ˜ì§‘
            const currentSettings = {
                bgColor: document.getElementById('bgColor').value,
                bgAlpha: document.getElementById('bgAlpha').value,
                fontColor: document.getElementById('fontColor').value,
                fontSize: document.getElementById('fontSize').value,
                fontFamily: document.getElementById('fontFamily').value,
                outlineOn: document.getElementById('outlineOn').checked,
                outlineColor: document.getElementById('outlineColor').value,
                outlineWidth: document.getElementById('outlineWidth').value,
                shadowOn: document.getElementById('shadowOn').checked,
                shadowColor: document.getElementById('shadowColor').value,
                shadowBlur: document.getElementById('shadowBlur').value,
                shadowDistance: document.getElementById('shadowDistance').value,
                isTransparent: isTransparent
            };
            
            // ë³„ë„ ì°½ ì—´ê¸°
            ipcRenderer.send('open-options', currentSettings);
        });
        
        // ë”ë¸”í´ë¦­ ê°ì§€
        document.addEventListener('mousedown', (e) => {
            if (e.target.closest('#option-panel') || e.target.closest('#setting-icon')) return;
            
            const now = Date.now();
            if (now - lastClickTime < 300) {
                e.preventDefault();
                toggleBorder();
            }
            lastClickTime = now;
        });
        
        // í…Œë‘ë¦¬ í† ê¸€
        function toggleBorder() {
            borderVisible = !borderVisible;
            
            if (borderVisible) {
                document.body.classList.add('show-border');
                showNotification('í…Œë‘ë¦¬ í‘œì‹œ');
            } else {
                document.body.classList.remove('show-border');
                showNotification('í…Œë‘ë¦¬ ìˆ¨ê¹€');
            }
        }
        
        // ìš°í´ë¦­ ë©”ë‰´
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            
            // ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ ìƒíƒœ í™•ì¸
            const isScrollbarHidden = viewerText.classList.contains('hide-scrollbar');
            
            ipcRenderer.send('show-context-menu', {
                isTransparent: isTransparent,
                isScrollbarHidden: isScrollbarHidden,
                x: e.clientX,
                y: e.clientY
            });
        });
        
        // ì˜µì…˜ ê¸°ëŠ¥ë“¤
        function applyBasicOptions() {
            // íˆ¬ëª… ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ ë°°ê²½ìƒ‰ ì ìš©
            if (!isTransparent) {
                const bgHex = document.getElementById('bgColor').value;
                const alpha = (parseInt(document.getElementById('bgAlpha').value) / 100).toFixed(2);
                const r = parseInt(bgHex.slice(1, 3), 16);
                const g = parseInt(bgHex.slice(3, 5), 16);
                const b = parseInt(bgHex.slice(5, 7), 16);
                document.getElementById('viewer').style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${alpha})`;
                document.body.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${alpha})`;
            } else {
                // íˆ¬ëª… ëª¨ë“œì¼ ë•ŒëŠ” ê·¹íˆ ë‚®ì€ ë¶ˆíˆ¬ëª…ë„ ìœ ì§€
                document.getElementById('viewer').style.backgroundColor = 'rgba(0,0,0,0.01)';
                document.body.style.backgroundColor = 'rgba(0,0,0,0.01)';
            }
            
            viewerText.style.color = document.getElementById('fontColor').value;
            viewerText.style.fontSize = document.getElementById('fontSize').value + 'px';
            viewerText.style.fontFamily = document.getElementById('fontFamily').value;
            
            // í…Œë‘ë¦¬ ì ìš©
            const outlineOn = document.getElementById('outlineOn').checked;
            const outlineColor = document.getElementById('outlineColor').value;
            const outlineWidth = document.getElementById('outlineWidth').value;
            
            // ê·¸ë¦¼ì ì ìš©
            const shadowOn = document.getElementById('shadowOn').checked;
            const shadowColor = document.getElementById('shadowColor').value;
            const shadowBlur = document.getElementById('shadowBlur').value;
            const shadowDistance = document.getElementById('shadowDistance').value || '2';
            
            let textShadow = '';
            
            if (outlineOn && parseFloat(outlineWidth) > 0) {
                const outline = `-${outlineWidth}px -${outlineWidth}px 0 ${outlineColor}, ${outlineWidth}px -${outlineWidth}px 0 ${outlineColor}, -${outlineWidth}px ${outlineWidth}px 0 ${outlineColor}, ${outlineWidth}px ${outlineWidth}px 0 ${outlineColor}`;
                textShadow = outline;
            }
            
            if (shadowOn && parseFloat(shadowDistance) > 0) {
                const dropShadow = `${shadowDistance}px ${shadowDistance}px ${shadowBlur}px ${shadowColor}`;
                textShadow = textShadow ? textShadow + ', ' + dropShadow : dropShadow;
            }
            
            viewerText.style.textShadow = textShadow;
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.getElementById('bgColor').addEventListener('input', applyBasicOptions);
        document.getElementById('bgAlpha').addEventListener('input', applyBasicOptions);
        document.getElementById('fontColor').addEventListener('input', applyBasicOptions);
        document.getElementById('fontSize').addEventListener('input', applyBasicOptions);
        document.getElementById('fontFamily').addEventListener('change', applyBasicOptions);
        
        document.getElementById('fontSizeUp').addEventListener('click', () => {
            const fontSize = document.getElementById('fontSize');
            fontSize.value = Math.min(200, Number(fontSize.value) + 1);
            applyBasicOptions();
        });
        
        document.getElementById('fontSizeDown').addEventListener('click', () => {
            const fontSize = document.getElementById('fontSize');
            fontSize.value = Math.max(10, Number(fontSize.value) - 1);
            applyBasicOptions();
        });
        
        // í…Œë‘ë¦¬ ì˜µì…˜
        document.getElementById('outlineOn').addEventListener('change', applyBasicOptions);
        document.getElementById('outlineColor').addEventListener('input', applyBasicOptions);
        document.getElementById('outlineWidth').addEventListener('input', applyBasicOptions);
        
        document.getElementById('outlineWidthUp').addEventListener('click', () => {
            const outlineWidth = document.getElementById('outlineWidth');
            outlineWidth.value = Math.min(10, Number(outlineWidth.value) + 0.1).toFixed(1);
            applyBasicOptions();
        });
        
        document.getElementById('outlineWidthDown').addEventListener('click', () => {
            const outlineWidth = document.getElementById('outlineWidth');
            outlineWidth.value = Math.max(0, Number(outlineWidth.value) - 0.1).toFixed(1);
            applyBasicOptions();
        });
        
        // ê·¸ë¦¼ì ì˜µì…˜
        document.getElementById('shadowOn').addEventListener('change', applyBasicOptions);
        document.getElementById('shadowColor').addEventListener('input', applyBasicOptions);
        document.getElementById('shadowBlur').addEventListener('input', applyBasicOptions);
        
        const shadowDistance = document.getElementById('shadowDistance');
        if (shadowDistance) {
            shadowDistance.addEventListener('input', applyBasicOptions);
        }
        
        document.getElementById('shadowBlurUp').addEventListener('click', () => {
            const shadowBlur = document.getElementById('shadowBlur');
            shadowBlur.value = Math.min(20, Number(shadowBlur.value) + 0.5).toFixed(1);
            applyBasicOptions();
        });
        
        document.getElementById('shadowBlurDown').addEventListener('click', () => {
            const shadowBlur = document.getElementById('shadowBlur');
            shadowBlur.value = Math.max(0, Number(shadowBlur.value) - 0.5).toFixed(1);
            applyBasicOptions();
        });
        
        const shadowDistanceUp = document.getElementById('shadowDistanceUp');
        const shadowDistanceDown = document.getElementById('shadowDistanceDown');
        
        if (shadowDistanceUp) {
            shadowDistanceUp.addEventListener('click', () => {
                const shadowDistance = document.getElementById('shadowDistance');
                shadowDistance.value = Math.min(10, Number(shadowDistance.value) + 0.5).toFixed(1);
                applyBasicOptions();
            });
        }
        
        if (shadowDistanceDown) {
            shadowDistanceDown.addEventListener('click', () => {
                const shadowDistance = document.getElementById('shadowDistance');
                shadowDistance.value = Math.max(0, Number(shadowDistance.value) - 0.5).toFixed(1);
                applyBasicOptions();
            });
        }
        
        // íˆ¬ëª… ë°°ê²½ í† ê¸€
        ipcRenderer.on('toggle-transparent', () => {
            isTransparent = !isTransparent;
            
            if (isTransparent) {
                // htmlê³¼ body ëª¨ë‘ì— í´ë˜ìŠ¤ ì¶”ê°€
                document.documentElement.classList.add('transparent-mode');
                document.body.classList.add('transparent-mode');
                
                // ëª¨ë“  ë°°ê²½ì„ ê·¹íˆ ë‚®ì€ ë¶ˆíˆ¬ëª…ë„ë¡œ ì„¤ì •
                document.documentElement.style.backgroundColor = 'rgba(0,0,0,0.01)';
                document.body.style.backgroundColor = 'rgba(0,0,0,0.01)';
                document.getElementById('viewer').style.backgroundColor = 'rgba(0,0,0,0.01)';
                document.getElementById('bgAlpha').value = '1';  // 1%ë¡œ ì„¤ì •
                
                // ë°°ê²½ìƒ‰ inputë„ ë³€ê²½
                const bgColorInput = document.getElementById('bgColor');
                bgColorInput.dataset.originalColor = bgColorInput.value;
                bgColorInput.value = '#000000';
                
                document.body.classList.add('show-border');
                borderVisible = true;
                
                showNotification('íˆ¬ëª… ë°°ê²½ í™œì„±í™”');
                console.log('[íˆ¬ëª…ëª¨ë“œ] í™œì„±í™”ë¨');
                
                // main í”„ë¡œì„¸ìŠ¤ì— ì•Œë¦¼ (Windows 11 ë²„ê·¸ ëŒ€ì‘)
                ipcRenderer.send('toggle-transparent-main', true);
                
                // ì•„ì´ì½˜ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
                updateIconVisibility();
            } else {
                document.documentElement.classList.remove('transparent-mode');
                document.body.classList.remove('transparent-mode');
                document.documentElement.style.backgroundColor = '';
                document.body.style.backgroundColor = '';
                document.getElementById('viewer').style.backgroundColor = '';
                
                // ì›ë˜ ìƒ‰ìƒìœ¼ë¡œ ë³µì›
                const bgColorInput = document.getElementById('bgColor');
                if (bgColorInput.dataset.originalColor) {
                    bgColorInput.value = bgColorInput.dataset.originalColor;
                }
                
                document.getElementById('bgAlpha').value = '100';
                // ì›ë˜ ì„¤ì •ìœ¼ë¡œ ë³µì›
                applyBasicOptions();
                
                showNotification('ê¸°ë³¸ ë°°ê²½ í™œì„±í™”');
                console.log('[íˆ¬ëª…ëª¨ë“œ] ë¹„í™œì„±í™”ë¨');
                
                // main í”„ë¡œì„¸ìŠ¤ì— ì•Œë¦¼ (Windows 11 ë²„ê·¸ ëŒ€ì‘)
                ipcRenderer.send('toggle-transparent-main', false);
                
                // ì•„ì´ì½˜ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
                updateIconVisibility();
            }
        });
        
        // í•­ìƒ ìœ„ ìƒíƒœ ë³€ê²½
        ipcRenderer.on('always-on-top-changed', (event, enabled) => {
            showNotification(enabled ? 'í•­ìƒ ìœ„ í™œì„±í™”' : 'í•­ìƒ ìœ„ ë¹„í™œì„±í™”');
        });
        
        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // ESC í‚¤
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                ipcRenderer.send('exit-fullscreen');
                if (optionPanel.classList.contains('open')) {
                    optionPanel.classList.remove('open');
                }
            }
        });
        
        // ì˜µì…˜ ì°½ì—ì„œ ì„¤ì • ë³€ê²½ ìˆ˜ì‹ 
        ipcRenderer.on('update-settings', (event, settings) => {
            // ì„¤ì • ê°’ ì ìš©
            document.getElementById('bgColor').value = settings.bgColor;
            document.getElementById('bgAlpha').value = settings.bgAlpha;
            document.getElementById('fontColor').value = settings.fontColor;
            document.getElementById('fontSize').value = settings.fontSize;
            document.getElementById('fontFamily').value = settings.fontFamily;
            document.getElementById('outlineOn').checked = settings.outlineOn;
            document.getElementById('outlineColor').value = settings.outlineColor;
            document.getElementById('outlineWidth').value = settings.outlineWidth;
            document.getElementById('shadowOn').checked = settings.shadowOn;
            document.getElementById('shadowColor').value = settings.shadowColor;
            document.getElementById('shadowBlur').value = settings.shadowBlur;
            document.getElementById('shadowDistance').value = settings.shadowDistance;
            
            // íˆ¬ëª… ëª¨ë“œ ì²˜ë¦¬
            if (settings.isTransparent !== isTransparent) {
                ipcRenderer.emit('toggle-transparent');
            }
            
            // ì„¤ì • ì ìš©
            applyBasicOptions();
            
            // íŠ¹ë³„ ìŠ¤íƒ€ì¼ ì ìš© (í”„ë¦¬ì…‹ìš©)
            if (settings.specialStyle) {
                if (settings.specialStyle.textShadow) {
                    viewerText.style.textShadow = settings.specialStyle.textShadow;
                }
                if (settings.specialStyle.webkitTextStroke) {
                    viewerText.style.webkitTextStroke = settings.specialStyle.webkitTextStroke;
                }
                if (settings.specialStyle.fontWeight) {
                    viewerText.style.fontWeight = settings.specialStyle.fontWeight;
                }
            }
        });
        
        // ìŠ¤í¬ë¡¤ë°” í† ê¸€ ìˆ˜ì‹ 
        ipcRenderer.on('toggle-scrollbar', () => {
            viewerText.classList.toggle('hide-scrollbar');
            const isHidden = viewerText.classList.contains('hide-scrollbar');
            showNotification(isHidden ? 'ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€' : 'ìŠ¤í¬ë¡¤ë°” í‘œì‹œ');
        });
        
        // ì´ˆê¸° ì„¤ì • ì ìš©
        applyBasicOptions();
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°”ë¡œ ì†Œì¼“ ì—°ê²° ì‹œë„ (í…ŒìŠ¤íŠ¸ìš©)
        if (!channelCode) {
            // ê°œë°œ ì¤‘ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ìë™ìœ¼ë¡œ ì±„ë„ ì½”ë“œ ì„¤ì •
            setTimeout(() => {
                if (!channelCode && window.location.hostname === 'localhost') {
                    console.log('[ê°œë°œëª¨ë“œ] í…ŒìŠ¤íŠ¸ ì±„ë„ ìë™ ì—°ê²°');
                    channelCode = 'AAAAAA';
                    loadSocketIO().then(() => {
                        connectToSocket();
                    }).catch(console.error);
                }
            }, 1000);
        }
    </script>
</body>
</html>