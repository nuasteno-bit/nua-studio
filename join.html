<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUA STUDIO – Join Channel</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css">
    
    <!-- Config.js 로드 -->
    <script src="config.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background: #fff;
            overflow-x: hidden;
        }

        /* 헤더 */
        .header {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            background: transparent; 
            z-index: 1000; 
            padding-top: 32px;
        }
        
        .header .wrap {
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            margin: 0 auto; 
            width: 95%;
            max-width: 1708px;
        }
        
        .header .logo {
            width: 122px; 
            flex-shrink: 0; 
            position: relative; 
            z-index: 101;
        }
        
        .header .logo svg path {
            fill: #000;
        }
        
        .header .logo svg text {
            fill: #fff;
        }
        
        .header .menu {
            font-size: 24px; 
            display: flex; 
            align-items: center;
        }
        
        .header .menu ul {
            display: flex; 
            align-items: center; 
            gap: calc(120/24*1em);
            list-style: none;
        }
        
        .header .menu li {
            font-size: inherit; 
            font-weight: 700; 
            letter-spacing: 0.025em; 
            font-family: 'Ubuntu', sans-serif; 
            color: #000; 
            position: relative; 
            transition: .4s;
        }
        
        .header .menu li a {
            position: relative; 
            z-index: 1; 
            padding: 5px;
            color: inherit;
            text-decoration: none;
        }
        
        .header .menu li::before {
            content: ''; 
            z-index: -1; 
            position: absolute; 
            top: 0; 
            left: 0; 
            display: block; 
            width: 0%; 
            height: 100%; 
            background: #00f0ff; 
            transition: .4s;
        }
        
        .header .menu li:hover::before {
            width: 100%;
        }
        
        .header .lang {
            margin-left: calc(80/20*1em); 
            position: relative; 
            font-size: 20px; 
            font-family: 'Ubuntu', sans-serif; 
            font-weight: 500; 
            letter-spacing: -0.025em; 
            color: #fff;
        }
        
        .header .lang_current {
            display: flex; 
            align-items: center; 
            gap: calc(10/20*1em); 
            color: #fff; 
            background: #363638; 
            padding: calc(8/20*1em) calc(10/20*1em); 
            border-radius: calc(10/20*1em); 
            cursor: pointer;
        }
        
        .header .lang_list_wrap {
            display: none; 
            width: 100%; 
            position: absolute; 
            top: 100%; 
            left: 0;
        }
        
        .header .lang_list {
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: calc(3/20*1em); 
            padding: calc(5/20*1em) 0; 
            box-sizing: border-box; 
            border-radius: calc(10/20*1em);
        }
        
        .header .lang_list a {
            display: block; 
            width: 100%; 
            font-size: calc(16/20*1em); 
            padding: calc(8/16*1em) calc(10/16*1em); 
            box-sizing: border-box; 
            background: #000; 
            color: #fff; 
            text-align: center; 
            border-radius: calc(10/20*1em); 
            transition: .4s;
            text-decoration: none;
        }
        
        .header .hamburger {
            display: none; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            width: 25px; 
            height: 20px; 
            gap: 5px; 
            position: relative; 
            z-index: 101;
        }
        
        .header .hamburger span {
            display: block; 
            width: 100%; 
            height: 2px; 
            background: #000; 
            transition: .4s;
        }

        .header.HmActive .hamburger span {
            position: absolute; 
            top: 50%; 
            margin-top: -1px;
        }
        
        .header.HmActive .hamburger span:first-child {
            transform: rotate(45deg);
        }
        
        .header.HmActive .hamburger span:nth-child(2) {
            opacity: 0;
        }
        
        .header.HmActive .hamburger span:last-child {
            transform: rotate(-45deg);
        }

        /* 히어로 섹션 */
        .hero {
            min-height: 100vh;
            position: relative;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 120px 20px 80px;
        }

        /* 배경 오브젝트 */
        .bg-objects {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .bg-circle {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(135deg, #00f0ff, #a259ff);
            opacity: 0.05;
        }

        .bg-circle._1 {
            width: 500px;
            height: 500px;
            top: -200px;
            right: -100px;
            animation: float 20s ease-in-out infinite;
        }

        .bg-circle._2 {
            width: 300px;
            height: 300px;
            bottom: -100px;
            left: -50px;
            animation: float 15s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-30px, 30px); }
        }

        /* 컨테이너 */
        .container {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* 2단 레이아웃 */
        .hero-layout {
            display: flex;
            align-items: center;
            gap: 80px;
        }

        /* 왼쪽: 타이틀 */
        .hero-left {
            flex: 1;
        }

        .hero-title {
            font-size: clamp(60px, 8vw, 120px);
            font-weight: 800;
            line-height: 0.95;
            letter-spacing: -0.03em;
            font-family: 'Poppins', sans-serif;
            color: #000;
            margin-bottom: 30px;
        }

        .hero-title .line {
            display: block;
            min-height: 1em;
            position: relative;
        }

        /* 타이핑 문자 스타일 */
        .typing-char {
            display: inline-block;
            transition: all 0.3s ease;
        }

        .typing-char.random-number {
            opacity: 0.2;
            color: #999;
        }

        .typing-char.revealed {
            opacity: 1;
            color: #000;
            animation: char-reveal 0.4s ease;
        }

        @keyframes char-reveal {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* 타이핑 커서 */
        .typing-cursor {
            display: inline-block;
            width: 3px;
            height: 1em;
            background: #000;
            margin-left: 2px;
            animation: cursor-blink 1s infinite;
            vertical-align: text-bottom;
            transition: opacity 0.5s ease;
        }

        .typing-cursor.hidden {
            opacity: 0;
            animation: none;
        }

        @keyframes cursor-blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* CAPTIONS 하이라이트 */
        .hero-title .line:nth-child(2) {
            position: relative;
            display: inline-block;
        }

        .hero-title .line:nth-child(2).highlight::after {
            content: '';
            position: absolute;
            bottom: 10px;
            left: -5px;
            right: -5px;
            height: 30%;
            background: linear-gradient(90deg, #00f0ff, #a259ff);
            opacity: 0;
            z-index: -1;
            animation: highlight-fade 0.8s 0.3s forwards;
        }

        @keyframes highlight-fade {
            to {
                opacity: 0.2;
            }
        }

        .hero-subtitle {
            font-size: 18px;
            color: #666;
            line-height: 1.6;
            font-family: 'Pretendard', sans-serif;
            opacity: 0;
            animation: fadeIn 1s 1s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* 오른쪽: 채널 폼 */
        .hero-right {
            flex: 0 0 450px;
        }

        .channel-form {
            background: #fff;
            border: 2px solid #000;
            padding: 40px;
            opacity: 0;
            transform: translateY(20px);
            animation: formAppear 0.8s 1.2s forwards;
        }

        @keyframes formAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-title {
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.1em;
            color: #a5a4a4;
            text-transform: uppercase;
            font-family: 'Poppins', sans-serif;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            font-family: 'Pretendard', sans-serif;
            border: 1px solid #313131;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s ease;
        }

        .form-input::placeholder {
            color: #b1b1b1;
        }

        .form-input:focus {
            border-color: #000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Role 버튼 그룹 */
        .role-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .role-btn {
            flex: 1;
            padding: 12px;
            background: #fff;
            border: 1px solid #313131;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .role-btn:hover {
            background: #f5f5f5;
        }

        .role-btn.active {
            background: #000;
            color: #fff;
            border-color: #000;
        }

        /* Submit 버튼들 */
        .enter-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .submit-btn {
            flex: 1;
            padding: 18px;
            border: none;
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        /* Web 버튼 - 검은색 */
        .submit-btn.web-btn {
            background: #000;
            color: #fff;
        }

        .submit-btn.web-btn:hover {
            background: #222;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        /* NUA 뷰어 버튼 - 흰색 테두리 */
        .submit-btn.native-btn {
            background: #fff;
            color: #000;
            border: 2px solid #000;
            display: none; /* 기본적으로 숨김 */
        }

        .submit-btn.native-btn:hover {
            background: #000;
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        /* Guest가 아닐 때 Web 버튼 전체 너비 */
        .enter-buttons .web-btn.full-width {
            flex: 1 0 100%;
            background: #000;
        }

        .enter-buttons .web-btn.full-width:hover {
            background: #222;
        }

        @media screen and (max-width: 1024px) {
            .hero-layout {
                flex-direction: column;
                gap: 60px;
                text-align: center;
            }

            .hero-right {
                flex: 0 0 auto;
                width: 100%;
                max-width: 450px;
            }

            .hero-title .line:nth-child(2)::after {
                left: 10%;
                right: 10%;
            }
        }

        @media screen and (max-width: 820px) {
            .header .menu {
                box-sizing: border-box; 
                display: none; 
                opacity: 0; 
                position: fixed; 
                left: 0; 
                top: 0; 
                width: 100vw; 
                height: 100vh; 
                transform: translateX(100%); 
                background: #000; 
                z-index: 100; 
                padding-top: 100px; 
                transition: .4s allow-discrete;
            }
            
            .header.HmActive .menu {
                display: block; 
                opacity: 1; 
                transform: translateX(0%);
            }
            
            .header .menu ul {
                flex-direction: column; 
                align-items: center; 
                gap: 0px;
            }
            
            .header .menu li {
                font-size: 20px; 
                border-top: 1px solid #333; 
                width: 100%;
                color: #fff;
            }
            
            .header .menu li a {
                padding: 10px 2.5%; 
                display: block; 
                box-sizing: border-box; 
                width: 100%;
                color: #fff;
            }
            
            .header .hamburger {
                display: flex;
            }
            
            .header .lang {
                position: absolute; 
                bottom: 0; 
                left: 0; 
                margin-left: calc(30/16*1em); 
                margin-bottom: calc(30/16*1em); 
                font-size: 16px;
            }
            
            .header .lang .lang_list_wrap {
                top: auto; 
                bottom: 100%;
            }

            .hero {
                padding: 100px 20px 60px;
            }

            .channel-form {
                padding: 30px 20px;
            }
        }

        @media screen and (max-width: 480px) {
            .hero-title {
                font-size: clamp(45px, 12vw, 70px);
            }

            .role-group {
                flex-direction: column;
            }

            .role-btn {
                width: 100%;
            }
        }

        /* 관리자 로그인 모달 */
        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
            backdrop-filter: blur(10px);
            animation: modalFadeIn 0.3s ease;
        }

        .admin-modal.show {
            display: flex;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .admin-modal-content {
            background: #fff;
            width: 100%;
            max-width: 450px;
            border: 2px solid #000;
            position: relative;
            animation: modalSlideUp 0.4s ease;
        }

        @keyframes modalSlideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .admin-modal-header {
            padding: 30px 40px;
            border-bottom: 1px solid #e0e0e0;
            position: relative;
        }

        .admin-modal-title {
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.1em;
            color: #a5a4a4;
            text-transform: uppercase;
            font-family: 'Poppins', sans-serif;
            margin-bottom: 10px;
        }

        .admin-channel-code {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: 0.05em;
            font-family: 'Poppins', sans-serif;
            color: #000;
        }

        .admin-modal-close {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .admin-modal-close:hover {
            transform: rotate(90deg);
        }

        .admin-modal-close::before,
        .admin-modal-close::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 2px;
            background: #000;
        }

        .admin-modal-close::before {
            transform: rotate(45deg);
        }

        .admin-modal-close::after {
            transform: rotate(-45deg);
        }

        .admin-modal-body {
            padding: 40px;
        }

        .admin-form-group {
            margin-bottom: 25px;
        }

        .admin-form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 10px;
            font-family: 'Poppins', sans-serif;
        }

        .admin-form-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            font-family: 'Pretendard', sans-serif;
            border: 1px solid #313131;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s ease;
        }

        .admin-form-input::placeholder {
            color: #b1b1b1;
        }

        .admin-form-input:focus {
            border-color: #000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .admin-form-input.error {
            border-color: #ff3838;
        }

        .admin-error {
            color: #ff3838;
            font-size: 12px;
            margin-top: 8px;
            display: none;
        }

        .admin-error.show {
            display: block;
        }

        .admin-alert {
            padding: 15px 20px;
            background: #000;
            color: #fff;
            font-size: 14px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
        }

        .admin-alert.show {
            display: block;
        }

        .admin-alert.error {
            background: #ff3838;
        }

        .admin-alert.success {
            background: #000;
        }

        .admin-submit-btn {
            width: 100%;
            padding: 18px;
            background: #000;
            color: #fff;
            border: none;
            font-size: 15px;
            font-weight: 600;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .admin-submit-btn:hover {
            background: #222;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .admin-submit-btn.loading {
            color: transparent;
            pointer-events: none;
        }

        .admin-submit-btn.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid #fff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spinner 0.8s linear infinite;
        }

        @keyframes spinner {
            to { transform: rotate(360deg); }
        }

        @media screen and (max-width: 480px) {
            .admin-modal-header {
                padding: 25px;
            }

            .admin-modal-body {
                padding: 25px;
            }

            .admin-modal-close {
                top: 25px;
                right: 25px;
            }

            .admin-channel-code {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- 경로 및 API 설정 스크립트 -->
    <script>
        // GitHub Pages 서브패스 대비: 현재 디렉토리 경로
        const BASE = window.location.pathname.replace(/[^/]+$/, '');
        // 백엔드 API 베이스 - config.js에서 설정된 SOCKET_URL 사용
        const API_BASE = window.CONFIG?.SOCKET_URL || 'http://localhost:3000';
        
        // 채널 검증 함수
        async function validateChannel(code, password) {
            try {
                const url = `${API_BASE}/api/channels/validate?code=${encodeURIComponent(code)}`;
                const res = await fetch(url, { 
                    method: 'GET', 
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!res.ok) return false;
                
                const data = await res.json();
                // 서버 응답에서 valid 필드 확인
                // password 검증이 서버에서 필요한 경우 추가 로직 구현
                return !!data?.valid;
            } catch (e) {
                console.error('validateChannel error:', e);
                return false;
            }
        }

        // 관리자 로그인 함수
        async function adminLogin(channelCode, adminId, password) {
            try {
                const url = `${API_BASE}/api/admin/login`;
                const res = await fetch(url, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        channel: channelCode,
                        username: adminId,
                        password: password
                    })
                });

                if (!res.ok) {
                    const error = await res.json();
                    return { success: false, message: error.message || '로그인 실패' };
                }

                const data = await res.json();
                return { success: true, data };
            } catch (e) {
                console.error('adminLogin error:', e);
                return { success: false, message: '서버 연결 오류' };
            }
        }
    </script>

    <!-- 헤더 -->
    <header class="header">
        <div class="wrap">
            <div class="logo">
                <a href="index.html">
                    <svg viewBox="0 0 122 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 25C0 11.193 11.193 0 25 0h72c13.807 0 25 11.193 25 25s-11.193 25-25 25H25C11.193 50 0 38.807 0 25z" fill="#000"/>
                        <text x="61" y="32" text-anchor="middle" fill="white" font-family="Poppins" font-size="20" font-weight="700">NUA</text>
                    </svg>
                </a>
            </div>
            <div class="menu">
                <ul>
                    <li><a href="about.html">소개</a></li>
                    <li><a href="contact.html">접수</a></li>
                    <li><a href="recruit.html">모집</a></li>
                </ul>
                <div class="lang">
                    <div class="lang_current">
                        <i class="xi-globus"></i>
                        <span>KR</span>
                        <i class="xi-angle-down"></i>
                    </div>
                    <div class="lang_list_wrap">
                        <div class="lang_list">
                            <a href="#">EN</a>
                            <a href="#">JP</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>

    <!-- 관리자 로그인 모달 -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <div class="admin-modal-title">Admin Login</div>
                <div class="admin-channel-code" id="adminChannelDisplay">-</div>
                <button class="admin-modal-close" id="adminModalClose"></button>
            </div>
            <div class="admin-modal-body">
                <div class="admin-alert" id="adminAlert"></div>
                <form id="adminLoginForm">
                    <div class="admin-form-group">
                        <label class="admin-form-label" for="adminId">관리자 아이디</label>
                        <input 
                            type="text" 
                            class="admin-form-input" 
                            id="adminId" 
                            placeholder="관리자 아이디 입력"
                            autocomplete="username"
                        >
                        <div class="admin-error" id="adminIdError">아이디를 입력해주세요</div>
                    </div>
                    <div class="admin-form-group">
                        <label class="admin-form-label" for="adminPassword">비밀번호</label>
                        <input 
                            type="password" 
                            class="admin-form-input" 
                            id="adminPassword" 
                            placeholder="비밀번호 입력"
                            autocomplete="current-password"
                        >
                        <div class="admin-error" id="adminPasswordError">비밀번호를 입력해주세요</div>
                    </div>
                    <button type="submit" class="admin-submit-btn" id="adminSubmitBtn">
                        LOGIN →
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- 히어로 섹션 -->
    <section id="hero" class="hero">
        <!-- 배경 오브젝트 -->
        <div class="bg-objects">
            <div class="bg-circle _1"></div>
            <div class="bg-circle _2"></div>
        </div>

        <!-- 컨테이너 -->
        <div class="container">
            <div class="hero-layout">
                <!-- 왼쪽: 타이틀 -->
                <div class="hero-left">
                    <h1 class="hero-title">
                        <span class="line" id="line1"></span>
                        <span class="line" id="line2"></span>
                        <span class="line" id="line3"></span>
                    </h1>
                    <p class="hero-subtitle" id="heroSubtitle">
                        모두를 위한 자막
                    </p>
                </div>

                <!-- 오른쪽: 채널 폼 -->
                <div class="hero-right">
                    <form class="channel-form" id="channelForm">
                        <div class="form-title">Enter Channel</div>
                        
                        <div class="form-group">
                            <input type="text" class="form-input" placeholder="채널 코드 (6자리)" maxlength="6" id="channelCode">
                        </div>
                        
                        <div class="form-group">
                            <input type="password" class="form-input" placeholder="비밀번호" id="channelPassword">
                        </div>
                        
                        <div class="role-group">
                            <button type="button" class="role-btn active" data-role="guest">GUEST</button>
                            <button type="button" class="role-btn" data-role="steno">STENO</button>
                            <button type="button" class="role-btn" data-role="admin">ADMIN</button>
                        </div>
                        
                        <!-- Enter 버튼들 -->
                        <div class="enter-buttons" id="enterButtons">
                            <button type="submit" class="submit-btn web-btn" id="webEnterBtn">
                                WEB →
                            </button>
                            <button type="button" class="submit-btn native-btn" id="nativeViewerBtn">
                                NUA 뷰어
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script>
        // 타이핑 효과 함수
        function startTypingEffect() {
            const lines = [
                { element: document.getElementById('line1'), text: 'LIVE' },
                { element: document.getElementById('line2'), text: 'CAPTIONS' },
                { element: document.getElementById('line3'), text: 'FOR EVERYONE' }
            ];
            
            const subtitle = document.getElementById('heroSubtitle');
            const formContainer = document.querySelector('.channel-form');
            
            // 모든 문자를 담을 배열
            const allChars = [];
            let currentIndex = 0;
            
            // 각 줄의 문자 생성
            lines.forEach((line, lineIndex) => {
                if (!line.element) return;
                
                // 각 문자를 span으로 생성
                for (let i = 0; i < line.text.length; i++) {
                    const char = document.createElement('span');
                    char.className = 'typing-char random-number';
                    
                    if (line.text[i] === ' ') {
                        char.innerHTML = '&nbsp;';
                        char.style.width = '0.3em';
                        char.style.display = 'inline-block';
                    } else {
                        char.textContent = Math.floor(Math.random() * 10);
                    }
                    
                    line.element.appendChild(char);
                    
                    allChars.push({
                        element: char,
                        finalChar: line.text[i],
                        lineIndex: lineIndex,
                        lineElement: line.element
                    });
                }
            });
            
            // 커서 생성
            const cursor = document.createElement('span');
            cursor.className = 'typing-cursor';
            
            // 첫 번째 줄 시작 위치에 커서 배치
            if (lines[0].element) {
                lines[0].element.appendChild(cursor);
            }
            
            // 랜덤 숫자 애니메이션
            const randomInterval = setInterval(() => {
                allChars.forEach((char, index) => {
                    if (index >= currentIndex && char.finalChar !== ' ') {
                        if (char.element.classList.contains('random-number')) {
                            char.element.textContent = Math.floor(Math.random() * 10);
                        }
                    }
                });
            }, 50);
            
            // 문자 하나씩 공개
            const typingInterval = setInterval(() => {
                if (currentIndex < allChars.length) {
                    const current = allChars[currentIndex];
                    
                    // 실제 문자로 변경
                    if (current.finalChar === ' ') {
                        current.element.innerHTML = '&nbsp;';
                    } else {
                        current.element.textContent = current.finalChar;
                    }
                    
                    current.element.classList.remove('random-number');
                    current.element.classList.add('revealed');
                    
                    // 커서 위치 이동
                    if (currentIndex < allChars.length - 1) {
                        const next = allChars[currentIndex + 1];
                        
                        // 다음 줄로 이동해야 하는 경우
                        if (current.lineIndex !== next.lineIndex) {
                            // 현재 줄에서 커서 제거
                            cursor.remove();
                            // 다음 줄 첫 위치에 커서 추가
                            next.lineElement.insertBefore(cursor, next.lineElement.firstChild);
                        } else {
                            // 같은 줄 내에서 이동
                            current.element.parentNode.insertBefore(cursor, current.element.nextSibling);
                        }
                    } else {
                        // 마지막 문자 뒤에 커서 배치
                        current.element.parentNode.appendChild(cursor);
                    }
                    
                    currentIndex++;
                } else {
                    // 타이핑 완료
                    clearInterval(randomInterval);
                    clearInterval(typingInterval);
                    
                    // 커서 숨기기
                    setTimeout(() => {
                        cursor.classList.add('hidden');
                        
                        // CAPTIONS 하이라이트 추가
                        const line2 = document.getElementById('line2');
                        if (line2) {
                            line2.classList.add('highlight');
                        }
                        
                        // 서브타이틀과 폼 보이기
                        if (subtitle) {
                            subtitle.style.opacity = '0';
                            subtitle.style.animation = 'fadeIn 1s forwards';
                        }
                        
                        if (formContainer) {
                            setTimeout(() => {
                                formContainer.style.opacity = '0';
                                formContainer.style.transform = 'translateY(20px)';
                                formContainer.style.animation = 'formAppear 0.8s forwards';
                            }, 300);
                        }
                    }, 500);
                }
            }, 70); // 각 문자 타이핑 속도
        }

        // 페이지 로드 시 타이핑 효과 시작
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(startTypingEffect, 500);
        });

        // Hamburger 메뉴
        document.querySelector('.hamburger')?.addEventListener('click', function() {
            document.querySelector('.header').classList.toggle('HmActive');
        });

        // Language 드롭다운
        document.querySelector('.lang_current')?.addEventListener('click', function() {
            const langList = document.querySelector('.lang_list_wrap');
            if (langList.style.display === 'block') {
                langList.style.display = 'none';
            } else {
                langList.style.display = 'block';
            }
        });

        // Role 버튼 - 전용뷰어 표시/숨김 로직
        const roleButtons = document.querySelectorAll('.role-btn');
        const webEnterBtn = document.getElementById('webEnterBtn');
        const nativeViewerBtn = document.getElementById('nativeViewerBtn');
        let selectedRole = 'guest';

        roleButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                roleButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedRole = btn.getAttribute('data-role');
                
                // Role에 따라 버튼 표시 변경
                if (selectedRole === 'guest') {
                    // GUEST: 2개 버튼 표시
                    nativeViewerBtn.style.display = 'flex';
                    webEnterBtn.innerHTML = 'WEB →';
                    webEnterBtn.classList.remove('full-width');
                } else {
                    // STENO/ADMIN: 1개 버튼만 표시
                    nativeViewerBtn.style.display = 'none';
                    webEnterBtn.innerHTML = 'ENTER →';
                    webEnterBtn.classList.add('full-width');
                }
            });
        });

        // 채널 코드 자동 대문자
        const channelInput = document.getElementById('channelCode');
        if (channelInput) {
            channelInput.addEventListener('input', (e) => {
                e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            });
        }

        // 전용뷰어 버튼 클릭 처리
        if (nativeViewerBtn) {
            nativeViewerBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                const channelCode = channelInput?.value;
                const password = document.getElementById('channelPassword')?.value || '';
                
                if (!channelCode) {
                    alert('채널 코드를 입력해주세요');
                    return;
                }
                
                if (channelCode.length !== 6) {
                    alert('채널 코드는 6자리여야 합니다');
                    return;
                }
                
                // 채널 검증
                const isValid = await validateChannel(channelCode, password);
                if (!isValid) {
                    alert('존재하지 않거나 비활성화된 채널입니다.');
                    return;
                }
                
                // 딥링크로 전용뷰어 실행
                const deepLink = `nuaviewer://join?channel=${channelCode}`;
                window.location.href = deepLink;
                
                // 3초 후 앱이 실행되지 않았을 경우
                setTimeout(() => {
                    if (document.visibilityState === 'visible') {
                        const userConfirm = confirm(
                            'NUA 뷰어가 실행되지 않았나요?\n' +
                            '다운로드 페이지로 이동하시겠습니까?'
                        );
                        
                        if (userConfirm) {
                            window.location.href = BASE + 'download/nuaviewer.html';
                        }
                    }
                }, 3000);
            });
        }

        // 폼 제출 (Web 버튼)
        document.getElementById('channelForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // 입력값 취득
            const channel = (document.getElementById('channelCode')?.value || '').trim();
            const password = (document.getElementById('channelPassword')?.value || '').trim();
            const role = selectedRole.toUpperCase();
            
            // 기본 유효성 검사
            if (!channel) {
                alert('채널 코드를 입력해주세요');
                return;
            }
            
            if (channel.length !== 6) {
                alert('채널 코드는 6자리여야 합니다');
                return;
            }
            
            // 채널 검증
            const isValid = await validateChannel(channel, password);
            if (!isValid) {
                alert('존재하지 않거나 비활성화된 채널입니다.');
                return;
            }
            
            // ADMIN 역할인 경우 모달 표시
            if (role === 'ADMIN') {
                const adminModal = document.getElementById('adminModal');
                const adminChannelDisplay = document.getElementById('adminChannelDisplay');
                
                // 채널 코드 표시
                adminChannelDisplay.textContent = channel;
                
                // 모달 표시
                adminModal.classList.add('show');
                
                // 첫 번째 입력 필드에 포커스
                setTimeout(() => {
                    document.getElementById('adminId').focus();
                }, 100);
                
                return; // 모달에서 처리하므로 여기서 종료
            }
            
            // 쿼리 스트링 생성
            const qs = `?channel=${encodeURIComponent(channel)}${password ? `&password=${encodeURIComponent(password)}` : ''}`;
            
            // 역할별 페이지 라우팅 (상대경로 사용)
            if (role === 'GUEST') {
                window.location.href = BASE + 'viewer.html' + qs;
            } else if (role === 'STENO') {
                window.location.href = BASE + 'editor.html' + qs;
            } else {
                // 기본값: 뷰어로 이동
                window.location.href = BASE + 'viewer.html' + qs;
            }
        });

        // 관리자 모달 관련 이벤트
        const adminModal = document.getElementById('adminModal');
        const adminModalClose = document.getElementById('adminModalClose');
        const adminLoginForm = document.getElementById('adminLoginForm');
        
        // 모달 닫기 버튼
        adminModalClose?.addEventListener('click', () => {
            adminModal.classList.remove('show');
            // 입력 필드 초기화
            document.getElementById('adminId').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminAlert').classList.remove('show');
            document.querySelectorAll('.admin-form-input').forEach(input => {
                input.classList.remove('error');
            });
            document.querySelectorAll('.admin-error').forEach(error => {
                error.classList.remove('show');
            });
        });

        // 모달 배경 클릭 시 닫기
        adminModal?.addEventListener('click', (e) => {
            if (e.target === adminModal) {
                adminModalClose.click();
            }
        });

        // ESC 키로 모달 닫기
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && adminModal?.classList.contains('show')) {
                adminModalClose.click();
            }
        });

        // 관리자 로그인 폼 제출
        adminLoginForm?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // 초기화
            document.querySelectorAll('.admin-form-input').forEach(input => {
                input.classList.remove('error');
            });
            document.querySelectorAll('.admin-error').forEach(error => {
                error.classList.remove('show');
            });
            
            // 입력값 가져오기
            const adminId = document.getElementById('adminId').value.trim();
            const adminPassword = document.getElementById('adminPassword').value;
            const channelCode = document.getElementById('channelCode').value.trim();
            
            let hasError = false;
            
            // 유효성 검사
            if (!adminId) {
                document.getElementById('adminId').classList.add('error');
                document.getElementById('adminIdError').classList.add('show');
                hasError = true;
            }
            
            if (!adminPassword) {
                document.getElementById('adminPassword').classList.add('error');
                document.getElementById('adminPasswordError').classList.add('show');
                hasError = true;
            }
            
            if (hasError) return;
            
            // 로딩 상태
            const submitBtn = document.getElementById('adminSubmitBtn');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            // 로그인 시도
            const result = await adminLogin(channelCode, adminId, adminPassword);
            
            // 로딩 상태 해제
            submitBtn.classList.remove('loading');
            submitBtn.disabled = false;
            
            const alertBox = document.getElementById('adminAlert');
            
            if (result.success) {
                // 성공
                alertBox.textContent = '로그인 성공! 관리 페이지로 이동합니다...';
                alertBox.className = 'admin-alert success show';
                
                // 토큰 저장 (선택사항)
                if (result.data?.token) {
                    localStorage.setItem('adminToken', result.data.token);
                }
                
                // 관리 대시보드로 이동
                setTimeout(() => {
                    window.location.href = BASE + `channel-manager.html?channel=${encodeURIComponent(channelCode)}`;
                }, 1500);
            } else {
                // 실패
                alertBox.textContent = result.message || '로그인에 실패했습니다.';
                alertBox.className = 'admin-alert error show';
                
                // 비밀번호 필드 포커스
                document.getElementById('adminPassword').focus();
                document.getElementById('adminPassword').select();
            }
        });

        // 관리자 입력 필드 에러 상태 제거
        document.querySelectorAll('.admin-form-input').forEach(input => {
            input.addEventListener('input', () => {
                input.classList.remove('error');
                const errorMsg = input.parentElement.querySelector('.admin-error');
                if (errorMsg) {
                    errorMsg.classList.remove('show');
                }
                
                // 알림 메시지 숨기기
                const alertBox = document.getElementById('adminAlert');
                if (alertBox) {
                    alertBox.classList.remove('show');
                }
            });
        });
    </script>
</body>
</html>
