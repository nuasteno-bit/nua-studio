<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUA STUDIO – Live Steno Editor</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">
    
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="config.js"></script>
    
    <!-- CSS 파일 연결 -->
    <link rel="stylesheet" href="editor_styles.css">
    
    <!-- Neon 테마 select 가독성 수정 -->
    <style>
        /* Neon 테마에서 select 옵션 가독성 개선 */
        [data-theme="neon"] .theme-select {
            background: rgba(10,10,10,0.95);
            color: #00f0ff;
            border-color: rgba(0,240,255,0.4);
        }
        
        [data-theme="neon"] .theme-select option {
            background: #0a0a0a;
            color: #ffffff;
        }
        
        [data-theme="neon"] .theme-select:hover {
            background: rgba(0,240,255,0.1);
            border-color: #00f0ff;
        }
        
        /* 모니터링 뷰어 구조 수정 */
        .viewer-content-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }
        
        #viewerContent {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
            background: var(--input-bg);
            border: 2px solid var(--input-border);
            border-radius: 12px;
            margin: 0 20px;
            font-size: 15px;
            line-height: 1.8;
            color: var(--text-primary);
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        
        #viewerContent span {
            display: block;
        }
        
        /* 뷰어 편집 모드 스타일 수정 */
        .viewer.editing #viewerContent {
            border-color: #f39c12;
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.4);
            background-color: var(--bg-tertiary);
        }
        
        /* 기존 wrapper 제거 */
        .viewer-content-wrapper {
            display: none;
        }
        
        /* panel-body 수정 */
        #viewer-body {
            display: flex;
            flex-direction: column;
            padding: 20px 0;
        }
    </style>
</head>
<body data-theme="light">
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <svg viewBox="0 0 122 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 25C0 11.193 11.193 0 25 0h72c13.807 0 25 11.193 25 25s-11.193 25-25 25H25C11.193 50 0 38.807 0 25z" fill="#000"/>
                    <text x="61" y="32" text-anchor="middle" fill="white" font-family="Poppins" font-size="20" font-weight="700">NUA</text>
                </svg>
            </div>
            <div class="channel-info">
                <span class="channel-badge live">
                    <span class="status-dot"></span>
                    LIVE
                </span>
                <span>Channel: <strong id="channelInfo">default</strong></span>
                <span>Role: <strong id="roleInfo">속기사1</strong></span>
                
                <!-- 권한매칭 단어 수 설정 (기존 위치 유지) -->
                <span id="matchControl" style="margin-left: 20px;">
                    <span style="font-size:13px; color:var(--text-secondary);">권한매칭 단어 수:</span>
                    <select id="matchWordSelect" style="font-size:13px; padding:2px 8px; border-radius:4px; border:1px solid var(--border); background:var(--bg-primary); color:var(--text-primary);">
                        <option value="3" selected>3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                    </select>
                </span>
            </div>
        </div>
        <div class="header-right">
            <div class="status-indicator">
                <span class="status-dot" id="connectionDot"></span>
                <span id="connectionStatus">연결됨</span>
                <span id="statusInfo" style="display:none;">HTML 모드</span>
            </div>
            
            <!-- Theme Toggle -->
            <select class="theme-select" onchange="setTheme(this.value)">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="neon">Neon</option>
                <option value="mono">Mono</option>
                <option value="tokyo">Tokyo</option>
            </select>
            
            <button class="btn-icon" onclick="toggleFullscreen()" title="전체화면">
                <i class="xi-expand-square"></i>
            </button>
        </div>
    </header>

    <!-- Main Container - 2x2 레이아웃 유지 -->
    <div class="main-container" id="mainContainer">
        <!-- 상단 영역: 속기사1, 속기사2 -->
        <div class="top-row" id="topRow">
            <!-- Editor 1 Column -->
            <div class="column" id="col1">
                <div class="editor-card" id="editor1Card">
                    <div class="editor-header">
                        <div class="editor-info">
                            <span class="editor-title" id="title1">Stenographer 1</span>
                            <span class="role-badge" id="badge1">대기</span>
                        </div>
                        <div class="editor-controls">
                            <button class="font-btn" onclick="adjustFontSize(1, -1)" title="글자 작게">A−</button>
                            <button class="font-btn" onclick="adjustFontSize(1, 1)" title="글자 크게">A+</button>
                        </div>
                    </div>
                    <!-- 성능 정보 (기존 font-controls 대체) -->
                    <div class="font-controls" id="font-controls-1">
                        <div class="performance-info" id="performanceInfo1">
                            <span id="perfChars1">0자</span>
                            <span id="perfStatus1">최적화됨</span>
                            <span id="perfMonitor1">0/30줄</span>
                        </div>
                    </div>
                    <div class="editor-content">
                        <textarea 
                            class="editor-textarea editor-box" 
                            id="editor1"
                            placeholder="여기에 입력..."
                            autocomplete="off"
                        ></textarea>
                    </div>
                    <div class="editor-footer status-bar" id="statusBar1">
                        <span class="char-count" id="charCount1">0자</span>
                        <div style="display:flex;align-items:center;gap:8px;">
                            <span class="status-dot waiting" id="dot1"></span>
                            <span id="statusText1">대기 중</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Editor 2 Column -->
            <div class="column" id="col2">
                <div class="editor-card" id="editor2Card">
                    <div class="editor-header">
                        <div class="editor-info">
                            <span class="editor-title" id="title2">Stenographer 2</span>
                            <span class="role-badge" id="badge2">대기</span>
                        </div>
                        <div class="editor-controls">
                            <button class="font-btn" onclick="adjustFontSize(2, -1)" title="글자 작게">A−</button>
                            <button class="font-btn" onclick="adjustFontSize(2, 1)" title="글자 크게">A+</button>
                        </div>
                    </div>
                    <!-- 성능 정보 -->
                    <div class="font-controls" id="font-controls-2">
                        <div class="performance-info" id="performanceInfo2">
                            <span id="perfChars2">0자</span>
                            <span id="perfStatus2">최적화됨</span>
                            <span id="perfMonitor2"></span>
                        </div>
                    </div>
                    <div class="editor-content">
                        <textarea 
                            class="editor-textarea editor-box" 
                            id="editor2"
                            placeholder="여기에 입력..."
                            autocomplete="off"
                        ></textarea>
                    </div>
                    <div class="editor-footer status-bar" id="statusBar2">
                        <span class="char-count" id="charCount2">0자</span>
                        <div style="display:flex;align-items:center;gap:8px;">
                            <span class="status-dot waiting" id="dot2"></span>
                            <span id="statusText2">대기 중</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 하단 영역: 모니터링뷰어, 유틸리티 -->
        <div class="bottom-row">
            <!-- Viewer Panel -->
            <div class="viewer panel-card" id="viewer">
                <div class="panel-header title-bar">
                    <div class="panel-title">
                        Monitoring Viewer
                        <span id="viewerIconBtn" onclick="openViewerWindow()" title="Open Viewer in new window" style="cursor: pointer; padding: 4px; display: inline-flex; align-items: center; justify-content: center; background: var(--bg-tertiary); border-radius: 4px; border: 1px solid var(--border); margin-left: 8px;">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zM4 18V6h16v12H4zm4-2h2v-2H6v2h2zm0-4h8v-2H8v2zm4 4h6v-2h-6v2z"/>
                            </svg>
                        </span>
                    </div>
                    <div class="editor-controls">
                        <button class="viewer-edit-btn" id="viewerEditBtn" onclick="toggleViewerEdit()" title="뷰어 편집" style="display: none;">편집</button>
                        <button class="font-btn" onclick="adjustViewerFontSize(-1)" title="글자 작게">A−</button>
                        <button class="font-btn" onclick="adjustViewerFontSize(1)" title="글자 크게">A+</button>
                        <button class="font-btn" onclick="saveViewerText()" title="내보내기">
                            <i class="xi-download"></i>
                        </button>
                    </div>
                </div>
                <div class="panel-content panel-body" id="viewer-body">
                    <div class="viewer-content-container">
                        <div id="viewerContent" style="font-size: 15px;">
                            <span class="viewer-placeholder">자막이 여기에 표시됩니다.</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="utility panel-card" id="utility">
                <div class="panel-header title-bar">
                    <div class="panel-title utility-title">
                        Control Center
                    </div>
                </div>
                
                <!-- Tabs - 소통을 메시지로 변경 -->
                <div class="panel-tabs tab-nav">
                    <button class="panel-tab tab-btn active" data-tab="control" onclick="switchTabFixed('control', this)">제어</button>
                    <button class="panel-tab tab-btn" data-tab="chat" onclick="switchTabFixed('chat', this)">
                        메시지
                        <span class="chat-badge" id="chatBadge" style="display: none;">0</span>
                    </button>
                    <button class="panel-tab tab-btn" data-tab="settings" onclick="switchTabFixed('settings', this)">설정</button>
                </div>

                <div class="panel-content panel-body compact" id="utility-body">
                    <!-- Controls Tab -->
                    <div class="tab-content active" id="control-tab">
                        <div class="control-group compact">
                            <div class="control-label">권한 관리</div>
                            <div class="control-buttons">
                                <button class="control-btn ctrl-btn compact" onclick="requestRole()">
                                    <i class="xi-hand-paper"></i> 권한 요청
                                </button>
                                <button class="control-btn ctrl-btn compact" onclick="offerRole()">
                                    <i class="xi-share-alt"></i> 권한 양보
                                </button>
                                <button class="control-btn ctrl-btn danger warning compact" onclick="forceGetRole()">
                                    <i class="xi-warning"></i> 강제 획득
                                </button>
                                <button class="control-btn ctrl-btn compact" onclick="correctionRequest()">
                                    <i class="xi-pen"></i> 교정 요청
                                </button>
                            </div>
                        </div>
                        
                        <div class="control-group compact">
                            <div class="control-label">데이터 관리</div>
                            <div class="control-buttons">
                                <button class="control-btn ctrl-btn primary compact" onclick="downloadFullText()">
                                    <i class="xi-download"></i> 전체 다운로드
                                </button>
                                <button class="control-btn ctrl-btn compact" onclick="clearLocalStorage()">
                                    <i class="xi-refresh"></i> 캐시 초기화
                                </button>
                            </div>
                        </div>

                        <div class="control-group compact">
                            <div class="control-label">연결 상태</div>
                            <div class="status-info-box status-row compact">
                                <div class="status-info-row status-mini">
                                    <span class="status-info-label">내 연결:</span>
                                    <span class="status-info-value stat-val good" id="myConnectionStatus">정상</span>
                                </div>
                                <div class="status-info-row status-mini">
                                    <span class="status-info-label">상대:</span>
                                    <span class="status-info-value stat-val" id="otherConnectionStatus">대기</span>
                                </div>
                                <div class="status-info-row status-mini">
                                    <span class="status-info-label">핑:</span>
                                    <span class="status-info-value stat-val" id="serverPing">-ms</span>
                                </div>
                            </div>
                            <button class="control-btn ctrl-btn mini compact" onclick="checkConnection()" style="margin-top:6px;">연결 확인</button>
                        </div>
                    </div>

                    <!-- Chat Tab -->
                    <div class="tab-content" id="chat-tab">
                        <div class="chat-container compact">
                            <div class="chat-messages compact" id="chatMessages">
                                <div class="chat-placeholder" style="text-align: center; color: var(--text-tertiary); padding: 40px 20px;">
                                    <i class="xi-message-o" style="font-size: 28px; margin-bottom: 8px; opacity: 0.5;"></i>
                                    <div>채팅 메시지가 없습니다</div>
                                </div>
                            </div>
                            <div class="chat-input-container chat-input-group compact">
                                <input 
                                    type="text" 
                                    class="chat-input compact" 
                                    id="chatInput"
                                    placeholder="메시지를 입력하세요..."
                                    maxlength="200"
                                >
                                <button class="chat-send chat-send-btn compact" onclick="sendChatMessage()">
                                    <i class="xi-telegram"></i> 전송
                                </button>
                            </div>
                            <div class="quick-actions chat-quick-messages compact">
                                <button class="quick-action-btn quick-msg-btn compact" onclick="sendQuickMessage('확인했습니다')">확인</button>
                                <button class="quick-action-btn quick-msg-btn compact" onclick="sendQuickMessage('교대하겠습니다')">교대</button>
                                <button class="quick-action-btn quick-msg-btn compact" onclick="sendQuickMessage('잠시만요')">대기</button>
                                <button class="quick-action-btn quick-msg-btn compact" onclick="sendQuickMessage('도움이 필요해요')">도움</button>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div class="tab-content" id="settings-tab">
                        <!-- 테마 설정 -->
                        <div class="settings-section compact">
                            <h4>테마 설정</h4>
                            <div class="theme-selector compact">
                                <button class="theme-option dark compact" onclick="setTheme('dark')" title="다크 테마">다크</button>
                                <button class="theme-option light active compact" onclick="setTheme('light')" title="라이트 테마">라이트</button>
                                <button class="theme-option neon compact" onclick="setTheme('neon')" title="네온">네온</button>
                                <button class="theme-option mono compact" onclick="setTheme('mono')" title="모노">모노</button>
                                <button class="theme-option tokyo compact" onclick="setTheme('tokyo')" title="도쿄">도쿄</button>
                            </div>
                        </div>
                        
                        <!-- 텍스트 개인화 -->
                        <div class="settings-section compact">
                            <h4>텍스트 설정</h4>
                            <div class="text-settings-grid">
                                <div class="setting-item text-setting-item compact">
                                    <div class="setting-label">
                                        <span>글자 크기</span>
                                        <span class="setting-value" id="fontSizeValue">15px</span>
                                    </div>
                                    <div class="setting-control-buttons">
                                        <button class="setting-btn" onclick="updateFontSizeButton(-1)">▼</button>
                                        <button class="setting-btn" onclick="updateFontSizeButton(1)">▲</button>
                                    </div>
                                    <input type="hidden" id="fontSizeRange" value="15">
                                </div>

                                <div class="setting-item text-setting-item compact">
                                    <div class="setting-label">
                                        <span>줄 간격</span>
                                        <span class="setting-value" id="lineHeightValue">1.8</span>
                                    </div>
                                    <div class="setting-control-buttons">
                                        <button class="setting-btn" onclick="updateLineHeightButton(-1)">▼</button>
                                        <button class="setting-btn" onclick="updateLineHeightButton(1)">▲</button>
                                    </div>
                                    <input type="hidden" id="lineHeightRange" value="18">
                                </div>

                                <div class="setting-item text-setting-item compact">
                                    <div class="setting-label">
                                        <span>권한매칭 단어</span>
                                        <span class="setting-value" id="matchWordValue">3</span>
                                    </div>
                                    <div class="setting-control-buttons">
                                        <button class="setting-btn" onclick="updateMatchWordsButton(-1)">▼</button>
                                        <button class="setting-btn" onclick="updateMatchWordsButton(1)">▲</button>
                                    </div>
                                    <input type="hidden" id="matchWordSlider" value="3">
                                </div>
                            </div>
                            
                            <!-- 추가 텍스트 설정 (기존 JS 호환) -->
                            <div class="text-setting-item" style="display:none;">
                                <label>자간</label>
                                <div class="setting-control">
                                    <input type="range" id="letterSpacingRange" min="-2" max="5" value="0" onchange="updateTextSettings()">
                                    <span id="letterSpacingValue">0px</span>
                                </div>
                            </div>
                            <div class="text-setting-item" style="display:none;">
                                <label>단어 간격</label>
                                <div class="setting-control">
                                    <input type="range" id="wordSpacingRange" min="-2" max="10" value="0" onchange="updateTextSettings()">
                                    <span id="wordSpacingValue">0px</span>
                                </div>
                            </div>
                        </div>

                        <!-- 단축키 -->
                        <div class="control-group compact">
                            <div class="control-label">단축키</div>
                            <div class="shortcuts-list shortcut-info compact">
                                <div class="shortcut-item compact">
                                    <span>단어 삭제</span>
                                    <span class="shortcut-key">F4</span>
                                </div>
                                <div class="shortcut-item compact">
                                    <span>권한 양보</span>
                                    <span class="shortcut-key">F6</span>
                                </div>
                                <div class="shortcut-item compact">
                                    <span>권한 요청</span>
                                    <span class="shortcut-key">F7</span>
                                </div>
                                <div class="shortcut-item compact">
                                    <span>교정 요청</span>
                                    <span class="shortcut-key">F8</span>
                                </div>
                                <div class="shortcut-item compact">
                                    <span>엔터 모드</span>
                                    <span class="shortcut-key">Shift+Enter</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        NUA STUDIO Live Steno Editor - Real-time Collaboration
    </footer>

    <!-- JavaScript 파일 연결 -->
    <script src="editor_script.js"></script>
    
    <!-- 추가 헬퍼 함수들 (기존 디자인과 호환) -->
    <script>
        // Fixed Tab switching function
        function switchTabFixed(tabName, buttonElement) {
            // 채팅 탭일 때 배지 리셋
            if (tabName === 'chat') {
                if (typeof unreadMessages !== 'undefined') {
                    unreadMessages = 0;
                }
                if (typeof updateChatBadge === 'function') {
                    updateChatBadge();
                }
            }
            
            // 모든 탭 버튼의 active 클래스 제거
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // 모든 탭 컨텐츠 숨기기
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // 클릭한 버튼에 active 추가
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // 해당 탭 컨텐츠 보이기
            const tabContent = document.getElementById(tabName + '-tab');
            if (tabContent) {
                tabContent.classList.add('active');
            }
        }

        // editor_script.js의 switchTab 함수 오버라이드
        window.switchTab = function(tabName, event) {
            let buttonElement = null;
            
            // 이벤트가 있으면 타겟 버튼 찾기
            if (event && event.target) {
                buttonElement = event.target.closest('.tab-btn');
            } else {
                // 이벤트가 없으면 data-tab으로 버튼 찾기
                buttonElement = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
            }
            
            switchTabFixed(tabName, buttonElement);
        };

        // 교정 요청 함수 (만약 정의되지 않았다면)
        if (typeof correctionRequest === 'undefined') {
            window.correctionRequest = function() {
                console.log('[교정 요청] 기능 실행');
                // 교정 요청 로직은 editor_script.js에서 처리
                if (typeof requestCorrection === 'function') {
                    requestCorrection();
                }
            };
        }

        // Theme Management
        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            localStorage.setItem('stenoTheme', theme); 

            // Update select value
            document.querySelector('.theme-select').value = theme;
            
            // Update theme buttons
            document.querySelectorAll('.theme-option').forEach(btn => {
                btn.classList.remove('active');
            });
            const themeBtn = document.querySelector(`.theme-option.${theme}`);
            if (themeBtn) themeBtn.classList.add('active');
        }

        // Load saved theme
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
        });

        // Fullscreen Toggle
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // Button-based update functions for text settings
        function updateFontSizeButton(direction) {
            const fontSizeRange = document.getElementById('fontSizeRange');
            let currentValue = parseInt(fontSizeRange.value) || 15;
            let newValue = currentValue + direction;
            
            // Limit to min 12, max 24
            newValue = Math.max(12, Math.min(24, newValue));
            
            fontSizeRange.value = newValue;
            document.getElementById('fontSizeValue').textContent = `${newValue}px`;
            
            if (typeof updateTextSettings === 'function') {
                updateTextSettings();
            }
        }

        function updateLineHeightButton(direction) {
            const lineHeightRange = document.getElementById('lineHeightRange');
            let currentValue = parseInt(lineHeightRange.value) || 18;
            let newValue = currentValue + direction;
            
            // Limit to min 14, max 24
            newValue = Math.max(14, Math.min(24, newValue));
            
            lineHeightRange.value = newValue;
            const lineHeight = (newValue / 10).toFixed(1);
            document.getElementById('lineHeightValue').textContent = lineHeight;
            
            if (typeof updateTextSettings === 'function') {
                updateTextSettings();
            }
        }

        function updateMatchWordsButton(direction) {
            const matchWordSlider = document.getElementById('matchWordSlider');
            let currentValue = parseInt(matchWordSlider.value) || 3;
            let newValue = currentValue + direction;
            
            // Limit to min 3, max 7
            newValue = Math.max(3, Math.min(7, newValue));
            
            matchWordSlider.value = newValue;
            document.getElementById('matchWordValue').textContent = newValue;
            
            // matchWordCount 전역 변수 업데이트 (기존 JS 호환)
            if (typeof matchWordCount !== 'undefined') {
                matchWordCount = newValue;
            }
            // matchWordSelect 동기화
            const matchWordSelect = document.getElementById('matchWordSelect');
            if (matchWordSelect) {
                matchWordSelect.value = newValue;
            }
        }

        // Update functions for sliders (디자인 호환 - 기존 함수 유지)
        function updateFontSize(value) {
            document.getElementById('fontSizeValue').textContent = `${value}px`;
            const fontSizeRange = document.getElementById('fontSizeRange');
            if (fontSizeRange) fontSizeRange.value = value;
            if (typeof updateTextSettings === 'function') {
                updateTextSettings();
            }
        }

        function updateLineHeight(value) {
            const lineHeight = (value / 10).toFixed(1);
            document.getElementById('lineHeightValue').textContent = lineHeight;
            const lineHeightRange = document.getElementById('lineHeightRange');
            if (lineHeightRange) lineHeightRange.value = value;
            if (typeof updateTextSettings === 'function') {
                updateTextSettings();
            }
        }

        function updateMatchWords(value) {
            document.getElementById('matchWordValue').textContent = value;
            const matchWordSlider = document.getElementById('matchWordSlider');
            if (matchWordSlider) matchWordSlider.value = value;
            if (typeof matchWordCount !== 'undefined') {
                matchWordCount = parseInt(value);
            }
            const matchWordSelect = document.getElementById('matchWordSelect');
            if (matchWordSelect) {
                matchWordSelect.value = value;
            }
        }

        // Viewer functions (디자인 호환)
        function openViewerWindow() {
            const channel = document.getElementById('channelInfo')?.textContent || 'default';
            window.open(`viewer.html?channel=${channel}`, 'viewer', 'width=800,height=600');
        }

        function clearViewer() {
            const viewerContent = document.getElementById('viewerContent');
            if (viewerContent) {
                viewerContent.innerHTML = '<span class="viewer-placeholder">자막이 여기에 표시됩니다.</span>';
            }
        }

        function copyViewerText() {
            const text = document.getElementById('viewerContent').innerText;
            navigator.clipboard.writeText(text);
            // 알림 표시 (기존 showNotification 또는 간단한 alert)
            if (typeof showNotification === 'function') {
                showNotification('텍스트가 복사되었습니다');
            } else {
                console.log('텍스트가 복사되었습니다');
            }
        }

        function saveViewerText() {
            const text = document.getElementById('viewerContent').innerText;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `transcript_${new Date().getTime()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Notification helper (fallback)
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 24px;
                left: 50%;
                transform: translateX(-50%);
                padding: 12px 24px;
                background: ${type === 'warning' ? '#ff9800' : 'var(--accent-gradient)'};
                color: white;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 1000;
                animation: slideUp 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideDown 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add slide animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideUp {
                from { transform: translateX(-50%) translateY(100px); opacity: 0; }
                to { transform: translateX(-50%) translateY(0); opacity: 1; }
            }
            @keyframes slideDown {
                from { transform: translateX(-50%) translateY(0); opacity: 1; }
                to { transform: translateX(-50%) translateY(100px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Connection status update
        setInterval(() => {
            const connectionDot = document.getElementById('connectionDot');
            const connectionStatus = document.getElementById('connectionStatus');
            if (typeof socket !== 'undefined' && socket && socket.connected) {
                if (connectionDot) connectionDot.classList.remove('disconnected');
                if (connectionStatus) connectionStatus.textContent = '연결됨';
            } else {
                if (connectionDot) connectionDot.classList.add('disconnected');
                if (connectionStatus) connectionStatus.textContent = '연결 끊김';
            }
        }, 5000);
    </script>
</body>
</html>
